<?xml version="1.0" encoding="utf-8"?>

<TranscendenceModule>

<!-- CORPORATE HIERARCHY
	
	GLOBAL DATA

	statusKateM:		Status of player with respect to Kate Morgental
							Nil						= Never met
							'acquaintance			= Met once or twice
							'ally					= Player has helped
							'betrayedKatami			= Player did not help Mr. Katami
							'destroyedByPlayer		= Player killed her
							'destroyed				= She is dead

-->

	<Sovereign UNID="&svCorporate;"
			name=":the Corporate Hierarchy"
			shortName=":the Corporations"
			adjective="Corporate"
			demonym=":a Corporate shareholder(s)"
			alignment="constructive chaos"
			>
			
		<Events>
			<GetGlobalDockScreen>
				(switch
					; This only applies to corporate hierarchy stations
					(not (objMatches gSource Nil "sTAV +corporateCustoms;"))
						Nil
						
					; If the ship is radioactive then we refuse docking
					(shpIsRadioactive gPlayerShip)
						(if (objHasAttribute gSource "corporateDecon")
							(list &dsCommonwealthDecon; 10)
							(list &dsRefuseContamination; 10)
							)
						
					; If the player has committed crimes, then she's in trouble
					(geq (int (objGetData gPlayerShip "corpCrimeSeverity")) 2)
						(list &dsCorporateImprison; 8)
						
					Nil
					)
			</GetGlobalDockScreen>
		</Events>
		
		<AttributeDesc>
			<!-- Define item attributes so that the player can see which Corporation 
				created the item. -->
		
			<ItemAttribute label="Assembler"		criteria="* +assemblerCorp;"/>
			<ItemAttribute label="Bushido"			criteria="* +bushido;"/>
			<ItemAttribute label="EI"				criteria="* +ei;"/>
			<ItemAttribute label="Heisenmachines"	criteria="* +heisenmachines;"/>
			<ItemAttribute label="Honoku-Tomashi"	criteria="* +honokuTomashi;"/>
			<ItemAttribute label="Kabuto"			criteria="* +kabuto;"/>
			<ItemAttribute label="Kartal"			criteria="* +kartal;"/>
			<ItemAttribute label="Makayev"			criteria="* +makayev;"/>
			<ItemAttribute label="NAMI"				criteria="* +nami;"/>
			<ItemAttribute label="OmniDefense"		criteria="* +omniDefense;"/>
			<ItemAttribute label="Onorad"			criteria="* +onorad;"/>
			<ItemAttribute label="Pacific Defense"	criteria="* +pacificDefense;"/>
			<ItemAttribute label="Rasiermesser"		criteria="* +rasiermesser;"/>
			<ItemAttribute label="Solon"			criteria="* +solon;"/>
			<ItemAttribute label="Taikon"			criteria="* +taikon;"/>
			<ItemAttribute label="Tenhove"			criteria="* +tenhove;"/>
		</AttributeDesc>
	</Sovereign>

	<!-- CorporateCruiser -->

	<ShipClass UNID="&scCorporateCruiser;"
			manufacturer=		"Rasiermesser"
			class=				"corporate cruiser"
			type=				""
			defaultSovereign=	"&svCorporate;"

			attributes=			"capitalShip, corporate, genericClass, majorShip"
			   
			size=				"275"
			mass=				"25000"
			thrustRatio=		"2"
			maxSpeed=			"20"
			cargoSpace=			"1000"

			cyberDefenseLevel=	"8"

			explosionType=		"&vtThermoExplosion3;"
			>

		<!-- Configuration -->
		
		<Armor
			armorID=			"&itHexaCarbideArmor;"
			count=				"16"
			/>
		
		<Devices>
			<Device deviceID="&itRasiermesserLauncher;" secondaryWeapon="true" minFireArc="340" maxFireArc="200"	posAngle="110" posRadius="60" posZ="0"/>
			<Device deviceID="&itRasiermesserLauncher;" secondaryWeapon="true" minFireArc="160" maxFireArc="20"		posAngle="250" posRadius="60" posZ="0"/>
			<Device deviceID="&itPlasmaShieldGenerator;"/>
		</Devices>

		<Maneuver
			maxRotationRate=	"3.0"
			rotationAccel=		"0.5"
			/>

		<Interior>
			<Compartment name="interior"
					hitPoints=	"300"
					/>
			
			<Compartment name="main drive"
					type=		"mainDrive"
					hitPoints=	"100"

					posX=		"-25"
					posY=		"0"
					sizeX=		"50"
					sizeY=		"40"
					/>
		</Interior>

		<Items>
			<Item count="40d20" item="&itGotha10Missile;"/>
			<Item count="2d12" item="&itPteracniumFuelRod;"/>
		</Items>

		<!-- Image and Effects -->

		<Image imageID="&rsCorporateCruiser;" imageWidth="230" imageHeight="230"/>

		<Effects>
			<Effect type="thrustMain"		posAngle="180"	posRadius="0"	posZ="-10"	rotation="180"	sendToBack="*"/>
		</Effects>
		
		<!-- AI and Behavior -->
		
		<AISettings
			fireRateAdj=		"40"
			fireAccuracy=		"95"
			perception=			"4"
			/>

	</ShipClass>

	<!-- Adventurer Outfitters -->

	<StationType UNID="&stAdventurerOutfitters;"
			name=				": Adventurer Outfitters|Adventurer Outfitters"
			sovereign=			"&svCorporate;"
			inherit=			"&baCorporateStation;"

			dockScreen=			"Main"
			abandonedScreen=	"&dsAbandonedStation;"
			dockingPorts=		"8"
			canAttack=			"true"

			multiHull=			"true"
			armorID=			"&itLightGusokuArmor;"
			hitPoints=			"280"
			regen=              "3"
			fireRateAdj=		"15"
			explosionType=		"&vtBlastExplosion3;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"corporate, corporateArms, corporateCustoms, envAir, envEarth, envFire, envWater, friendly, independent, generic, human, populated"
			levelFrequency=		"---ru cu--- ----- ----- -----"
			locationCriteria=	"+planetary"
			enemyExclusionRadius="50"
			>

		<Image			imageID="&rsStations6;" imageX="0" imageY="640" imageWidth="128" imageHeight="256"/>

		<Ships>
			<Lookup count="2" table="&tbCorpDefenders;"/>
			<Lookup count="1d4" table="&tbCommPrivateCrafts;"/>
		</Ships>

		<Reinforcements minShips="4">
			<Table>
				<Lookup chance="75" table="&tbCorpDefenders;"/>
				<Lookup chance="25" table="&tbCommPrivateCrafts;"/>
			</Table>
		</Reinforcements>

		<Devices>
			<Device deviceID="&itHeavyIonBlaster;"	omnidirectional="true"/>
		</Devices>

		<Items>
			<RandomItem count="1d12" 
					criteria=		"a L:1-10; -illegal; -Specialty; -NotStandard; -NotForSale;"
					levelFrequency=	"systemLevel:u|c|crv"
					enhanced=		"5"
					enhancement=	"=(intHPEnhancement1)"
					/>
			<RandomItem count="1d12" 
					criteria=		"w L:1-10; -illegal; -Specialty; -NotStandard; -NotForSale;"
					levelFrequency=	"systemLevel:u|c|crv"
					enhanced=		"5"
					enhancement=	"=(intHPEnhancement1)"
					/>
			<RandomItem count="1d12" 
					criteria=		"d~w L:1-10; -illegal; -Specialty; -NotStandard; -NotForSale;"
					levelFrequency=	"systemLevel:u|c|crv"
					enhanced=		"5"
					enhancement=	"=(intCorporateGenerateEnhancement gItem)"
					/>

			<RandomItem count="1d12" 
					criteria=		"u -Specialty; -illegal; -NotStandard; -NotForSale;"
					levelFrequency=	"systemLevel:ru|c|cur"
					/>

			<RandomItem count="2d12" 
					criteria=		"m -Specialty; -illegal; -NotStandard; -NotForSale;"
					levelFrequency=	"systemLevel:ru|c|cur"
					/>

			<RandomItem count="1d6" 
					criteria=		"adu L:1-10; -illegal; -Specialty; -NotStandard; -NotForSale;"
					levelFrequency=	"systemLevel:-|r|cur"
					/>
		</Items>

		<Trade currency="credit" max="100000" replenish="5000">
			<Sell	criteria="m +commonwealth; -premiumAmmo; -illegal; -notForSale; -notStandard;" priceAdj="100" inventoryAdj="200" levelFrequency="systemLevel:ruc|c|cur"/>
			<Sell	criteria="*NU -Illegal; -ID; -NotForSale;"	priceAdj="100"/>
			<Buy	criteria="amdNU -Illegal; -ID; -NotForSale;"	priceAdj="50"/>
			<Buy	criteria="ufNU -Illegal; -ID; -NotForSale;"	priceAdj="90"/>
			<Buy	criteria="amdufNU -Illegal; -ID;"				priceAdj="10"/>

			<Refuel			criteria="f +BasicFuel; L:1-9;" priceAdj="100"/>
			<RepairArmor	criteria="a L:1-9;" priceAdj="100"/>
			<ReplaceArmor	criteria="a L:1-10;" priceAdj="110"/>
			<InstallDevice	criteria="d L:1-10;" priceAdj="110"	upgradeInstallOnly="true"/>
			<RemoveDevice	criteria="d L:1-10;" priceAdj="110"	upgradeInstallOnly="true"/>
		</Trade>

		<Events>
			<OnContractGenerate>
				(intGenerateIndustrialRequestContract1)
			</OnContractGenerate>

			<OnContractQuery>True</OnContractQuery>
		</Events>

		<DockScreens>
			<Main>
				<Panes>
					<Default descID="descWelcome">
						<Actions>
							<Action id="actionDockServices" default="1">
								(rpgDockServices gPlayerShip {
									checkMilitaryID: True
									upgradeInstallOnly: True
									})
							</Action>

							<Action id="actionCommoditiesExchange">
								(scrShowScreen gScreen &dsRPGCommoditiesExchange; {
									checkMilitaryID: True
									})
							</Action>

							<Action id="actionUndock" cancel="1">
								<Exit/>
							</Action>
						</Actions>
					</Default>
				</Panes>
			</Main>
		</DockScreens>

		<DockingPorts>
			<Port x="83"	y="29" />
			<Port x="-83"	y="29" />
			<Port x="97"	y="-9" />
			<Port x="-97"	y="-9" />
			<Port x="84"	y="-72" />
			<Port x="-84"	y="-72" />
			<Port x="30"	y="-111" />
			<Port x="-30"	y="-111" />
		</DockingPorts>

		<Language>
			<Text id="descWelcome">

				Welcome to Adventurer Outfitters! We've been serving mercenaries,
				explorers, and pilgrims since 2311.

			</Text>
		</Language>
	</StationType>

	<!-- Armor Dealer -->

	<StationType UNID="&stArmorDealer;"
			name=				"corporate armor dealer"
			sovereign=			"&svCorporate;"
			inherit=			"&baCorporateStation;"

			dockScreen=			"Main"
			abandonedScreen=	"&dsAbandonedStation;"
			dockingPorts=		"8"
			canAttack=			"true"

			level=				"4"
			multiHull=			"true"
			armorID=			"&itCeralloyArmor;"
			hitPoints=			"160"
			regen=				"2"
			explosionType=		"&vtBlastExplosion2;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"corporate, corporateArms, corporateCustoms, envAir, envEarth, envFire, envWater, friendly, independent, generic, human, populated"
			levelFrequency=		"ccuv- ----- ----- ----- -----"
			locationCriteria=	"+planetary"
			>

		<Names noArticle="true">Armor United; Brentano Armor; Carbellium Armor Systems;
				Dreadnought Armor; Enterprise Armor Dealer; Full Protection Systems;
				Gargantua Defense Systems; Hellforge Armor; Indomitable Armor Systems;
				Jacob's Armor; Krenel Armors, rce; Loki Defense Systems; Murasaki Armor Corporation;
				Nerling Armor Dealers; Ooro Armors; Pangea Protection Equipment;
				Quen Ho Armor; Ransom Armor Corporation; Sentinel Protection Equipment;
				Tenhove Defense Dealer; Umagahli Armor Systems; Viceroy Armor;
				Wei Chang Armor Dealer; %s Armor Systems</Names>

		<Image			imageID="&rsStations1;" imageX="256" imageY="256" imageWidth="128" imageHeight="128"/>

		<Ships standingCount="3">
			<Table>
				<Lookup chance="75" table="&tbCorpDefenders;"/>
				<Lookup chance="25" table="&tbCommPrivateCrafts;"/>
			</Table>
		</Ships>

		<Items>
			<RandomItem count="8-12" 
					criteria=		"as L:1-7; -Illegal; -Military; -NotStandard; -NotForSale;"
					levelFrequency=	"systemLevel:u|c|ur"
					enhanced=		"10"
					enhancement=	"=(intHPEnhancement1)"
					/>
			<RandomItem count="8-12" 
					criteria=		"as L:1-7; -Illegal; -Military; -NotStandard; -NotForSale;"
					levelFrequency=	"systemLevel:-|u|crv"
					enhanced=		"5"
					enhancement=	"=(intHPEnhancement1)"
					/>
			<RandomItem count="6-10" 
					criteria=		"as L:1-7; -Illegal; -Military; -NotStandard; -NotForSale;"
					levelFrequency=	"systemLevel:u|c|cur"
					/>
			<RandomItem count="4" 
					criteria=		"u +ArmorRepair; -Illegal; -Military; -NotStandard; -NotForSale;"
					levelFrequency=	"systemLevel:uc|c|cur"
					/>

			<Item count="3d4"	item="&itAblativeArmorCoating;" />
			<Item count="1d2"	item="&itMonopoleDeflector;" />

			<Item chance="70" count="1d4"	item="&itCarbonWeaverNanos;" />
			<Item chance="10" count="1d4"	item="&itDegeneratingNanos;" />
			<Item chance="70" count="1d4"	item="&itReactiveArmorCoating;" />
			<Item chance="30" count="1d2"	item="&itReflectiveArmorCoating;" />
			<Item chance="10" count="1d2"	item="&itRegeneratingNanos;" />
			<Item chance="30" count="1d4"	item="&itEMPImmuneCoating;" />
		</Items>

		<Trade currency="credit" max="50000" replenish="2500">
			<Sell	criteria="*NU -Illegal; -ID; -NotForSale;"	priceAdj="100"/>
			<Buy	criteria="asU -Illegal; -NotForSale;"	priceAdj="50"/>
			<Buy	criteria="asU -Illegal; -ID;"				priceAdj="10"/>
			
			<RepairArmor	criteria="a L:1-7;" priceAdj="100"/>
			<ReplaceArmor	criteria="a L:1-7;" priceAdj="100"/>
			<InstallDevice	criteria="s L:1-7;" priceAdj="100"	upgradeInstallOnly="true"/>
			<RemoveDevice	criteria="s L:1-7;" priceAdj="100"	upgradeInstallOnly="true"/>
		</Trade>

		<StaticData>
			<NPCService>
				(	;	service					level	margin
					(	'repairArmor			7		100		)
					)
			</NPCService>
		</StaticData>

		<Events>
			<OnContractGenerate>
				(intGenerateIndustrialRequestContract1)
			</OnContractGenerate>

			<OnContractQuery>True</OnContractQuery>
		</Events>

		<DockScreens>
			<Main>
				<Panes>
					<Default descID="descWelcome">
						<Actions>
							<Action name="Armor and Shields" key="A" default="1">
								(scrShowScreen gScreen &dsRPGManageArmor; {
									checkMilitaryID: True
									upgradeInstallOnly: True
									})
							</Action>
							
							<Action id="actionCommoditiesExchange">
								(scrShowScreen gScreen &dsRPGCommoditiesExchange; {
									checkMilitaryID: True
									})
							</Action>

							<Action id="actionUndock" cancel="1">
								<Exit/>
							</Action>

						</Actions>

					</Default>
				</Panes>
			</Main>

		</DockScreens>

		<DockingPorts>
			<Port x="0"		y="64" />
			<Port x="64"	y="0" />
			<Port x="0"		y="0" />
			<Port x="50"	y="90" />
			<Port x="90"	y="20" />
		</DockingPorts>

        <Language>
			<Text id="descWelcome">
				You are docked at an armor dealer station.
			</Text>

            <Text id="core.mapDesc">"Buys and sells armor and shields &mdash; Installs purchased items &mdash; Buys damaged armor and shields"</Text>
        </Language>
	</StationType>

	<!-- Arms Dealer -->

	<StationType UNID="&stArmsDealer;"
			name=				"corporate arms dealer"
			sovereign=			"&svCorporate;"
			inherit=			"&baCorporateStation;"

			dockScreen=			"Main"
			abandonedScreen=	"&dsAbandonedStation;"
			dockingPorts=		"8"
			canAttack=			"true"

			level=				"4"
			multiHull=			"true"
			armorID=			"&itCeralloyArmor;"
			hitPoints=			"160"
			regen=				"2"
			explosionType=		"&vtBlastExplosion2;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"corporate, corporateArms, corporateCustoms, envAir, envEarth, envFire, envWater, friendly, independent, generic, human, populated"
			levelFrequency=		"uccr- ----- ----- ----- -----"
			locationCriteria=	"+planetary"
			>

		<Names noArticle="true">Azure Protection Systems; Bixbie Arms; Chiba Arms Dealers; 
				Dreadnought Arms; Excimer Systems; Farside Defense Systems;
				General Arms, rce; Hastur Weapons; Iberian Defense Systems;
				Jacob's Arms; Kraken Weapons, rce; Laser Armada; Ming Systems;
				Nrummer Weapons Corp.; Obelisk Weapons; Penitent Defender;
				Quixote Arms Corporation; Raptor Systems, rce; Security Weapons;
				Tenhove Defense Dealer; Ultimate Weapons; Victory Systems;
				Weapons World; %s Weapon Systems</Names>

		<Image			imageID="&rsStations1;" imageX="256" imageY="384" imageWidth="128" imageHeight="128"/>

		<Ships>
			<Lookup count="2" table="&tbCorpDefenders;"/>
			<Lookup count="1d4" table="&tbCommPrivateCrafts;"/>
		</Ships>

		<Reinforcements minShips="4">
			<Table>
				<Lookup chance="75" table="&tbCorpDefenders;"/>
				<Lookup chance="25" table="&tbCommPrivateCrafts;"/>
			</Table>
		</Reinforcements>

		<Items>
			<RandomItem count="10" 
					criteria=		"w L:1-5; -Illegal; -Military; -NotStandard; -NotForSale;"
					levelFrequency=	"systemLevel:c|-|-"
					enhanced=		"10"
					enhancement=	"=(intHPEnhancement2)"
					/>
			<RandomItem count="15" 
					criteria=		"w L:1-5; -Illegal; -Military; -NotStandard; -NotForSale;"
					levelFrequency=	"systemLevel:u|c|u"
					enhanced=		"10"
					enhancement=	"=(intHPEnhancement1)"
					/>
			<RandomItem count="8" 
					criteria=		"w L:1-5; -Illegal; -Military; -NotStandard; -NotForSale;"
					levelFrequency=	"systemLevel:ru|c|crv"
					enhanced=		"5"
					enhancement=	"=(intHPEnhancement1)"
					/>

			<RandomItem count="25-35" 
					criteria=		"m -Illegal; -Military; -NotStandard; -NotForSale;"
					levelFrequency=	"systemLevel:ru|c|ur"
					/>
		</Items>

		<Trade currency="credit" max="50000" replenish="2500">
			<Sell	criteria="m +commonwealth; +basicAmmo; -illegal; -notForSale; -notStandard;" priceAdj="100" inventoryAdj="200" levelFrequency="systemLevel:ruc|c|cur"/>
			<Sell	criteria="*NU -Illegal; -ID; -NotForSale;"	priceAdj="100"/>
			<Buy	criteria="mwU -Illegal; -NotForSale;"	priceAdj="50"/>
			<Buy	criteria="mwU -Illegal; -ID;"				priceAdj="10"/>
			
			<InstallDevice	criteria="w L:1-5;" priceAdj="100"	upgradeInstallOnly="true"/>
			<RemoveDevice	criteria="w L:1-5;" priceAdj="100"	upgradeInstallOnly="true"/>
		</Trade>

		<Events>
			<OnContractGenerate>
				(intGenerateIndustrialRequestContract1)
			</OnContractGenerate>

			<OnContractQuery>True</OnContractQuery>

			<OnCreate>
				; Pick a random upgrade
				(objSetData gSource "WeaponUpgrade" (random 0 5))
			</OnCreate>
		</Events>

		<DockScreens>
			<Main>
				<Panes>
					<Default descID="descWelcome">
						<Actions>
							<Action name="[W]eapons" default="1">
								(scrShowScreen gScreen &dsRPGManageWeapons; {
									checkMilitaryID: True
									upgradeInstallOnly: True
									})
							</Action>

							<Action id="actionCommoditiesExchange">
								(scrShowScreen gScreen &dsRPGCommoditiesExchange; {
									checkMilitaryID: True
									})
							</Action>

							<Action id="actionUndock" cancel="1">
								<Exit/>
							</Action>
						</Actions>
					</Default>
				</Panes>
			</Main>
		</DockScreens>

		<DockingPorts>
			<Port x="0"		y="70" />
			<Port x="0"		y="-70" />
			<Port x="50"	y="50" />
			<Port x="50"	y="-50" />
			<Port x="70"	y="0" />
			<Port x="-70"	y="0" />
			<Port x="-50"	y="50" />
			<Port x="-50"	y="-50" />
		</DockingPorts>

        <Language>
			<Text id="descWelcome">
				You are docked at an arms dealer station.
			</Text>

            <Text id="core.mapDesc">"Buys and sells weapons and ammo &mdash; Installs purchased items &mdash; Buys damaged weapons"</Text>
        </Language>
	</StationType>

	<!-- Arms Dealer, Makayev -->

	<StationType UNID="&stArmsDealerMakayev;"
			name=				": Makayev-Energia Space Systems|Makayev-Energia Space Systems"
			sovereign=			"&svCorporate;"
			inherit=			"&baCorporateStation;"

			dockScreen=			"&dsArmsDealerSpecial;"
			abandonedScreen=	"&dsAbandonedStation;"
			dockingPorts=		"8"
			canAttack=			"true"

			level=				"5"
			multiHull=			"true"
			armorID=			"&itBlastPlate;"
			hitPoints=			"350"
			regen=				"12"
			fireRateAdj=		"20"
			explosionType=		"&vtBlastExplosion2;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"corporate, corporateArms, corporateCustoms, envAir, envEarth, envFire, envWater, friendly, independent, generic, human, populated"
			levelFrequency=		"--rur v---- ----- ----- -----"
			locationCriteria=	"+planetary"
			>

		<Image			imageID="&rsStations1;" imageX="256" imageY="384" imageWidth="128" imageHeight="128"/>

		<Ships>
			<Lookup count="2" table="&tbCorpDefenders;"/>
			<Lookup count="1d4" table="&tbCommPrivateCrafts;"/>
		</Ships>

		<Reinforcements minShips="4">
			<Table>
				<Lookup chance="75" table="&tbCorpDefenders;"/>
				<Lookup chance="25" table="&tbCommPrivateCrafts;"/>
			</Table>
		</Reinforcements>

		<Devices>
			<Device deviceID="&itMarkIHowitzer;"	omnidirectional="true"/>
		</Devices>

		<Items>
			<RandomItem count="1d12" 
					criteria=		"w L:1-7; +Makayev; -NotForSale;"
					levelFrequency=	"systemLevel:ru|c|crv"
					enhanced=		"10"
					enhancement=	"=(intMakayevWeaponEnhancement)"
					/>

			<RandomItem chance="65" count="1d4" 
					criteria=		"d~w L:1-7; +Makayev; -NotForSale;"
					levelFrequency=	"systemLevel:ru|c|ur"
					/>

			<RandomItem count="2d12" 
					criteria=		"a L:1-7; +Makayev; -NotForSale;"
					levelFrequency=	"systemLevel:ru|c|ur"
					enhanced=		"10"
					enhancement=	"=(intMakayevArmorEnhancement)"
					/>

			<LevelTable count="1-8">
				<Item levelFrequency="----u ccur-"	count="40-60"	item="&itStrelkaRed;" />
				<Item levelFrequency="----- -uccu"	count="40-60"	item="&itStrelkaBlack;" />
			</LevelTable>
		</Items>

		<Trade currency="credit" max="50000" replenish="2500">
			<Sell	criteria="m +makayev; -military; -illegal; -notForSale;" priceAdj="100" inventoryAdj="500" levelFrequency="systemLevel:ruc|c|cur"/>
			<Sell	criteria="*NU -Illegal; -ID; -NotForSale;"	priceAdj="100"/>

			<RepairArmor	criteria="a L:1-8;" priceAdj="100"/>
			<ReplaceArmor	criteria="a +makayev; L:1-7;" priceAdj="100"/>
			<InstallDevice	criteria="d +makayev; L:1-7;" priceAdj="100"/>
			<RemoveDevice	criteria="d L:1-7;" priceAdj="100"/>
			
			<ReplaceArmor	criteria="a L:1-7;" priceAdj="unavailable"	messageID="descNoInstall"/>
			<InstallDevice	criteria="d L:1-7;" priceAdj="unavailable"	messageID="descNoInstall"/>
		</Trade>

		<StaticData>
			<LongName>"a Makayev-Energia weapons franchise"</LongName>
		</StaticData>

		<Events>
			<OnContractGenerate>
				(intGenerateIndustrialRequestContract1)
			</OnContractGenerate>

			<OnContractQuery>True</OnContractQuery>
		</Events>

		<DockingPorts>
			<Port x="0"		y="70" />
			<Port x="0"		y="-70" />
			<Port x="50"	y="50" />
			<Port x="50"	y="-50" />
			<Port x="70"	y="0" />
			<Port x="-70"	y="0" />
			<Port x="-50"	y="50" />
			<Port x="-50"	y="-50" />
		</DockingPorts>
		
		<Language>
			<Text id="descNoInstall">
				(cat
					"We only install Makayev items. "
					"We cannot install " (itmGetName (@ gData 'item) 0x04) " on your ship."
					)
			</Text>
			<Text id="dockServices:installAbility">
				(cat "We install Makayev items up to tech level " (objGetProperty gSource 'installDeviceMaxLevel) ".")
			</Text>

            <Text id="core.mapDesc">
                "Repairs armor up to level 8 &mdash; Installs Makayev armor up to level 7 &mdash; Installs Makayev devices up to level 7 &mdash; Sells Makayev products"
            </Text>
		</Language>
	</StationType>

	<!-- Arms Dealer, Bushido -->

	<StationType UNID="&stArmsDealerBushido;"
			name=				"Bushido merchant"
			sovereign=			"&svCorporate;"
			inherit=			"&baCorporateStation;"

			dockScreen=			"&dsArmsDealerSpecial;"
			abandonedScreen=	"&dsAbandonedStation;"
			dockingPorts=		"8"
			canAttack=			"true"

			multiHull=			"true"
			armorID=			"&itLightGusokuArmor;"
			hitPoints=			"300"
			regen=				"4"
			fireRateAdj=		"20"
			explosionType=		"&vtBlastExplosion3;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"corporate, corporateArms, corporateCustoms, envAir, envEarth, envFire, envWater, friendly, independent, generic, human, populated"
			levelFrequency=		"---ru rv--- ----- ----- -----"
			locationCriteria=	"+planetary"
			enemyExclusionRadius="50"
			>

		<Image			imageID="&rsStations1;" imageX="256" imageY="384" imageWidth="128" imageHeight="128"/>

		<Ships>
			<Lookup count="2" table="&tbCorpDefenders;"/>
			<Lookup count="1d4" table="&tbCommPrivateCrafts;"/>
		</Ships>

		<Reinforcements minShips="4">
			<Table>
				<Lookup chance="75" table="&tbCorpDefenders;"/>
				<Lookup chance="25" table="&tbCommPrivateCrafts;"/>
			</Table>
		</Reinforcements>

		<Devices>
			<Device deviceID="&itNeutronBlaster;"	omnidirectional="true"/>
		</Devices>

		<Items>
			<RandomItem count="1d12" 
					criteria=		"w L:1-10; +Bushido; -NotForSale;"
					levelFrequency=	"systemLevel:ru|c|crv"
					enhanced=		"10"
					enhancement=	"=(intBushidoWeaponEnhancement)"
					/>

			<RandomItem count="1d12" 
					criteria=		"s L:1-10; +Bushido; -NotForSale;"
					levelFrequency=	"systemLevel:ru|c|ur"
					enhanced=		"10"
					enhancement=	"=(intBushidoShieldEnhancement)"
					/>

			<RandomItem count="1d12" 
					criteria=		"a L:1-10; +Bushido; -NotForSale;"
					levelFrequency=	"systemLevel:ru|c|ur"
					enhanced=		"10"
					enhancement=	"=(intBushidoArmorEnhancement)"
					/>

			<RandomItem count="1d12" 
					criteria=		"a L:1-10; +Bushido; -NotForSale;"
					levelFrequency=	"systemLevel:r|u|cur"
					enhanced=		"5"
					enhancement=	"=(intBushidoArmorEnhancement)"
					/>
		</Items>

		<Trade currency="credit" max="50000" replenish="2500">
			<Sell	criteria="m +bushido; -illegal; -notForSale;" priceAdj="100" inventoryAdj="300" levelFrequency="systemLevel:ruc|c|cur"/>
			<Sell	criteria="*NU -Illegal; -ID; -NotForSale;"	priceAdj="100"/>

			<RepairArmor	criteria="a L:1-9;" priceAdj="100"/>
			<ReplaceArmor	criteria="a +bushido; L:1-10;" priceAdj="100"/>
			<InstallDevice	criteria="d +bushido; L:1-10;" priceAdj="100"/>
			<RemoveDevice	criteria="d L:1-10;" priceAdj="100"/>
			
			<ReplaceArmor	criteria="a L:1-10;" priceAdj="unavailable"	messageID="descNoInstall"/>
			<InstallDevice	criteria="d L:1-10;" priceAdj="unavailable"	messageID="descNoInstall"/>
		</Trade>

		<StaticData>
			<LongName>"a Bushido arms dealer"</LongName>
		</StaticData>

		<DockingPorts>
			<Port x="0"		y="70" />
			<Port x="0"		y="-70" />
			<Port x="50"	y="50" />
			<Port x="50"	y="-50" />
			<Port x="70"	y="0" />
			<Port x="-70"	y="0" />
			<Port x="-50"	y="50" />
			<Port x="-50"	y="-50" />
		</DockingPorts>

		<Language>
			<Text id="descNoInstall">
				(cat
					"We only install Bushido items. "
					"We cannot install " (itmGetName (@ gData 'item) 0x04) " on your ship."
					)
			</Text>
			<Text id="dockServices:installAbility">
				(cat "We install Bushido items up to tech level " (objGetProperty gSource 'installDeviceMaxLevel) ".")
			</Text>

            <Text id="core.mapDesc">
                "Repairs armor up to level 9 &mdash; Installs Bushido armor up to level 10 &mdash; Installs Bushido devices up to level 10 &mdash; Sells Bushido products"
            </Text>
		</Language>

	</StationType>

	<!-- Auton Dealer -->

	<StationType UNID="&stAutonDealer;"
			name=				"corporate auton dealer"
			sovereign=			"&svCorporate;"
			inherit=			"&baCorporateStation;"

			dockScreen=			"Main"
			abandonedScreen=	"&dsAbandonedStation;"
			dockingPorts=		"8"
			canAttack=			"true"

			multiHull=			"true"
			armorID=			"&itAdvancedPlasteelPlate;"
			hitPoints=			"350"
			regen=				"4"
			explosionType=		"&vtBlastExplosion2;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"corporate, corporateArms, corporateCustoms, envAir, envEarth, envFire, envWater, friendly, independent, generic, human, populated"
			levelFrequency=		"--rcu ur--- ----- ----- -----"
			locationCriteria=	"+planetary"
			enemyExclusionRadius="50"
			>

		<Names noArticle="true">Auton Universe; Brehzen's Used Autons; Chiba Auton Dealers;
				Dresden Autonomous Defenders; Ehrlenmeyer Autons; Frenzy Autons;
				General Autons, rce; Hastur Used Autons; Ixin Autons Dealer;
				Ji Autons; Kyrrin Used Autons; Laser Autons, rce; Merlin Autons;
				Nrummer Weapons Corp.; Oort Autons, rce; Planetary Autons;
				Qing Long Autons; Raptor Systems, rce; Security Autons;
				Tenhove Defense Dealer; Ultimate Autons; Victory Systems;
				Weapons World; %s Auton Dealers</Names>

		<Image			imageID="&rsStations4;" imageX="128" imageY="192" imageWidth="128" imageHeight="256"/>

		<Ships>
			<Lookup count="2" table="&tbCorpDefenders;"/>
			<Lookup count="1d4" table="&tbCommPrivateCrafts;"/>
		</Ships>

		<Reinforcements minShips="4">
			<Table>
				<Lookup chance="75" table="&tbCorpDefenders;"/>
				<Lookup chance="25" table="&tbCommPrivateCrafts;"/>
			</Table>
		</Reinforcements>

		<Items>
			<RandomItem count="20" 
					criteria=		"* +auton; -illegal; -military; -notStandard; -notForSale;"
					levelFrequency=	"systemLevel:ucc|c|cur"
					/>
			<RandomItem count="1d6" 
					criteria=		"* +auton; -illegal; -military; -notStandard; -notForSale; L:4"
					/>
		</Items>

		<Trade currency="credit" max="50000" replenish="2500">
			<Sell	criteria="*NU -Illegal; -ID; -NotForSale;"	priceAdj="100"/>
			<Buy	criteria="*NU +Auton; -Illegal; -NotForSale;"	priceAdj="90"/>
		</Trade>

		<Events>
			<OnContractGenerate>
				(intGenerateIndustrialRequestContract1)
			</OnContractGenerate>

			<OnContractQuery>True</OnContractQuery>
		</Events>

		<DockScreens>
			<Main>
				<Panes>
					<Default descID="descWelcome">
						<Actions>
							<Action name="Buy Autons" default="1" key="B">
								(scrShowScreen gScreen &dsRPGCommoditiesExchangeBuy; {
									checkMilitaryID: True
									})
							</Action>

							<Action name="Sell Autons" key="S">
								(scrShowScreen gScreen &dsRPGCommoditiesExchangeSell; {
									})
							</Action>

							<Action name="Repair Active Autons" key="R">
								(block Nil
									; Figure out the list of autons for the player
									(setq gList (sysFindObject gPlayerShip "s B:auton; O:escort;"))
									(if gList
										(scrShowPane gScreen "RepairAutons")
										(scrShowPane gScreen "NoAutons")
										)
									)
							</Action>

							<Action id="actionUndock" cancel="1">
								<Exit/>
							</Action>

						</Actions>

					</Default>

					<NoAutons descID="descNoAutons">
						<Actions>
							<Action id="actionLeave" cancel="1" default="1">
								<ShowPane pane="Default"/>
							</Action>
						</Actions>
					</NoAutons>

					<RepairAutons>
						<OnPaneInit>
							(block Nil
								; Figure out how much it would cost to repair the player's
								; autons.

								(setq gCost 0)
								(enum gList auton
									(for i 0 (subtract (shpGetArmorCount auton) 1)
										(setq gCost (add gCost (multiply 5 (objGetArmorDamage auton i))))
										)
									)

								(switch
									; If the autons have no damage, then there is nothing to do
									(eq gCost 0)
										(block Nil
											(scrSetDesc gScreen "There is no damage to your autons.")
											(scrEnableAction gScreen 0 Nil)
											)

									; If the player cannot afford it.
									(gr gCost (plyGetCredits gPlayer))
										(block Nil
											(scrSetDesc gScreen (cat "Repairing the damage to your autons would cost " gCost " credits. Unfortunately, you do not have enough credits to proceed."))
											(scrEnableAction gScreen 0 Nil)
											)

									; Otherwise, we're OK
									(scrSetDesc gScreen (cat "Repairing the damage to your autons will cost " gCost " credits. Do you wish to proceed?"))
									)
								)
						</OnPaneInit>

						<Actions>
							<Action name="Repair" default="1" key="R">
								(block Nil
									(enum gList auton
										(for i 0 (subtract (shpGetArmorCount auton) 1)
											(objRepairArmor auton i)
											)
										)

									(plyCharge gPlayer gCost)
									(scrShowPane gScreen "Default")
									)
							</Action>

							<Action id="actionLeave" cancel="1">
								<ShowPane pane="Default"/>
							</Action>
						</Actions>
					</RepairAutons>
				</Panes>
			</Main>

		</DockScreens>

		<DockingPorts>
			<Port x="0"		y="90" />
			<Port x="0"		y="-90" />
			<Port x="60"	y="60" />
			<Port x="60"	y="-60" />
			<Port x="90"	y="0" />
			<Port x="-90"	y="0" />
			<Port x="-60"	y="60" />
			<Port x="-60"	y="-60" />
		</DockingPorts>

        <Language>
			<Text id="descWelcome">
				You are docked at an auton dealer.
			</Text>
			<Text id="descNoAutons">

				A sales drone approaches you:
				
				"You do not currently have any autons to repair, but I would be 
				delighted to show you some of our newest models."

			</Text>
            <Text id="core.mapDesc">"Buys and sells autons"</Text>
        </Language>
	</StationType>

	<!-- Corporate Enclave -->

	<StationType UNID="&stCorporateEnclave;"
			name=				"corporate enclave"
			sovereign=			"&svCorporate;"
			inherit=			"&baCorporateStation;"

			dockScreen=			"Main"
			abandonedScreen=	"&dsAbandonedStation;"
			dockingPorts=		"8"
			canAttack=			"true"

			level=				"4"
			multiHull=			"true"
			armorID=			"&itCeralloyArmor;"
			hitPoints=			"320"
			regen=              "6"
			explosionType=		"&vtBlastExplosion3;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"corporate, corporateCustoms, friendly, independent, generic, human, majorStation, populated"
			levelFrequency=		"ruuur ----- ----- ----- -----"
			locationCriteria=	"-asteroids"
			>

		<Image			imageID="&rsStations1;" imageX="128" imageY="256" imageWidth="128" imageHeight="256"/>

		<Ships>
			<Lookup count="1d4+2" table="&tbCommPrivateCrafts;"/>
		</Ships>

		<Trade currency="credit" max="50000" replenish="2500">
			<Buy	criteria="*NU +Lux; -Illegal;"	priceAdj="105"/>
			<Buy	criteria="*NU +Meds; -Illegal;"	priceAdj="105"/>
			<Buy	criteria="*NU +Food; -Illegal;"	priceAdj="105"/>
			<Buy	criteria="*NU +Res; -Illegal;"	priceAdj="105"/>

			<ConsumeTrade	criteria="{core.fusionFuel}"		impact="5"/>
			<ConsumeTrade	criteria="{human.res}"		impact="3"/>
			<ConsumeTrade	criteria="{core.ore}"			impact="3"/>

			<ProduceTrade	criteria="{human.lux}"		impact="5"/>
		</Trade>

		<Events>
			<OnContractGenerate>
				(intGenerateIndustrialRequestContract1)
			</OnContractGenerate>

			<OnContractQuery>True</OnContractQuery>
		</Events>

		<DockScreens>
			<Main>
				<Panes>
					<Default descID="descWelcome">
						<Actions>
							<Action name="Corporate Level" default="1" key="C">
								<Navigate screen="CorporateLevel" />
							</Action>

							<Action name="Residential Level" key="R" id="residentialLevel">
								<ShowPane pane="ResidentialLevel"/>
							</Action>

							<Action name="Maintenance Level" key="M">
								(if (objGetItems gPlayerShip "*NU +Illegal; -ID; +property:known;")
									(scrShowPane gScreen "Illegals")
									(scrShowPane gScreen "MaintenanceLevel")
									)
							</Action>

							<Action id="actionUndock" cancel="1">
								<Exit/>
							</Action>

						</Actions>

					</Default>

					<Illegals descID="descIllegals">
						<Actions>
							<Action name="Enter Maintenance Shop" default="1" key="E">
								<ShowPane pane="MaintenanceShop"/>
							</Action>

							<Action id="actionLeave" cancel="1">
								<ShowPane pane="Default"/>
							</Action>
						</Actions>
					</Illegals>

					<MaintenanceLevel descID="descMaintenanceLevel">
						<Actions>
							<Action id="actionLeave" default="1" cancel="1">
								<ShowPane pane="Default"/>
							</Action>
						</Actions>
					</MaintenanceLevel>

					<MaintenanceShop descID="descMaintenanceShop">
						<Actions>
							<Action name="&quot;Sorry, you have me confused with someone else.&quot;" cancel="1" key="S">
								<ShowPane pane="Illegals"/>
							</Action>

							<Action name="&quot;The merchandise is in my cargo hold.&quot;" default="1" key="M">
								(block Nil
									(scrShowPane gScreen "Default")
									
									(scrShowSellScreen
										(lambda (theItem)
											(switch
												(itmMatches theItem "*NU +Illegal; -ID; +property:known;")
													(divide (multiply 90 (itmGetPrice theItem 'credit)) 100)
													
												Nil
												)
											)
								
										Nil						; obsolete
										
										'(
											Nil
											50000
											)
										)
									)
							</Action>
						</Actions>
					</MaintenanceShop>

					<ResidentialLevel descID="descResidentialLevel">
						<Actions>
							<Action id="actionLeave" default="1" cancel="1">
								<ShowPane pane="Default"/>
							</Action>
						</Actions>
					</ResidentialLevel>

				</Panes>
			</Main>

			<CorporateLevel>
				<Panes>
					<Default descID="descCorporateLevel">
						<Actions>
							<Action id="actionSellItems" default="1">
								(scrShowScreen gScreen &dsRPGCommoditiesExchangeSell; {
									})
							</Action>

							<Action id="actionLeave" cancel="1">
								<Navigate screen="Main" />
							</Action>
						</Actions>
					</Default>

				</Panes>

			</CorporateLevel>

		</DockScreens>

		<DockingPorts>
			<Port x="0"		y="95" />
			<Port x="0"		y="-85" />
			<Port x="50"	y="70" />
			<Port x="50"	y="-50" />
			<Port x="75"	y="0" />
			<Port x="-75"	y="0" />
			<Port x="-50"	y="70" />
			<Port x="-50"	y="-50" />
		</DockingPorts>

        <Language>
			<Text id="descWelcome">

				You are in the docking level of a corporate enclave. The 
				citizens of the station work for various members of the 
				Corporate Hierarchy.

			</Text>
			<Text id="descMaintenanceLevel">

				You are in the maintenance level of a corporate enclave. The 
				drone of the atmosphere processors and the waste converters 
				drowns out all other noises.
				
				There is an empty maintenance shop here filled with various 
				machines and drones; an empty laudanum ampule peeks out from 
				under the workbench.

			</Text>
			<Text id="descIllegals">

				You are in the maintenance level of a corporate enclave. The 
				door to the maintenance shop is open and you hear voices inside.

			</Text>
			<Text id="descMaintenanceShop">
				
				You are in the maintenance shop surrounded by various machines 
				and drones. There are four men in the room repairing various 
				items.
				
				One of the men walks towards you and says, "You must be the new 
				delivery person. Show me what you've got to sell."

			</Text>
			<Text id="descResidentialLevel">

				You are in the residential level of a corporate enclave. This 
				level holds the apartments and dwelling units of mid-level 
				corporate citizens. The units are small and somewhat homogenous,
				though everyone you meet seems happy.

			</Text>
			<Text id="descCorporateLevel">

				You are in the corporate level of a corporate enclave. The 
				day-to-day services and manufacturing of the various 
				corporations are carried-out on this level.

			</Text>
            <Text id="core.mapDesc">"Buys food, luxuries, meds, and resources"</Text>
        </Language>
	</StationType>

	<!-- Fuel Depot -->

	<StationType UNID="&stFuelDepot;"
			name=				"corporate fuel depot"
			sovereign=			"&svCorporate;"
			inherit=			"&baCorporateStation;"

			dockScreen=			"Main"
			abandonedScreen=	"&dsAbandonedStation;"
			dockingPorts=		"8"
			canAttack=			"true"

			level=				"4"
			multiHull=			"true"
			armorID=			"&itCeralloyArmor;"
			hitPoints=			"160"
			regen=              "2"
			explosionType=		"&vtThermoExplosion3;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"corporate, corporateCustoms, envAir, envEarth, envFire, envWater, friendly, independent, generic, human, populated"
			levelFrequency=		"cccuu rv--- ----- ----- -----"
			locationCriteria=	"-outerSystem, +planetary"
			>

		<Names noArticle="true">Antares Fuel; Bapco Fuel; Cerulean Energy;
				Dilithium Fuels, rce; Energy Supplies, rce; Fentano Fuels;
				Gargantua Fuel Systems; Herenix Fuel &amp; Energy; Impala Refueling;
				Jerry's Ship Fuel; Konstantine Fuels; Lexi Starship Fuels; Miranda Fueling Depot;
				Ngari Fuels; Otomo Fuels; Pergium Fuel &amp; Supplies;
				Qi jin Fuels; Revenant Fuels; Sanchez Fuel;
				Tander Fuel &amp; Energy; Urion Fuels; Vanderberg Fuels;
				Wehesaken Fuel Depot; %s Fuel</Names>

		<Image imageID="&rsStations1;" imageX="156" imageY="512" imageWidth="100" imageHeight="192"/>

		<Ships>
			<Lookup count="1d2" table="&tbCorpDefenders;"/>
			<Lookup count="1d4" table="&tbCommPrivateCrafts;"/>
		</Ships>

		<Reinforcements minShips="3">
			<Table>
				<Lookup chance="75" table="&tbCorpDefenders;"/>
				<Lookup chance="25" table="&tbCommPrivateCrafts;"/>
			</Table>
		</Reinforcements>

		<Items>
			<LevelTable count="1d3">
				<Item levelFrequency="cccur v----"	count="4d20"	item="&itHelium3FuelRod;" />
				<Item levelFrequency="-rucc urv--"	count="4d20"	item="&itHeliumAssembly;" />
				<Item levelFrequency="--ruc curv-"	count="4d20"	item="&itXenotiteFuelRod;" />
				<Item levelFrequency="----r uccur"	count="4d20"	item="&itPteracniumFuelRod;" />
				<Item levelFrequency="----- -rucc"	count="4d20"	item="&itHadronVacuumFuelCell;" />
			</LevelTable>
			
			<Item				count="4d20"	item="&itWaterIce;" />
			<Item chance="50"	count="2d20"	item="&itHydrogenGas;" />
			<Item chance="50"	count="2d20"	item="&itLiquidOxygen;" />
			<Item chance="50"	count="1"		item="&itSystemMapROM;" />
		</Items>

		<Trade currency="credit" max="5000" replenish="250">
			<Sell	criteria="fNU +basicFuel; L:1-4; -illegal; -ID; -notForSale;"	priceAdj="90"/>
			<Sell	criteria="*NU -Illegal; -ID; -NotForSale;"	priceAdj="100"/>

			<Refuel			criteria="f +BasicFuel; L:1-4;" priceAdj="90"/>
			<Refuel			criteria="f +BasicFuel; L:5-10;" priceAdj="100"/>

			<ProduceTrade	criteria="{core.fusionFuel}"		impact="20"/>
		</Trade>

		<DockScreens>
			<Main>
				<Panes>
					<Default>
						<OnPaneInit>
							(block (actionStatus)
								(scrSetDescTranslate gScreen 'desc)
								
								(setq actionStatus (rpgCalcDockServiceRefuelAction gSource gPlayerShip { }))
								(scrShowAction gScreen 'actionRefuel (@ actionStatus 'visible))
								(scrEnableAction gScreen 'actionRefuel (@ actionStatus 'enabled))
								(scrSetActionDesc gScreen 'actionRefuel (@ actionStatus 'desc))
								)
						</OnPaneInit>

						<Actions>
							<Action id="actionRefuel" default="1">
								(scrShowScreen gScreen "&dsRPGRefuel;")
							</Action>

							<Action id="actionBuyItems">
								(scrShowScreen gScreen &dsRPGCommoditiesExchangeBuy; {
									checkMilitaryID: True
									})
							</Action>

							<Action id="actionUndock" cancel="1">
								<Exit/>
							</Action>
						</Actions>
					</Default>
				</Panes>
			</Main>
		</DockScreens>

		<DockingPorts>
			<Port x="0"		y="95" />
			<Port x="0"		y="-55" />
			<Port x="50"	y="70" />
			<Port x="50"	y="-30" />
			<Port x="75"	y="10" />
			<Port x="-75"	y="10" />
			<Port x="-50"	y="70" />
			<Port x="-50"	y="-30" />
		</DockingPorts>
		
		<Language>
			<Text id="desc">
				(cat 
					"Welcome to " (objGetName gSource) ", your most reliable source of starship fuel and a member of the Earth Industries Conglomerate.\n\n"
					"All our fuel has been produced to the exacting standards required by today's reactors. Please use the terminal to proceed with your transaction."
					)
			</Text>
        
            <Text id="core.mapDesc">
                "Refuels up to level 10 &mdash; Sells fuel and supplies"
            </Text>
		</Language>

	</StationType>

	<!-- Makayev Factory -->

	<StationType UNID="&stMakayevFactory;"
			name=				"Makayev manufacturing plant"
			sovereign=			"&svCorporate;"
			inherit=			"&baCorporateStation;"

			dockScreen=			"Main"
			abandonedScreen=	"&dsAbandonedStation;"
			dockingPorts=		"8"
			canAttack=			"true"

			multiHull=			"true"
			armorID=			"&itAdvancedPlasteelPlate;"
			hitPoints=			"1890"
			regen=              "19"
			fireRateAdj=		"15"
			explosionType=		"&vtThermoExplosion3;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"corporate, corporateArms, corporateCustoms, envAir, envEarth, envFire, envWater, friendly, independent, generic, human, majorStation, Makayev, populated"
			levelFrequency=		"----- rrur- ----- ----- -----"
			unique=				"inSystem"
			locationCriteria=	"+planetary"
			enemyExclusionRadius="75"
			>

		<Image imageID="&rsMakayevFactory;" imageX="0" imageY="0" imageWidth="150" imageHeight="256"/>

		<Ships>
			<Ship	count="1" class="&scManticore;" orders="guard"/>
			<Lookup count="1" table="&tbCorpDefenders;"/>
			<Lookup count="1d4" table="&tbCommPrivateCrafts;"/>
		</Ships>

		<Reinforcements minShips="4">
			<Table>
				<Ship	chance="40" class="&scManticore;" orders="guard"/>
				<Lookup chance="35" table="&tbCorpDefenders;"/>
				<Lookup chance="25" table="&tbCommPrivateCrafts;"/>
			</Table>
		</Reinforcements>

		<Devices>
			<Device deviceID="&itMarkVHowitzer;"	omnidirectional="true"/>
		</Devices>

		<Items>
			<RandomItem count="2d3"
					criteria=		"w L:1-10; +Makayev; -NotForSale;"
					levelFrequency=	"systemLevel:uc|c|crv"
					enhanced=		"20"
					enhancement=	"=(intMakayevWeaponEnhancement)"
					/>

			<RandomItem count="2d6"
					criteria=		"a L:1-10; +Makayev; -NotForSale;"
					levelFrequency=	"systemLevel:uc|c|crv"
					enhanced=		"20"
					enhancement=	"=(intMakayevArmorEnhancement)"
					/>

			<RandomItem count="2d3"
					criteria=		"w L:1-10; +Makayev; -NotForSale;"
					levelFrequency=	"systemLevel:u|c|cur"
					enhanced=		"10"
					enhancement=	"=(intMakayevWeaponEnhancement)"
					/>

			<RandomItem count="2d6"
					criteria=		"a L:1-10; +Makayev; -NotForSale;"
					levelFrequency=	"systemLevel:u|c|cur"
					enhanced=		"10"
					enhancement=	"=(intMakayevArmorEnhancement)"
					/>

			<RandomItem count="1d4"
					criteria=		"d~w L:1-10; +Makayev; -NotForSale;"
					levelFrequency=	"systemLevel:rucc|c|ur"
					/>
		</Items>

		<Trade currency="credit" max="100000" replenish="5000">
			<Sell	criteria="m +makayev; -illegal; -notForSale;" priceAdj="100" inventoryAdj="800" levelFrequency="systemLevel:ruc|c|cur"/>
			<Sell	criteria="*NU +makayev; -Illegal; -ID; -NotForSale;"	priceAdj="100"/>

			<Refuel			criteria="f +BasicFuel; L:1-10;" priceAdj="100"/>
			<RepairArmor	criteria="a L:1-9;" priceAdj="100"/>
			<ReplaceArmor	criteria="a +makayev;" priceAdj="100"/>
			<InstallDevice	criteria="d +makayev;" priceAdj="100"/>
			<RemoveDevice	criteria="d L:1-10;" priceAdj="100"/>
			
			<ReplaceArmor	criteria="a L:1-10;" priceAdj="unavailable"	messageID="descNoInstall"/>
			<InstallDevice	criteria="d L:1-10;" priceAdj="unavailable"	messageID="descNoInstall"/>

			<ConsumeTrade	criteria="{core.antimatterFuel}"	impact="3"/>
			<ConsumeTrade	criteria="{human.res}"		impact="3"/>
			<ConsumeTrade	criteria="{core.ore}"			impact="3"/>
		</Trade>

		<StaticData>
			<NPCService>
				(	;	service					level	margin
					(	'repairArmor			9		100		)
					)
			</NPCService>
		</StaticData>

		<Events>
			<OnContractGenerate>
				(intGenerateIndustrialRequestContract1)
			</OnContractGenerate>

			<OnContractQuery>True</OnContractQuery>
		</Events>

		<DockScreens>
			<Main>
				<Panes>
					<Default descID="descWelcome">
						<Actions>
							<Action id="actionDockServices" default="1">
								(rpgDockServices gPlayerShip {
									checkMilitaryID: True
									})
							</Action>

							<Action id="actionBuyItems">
								(scrShowScreen gScreen &dsRPGCommoditiesExchangeBuy; {
									checkMilitaryID: True
									})
							</Action>

							<Action id="actionRepairItems">
								(scrShowScreen gScreen "&dsRPGRepairItem;" {
									criteria: "*~aD +Makayev;"
									priceAdj: 65
									})
							</Action>

							<Action id="actionUndock" cancel="1">
								<Exit/>
							</Action>
						</Actions>

					</Default>
				</Panes>
			</Main>
		</DockScreens>

		<DockingPorts>
			<Port x="22"	y="86" />
			<Port x="56"	y="35" />
			<Port x="69"	y="-39" />
			<Port x="33"	y="-75" />
			<Port x="-33"	y="-75" />
			
			<Port x="-69"	y="-39" />
			<Port x="-56"	y="35" />
			<Port x="-22"	y="86" />
		</DockingPorts>

		<Language>
			<Text id="descWelcome">
				Welcome to Makayev-Energia!
			</Text>
			<Text id="descNoInstall">
				(cat
					"We only install Makayev items. "
					"We cannot install " (itmGetName (@ gData 'item) 0x04) " on your ship."
					)
			</Text>
			<Text id="dockServices:installAbility">
				(cat "We install Makayev items up to tech level " (objGetProperty gSource 'installDeviceMaxLevel) ".")
			</Text>
            
            <Text id="core.mapDesc">
                "Refuels up to level 10 &mdash; Repairs/installs Makayev armor up to level 9 &mdash; Installs Makayev devices up to level 9 &mdash; Sells Makayev weapons and ammo"
            </Text>
		</Language>

	</StationType>

	<!-- Manufacturing Plant
	
	EXTRA DATA

	itemsConsumed:		List of item types that we consume
	itemsConsumedDesc:	Description of the items that we want to buy
	itemsCreated:		List of item types that we create
	maxInventory:		Max credits worth of items to stock	
	
	-->

	<StationType UNID="&stManufacturingPlant;"
			name=				"corporate manufacturing plant"
			sovereign=			"&svCorporate;"
			inherit=			"&baCorporateStation;"

			dockScreen=			"Main"
			abandonedScreen=	"&dsAbandonedStation;"
			dockingPorts=		"8"
			canAttack=			"true"

			multiHull=			"true"
			armorID=			"&itCeralloyArmor;"
			hitPoints=			"630"
			regen=              "6"
			explosionType=		"&vtBlastExplosion3;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"corporate, corporateCustoms, friendly, independent, generic, human, majorStation, populated"
			levelFrequency=		"-uuuu r---- ----- ----- -----"
			unique=				"inSystem"
			locationCriteria=	"-planetary"
			>
			
		<Names noArticle="true">Arcoter Industrials; Bosen-Haggen Manufacturing; Cloud9 Industrials;
			Dai-chi Plant %1%0; Electrox Manufacturing; Fahrenheit Technologies; Geotron Industries;
			Honoku-Tomashi Plant %1%0%0; Irene Sanchez Factory; Jorrell Scientific Plant %1%0%0;
			Kestrel Industrials; Lamar Industries; Marina-Maxwell Factory %1%0%0; Nordic Industrials;
			Oceana Manufacturing; Blue Planet Facility %1%0%0; Reich &amp; Balham Plant %1%0%0;
			Senpaku Hogei Manufacturing; Thalmann Industries; Ursa Majoris Manufacturing;
			Ventabot Manufacturing; WIZ Manufacturing; Yollensgard Industrials; Z%1 Manufacturing
		</Names>

		<Image			imageID="&rsManufacturingPlant;" imageWidth="150" imageHeight="220"/>

		<Ships>
			<Lookup count="1d4+2" table="&tbCommPrivateCrafts;"/>
		</Ships>

		<Trade currency="credit" max="50000" replenish="2500">
		</Trade>

		<Events>
			<OnContractGenerate>
				(intGenerateIndustrialRequestContract1)
			</OnContractGenerate>

			<OnContractQuery>True</OnContractQuery>
			
			<OnCreate>
				(block (
					;	We have different kinds of manufacturing plants

					(allTypes (list

						;	Food Manufacturing

						{
							produces: "t +food; -lux; -res; -fuel; -ID; -illegal; -art; -antique; -alien; -notForSale; F:curv; &gt;$0 &lt;=$500 &lt;=6"
							consumes: "t +res; -ore; -illegal; -notForSale; F:curv; &lt;=$250"

							tradeProd: "{human.basicFood}"
							tradeCons: "{human.res}"
							}

						;	Luxury Manufacturing

						{
							produces: "t +lux; -res; -fuel; -ID; -illegal; -art; -antique; -alien; -notForSale; F:curv; &gt;$0 &lt;=$500 &lt;=6"
							consumes: "t +res; -ore; -illegal; -notForSale; F:curv; &lt;=$500"

							tradeProd: "{human.lux}"
							tradeCons: "{human.res}"
							}

						;	Industrial Resource Manufacturing

						{
							produces: "t +res; -ore; -fuel; -ID; -illegal; -art; -antique; -alien; -notForSale; F:curv; &gt;$0 &lt;=$500 &lt;=6"
							consumes: "t +ore; -illegal; -notForSale; F:cu; &lt;=$250"

							tradeProd: "{human.res}"
							tradeCons: "{core.ore}"
							}
						))

					;	Pick a random type

					(facDesc (random allTypes))

					(maxInventory (multiply (random 1000 2000) (sysGetLevel)))

					allItems itemsCreated itemsConsumed buyDesc totalItems
					)

					;	Pick the items that we manufacture

					(setq allItems (shuffle (itmGetTypes (@ facDesc 'produces))))
					(setq totalItems (min (random 3 5) (count allItems)))
					(for i 1 totalItems
						(block (theType thePrice theCount)
							(setq theType (item allItems (subtract i 1)))
							(setq itemsCreated (append itemsCreated theType))
							
							; Create items
							(setq theCount (divide maxInventory (itmGetPrice (itmCreate theType 1) 'credit)))
							(objAddItem gSource	(itmCreate theType theCount))
								
							; Set trade line
							(objAddSellOrder gSource theType (random '(50 70 80 80 85 85 85 85 90)))
							)
						)
					(objSetData gSource "itemsCreated" itemsCreated)
						
					;	Pick the items that we consume

					(setq allItems (shuffle (itmGetTypes (@ facDesc 'consumes))))
					(setq totalItems (min (random 2 4) (count allItems)))
					(for i 1 totalItems
						(block (theType)
							(setq theType (item allItems (subtract i 1)))
							(setq itemsConsumed (append itemsConsumed theType))
							
							; Set trade line
							(objAddBuyOrder gSource theType (random '(150 130 120 120 115 115 115 110)))
							
							; Compose a line telling the player what we will buy
							(if (eq i 1)
								(setq buyDesc (cat "We are looking to buy " (itmGetName (itmCreate theType 1) 0x82)))
								(setq buyDesc (cat buyDesc
									(if (eq i totalItems) " and " ", ")
									(itmGetName (itmCreate theType 1) 0x82)
									(if (eq i totalItems) "." "")
									))
								)
							)
						)

					;	Add trade orders for system-wide price impacts

					(objAddTradeOrder gSource 'produceTrade (@ facDesc 'tradeProd) 10)
					(objAddTradeOrder gSource 'consumeTrade (@ facDesc 'tradeCons) 10)

					;	Remember some values

					(objSetData gSource "itemsConsumed" itemsConsumed)
					(objSetData gSource "itemsConsumedDesc" buyDesc)
					(objSetData gSource "maxInventory" maxInventory)
					
					;	Register a timer so that we can resupply

					(sysAddObjRecurringTimerEvent 9000 gSource "OnManufacture")
					)
			</OnCreate>

			<OnManufacture>
				(block (totalConsumed manufactureRun)
					; Consume raw materials (and keep track of how much we are consuming)
					(setq totalConsumed 0)
					(enum (objGetItems gSource "*U +Res;") theItem
						(block Nil
							(setq totalConsumed (add totalConsumed (multiply (itmGetPrice theItem 'credit) (itmGetCount theItem))))
							(objRemoveItem gSource theItem)
							)
						)
						
					; Manufacture
					(setq manufactureRun (divide totalConsumed 5))
					(if (gr totalConsumed 0)
						(for i 1 5
							(block (theType theCount)
								(setq theType (random (objGetData gSource "itemsCreated")))
								(setq theCount (divide manufactureRun (itmGetPrice (itmCreate theType 1) 'credit)))
								(objAddItem gSource (itmCreate theType (max 1 theCount)))
								)
							)
						)
					)
			</OnManufacture>
		</Events>

		<DockScreens>
			<Main>
				<Panes>
					<Default>
					
						<OnPaneInit>
							(scrSetDesc gScreen
								"You are in the docking level of a corporate manufacturing plant. The station master greets you:\n\n"
								"\"Welcome to our manufacturing facilities! "
								(objGetData gSource "itemsConsumedDesc")
								"\""
								)
						</OnPaneInit>

						<Actions>
							<Action id="actionBuyItems" default="1">
								(scrShowScreen gScreen &dsRPGCommoditiesExchangeBuy; {
									checkMilitaryID: True
									})
							</Action>
							
							<Action id="actionSellItems">
								(scrShowScreen gScreen &dsRPGCommoditiesExchangeSell; {
									})
							</Action>
							
							<Action id="actionUndock" cancel="1">
								<Exit/>
							</Action>

						</Actions>

					</Default>
				</Panes>
			</Main>
		</DockScreens>

		<DockingPorts>
			<Port x="0"		y="101" />
			<Port x="67"	y="56" />
			<Port x="99"	y="-9" />
			<Port x="72"	y="-84" />
			<Port x="0"		y="-108" />
			<Port x="-72"	y="-84" />
			<Port x="-99"	y="-9" />
			<Port x="-67"	y="56" />
		</DockingPorts>

        <Language>
            <Text id="core.mapDescCustom">
                (block (
                    (itemsConsumed (objGetData gSource 'itemsConsumed))
                    (itemsCreated (objGetData gSource 'itemsCreated))
                    )
                    
                    (cat
                        "Buys " (join (map itemsConsumed theType (itmGetName theType 0x82)) 'oxfordComma) " &mdash; "
                        "Sells " (join (map itemsCreated theType (itmGetName theType 0x82)) 'oxfordComma)
                        )
                    )
            </Text>
        </Language>
	</StationType>

	<!-- Merchant Prince Hotel -->

	<StationType UNID="&stHotel;"
			name=				"corporate hotel"
			sovereign=			"&svCorporate;"
			inherit=			"&baCorporateStation;"

			dockScreen=			"Main"
			abandonedScreen=	"&dsAbandonedStation;"
			canAttack=			"true"

			level=				"4"
			multiHull=			"true"
			armorID=			"&itCeralloyArmor;"
			hitPoints=			"160"
			regen=				"4"
			explosionType=		"&vtBlastExplosion2;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"corporate, corporateCustoms, envAir, envEarth, envFire, envWater, friendly, independent, generic, human, majorStation, populated"
			levelFrequency=		"uuurr v---- ----- ----- -----"
			locationCriteria=	"*"
			>

		<Names definiteArticle="true">Beta Gemini Hotel; Honoku-Tomashi Hotel; Manchurian Oriental Hotel;
				Merchant Prince Hotel; Savanna Hotel; Seven Sisters Hotel;
				Virgin %s Hotel; %s Interstellar Hotel</Names>

		<Image			imageID="&rsStations2;" imageX="0" imageY="256" imageWidth="192" imageHeight="256"/>

		<Ships>
			<Lookup count="1d2" table="&tbCorpDefenders;"/>
			<Lookup count="1d4" table="&tbCommPrivateCrafts;"/>
		</Ships>

		<Trade currency="credit" max="25000" replenish="1250">
			<Buy	criteria="*NU +Lux; -Illegal;"	priceAdj="105"/>
			<Buy	criteria="*NU +Food; -Illegal;"	priceAdj="105"/>
			<Buy	criteria="*NU" item="&itWaterIce;"		priceAdj="105"/>
			<Buy	criteria="*NU" item="&itStimuzine;"		priceAdj="105"/>
			<Buy	criteria="*NU" item="&itMedicalSupplies;"		priceAdj="105"/>
			<Buy	criteria="*NU" item="&itBiofactorPaste;"		priceAdj="105"/>
			<Buy	criteria="*NU" item="&itHypermycin;"		priceAdj="105"/>

			<ConsumeTrade	criteria="{core.fusionFuel}"		impact="2"/>
			<ConsumeTrade	criteria="{human.lux}"		impact="5"/>
		</Trade>

		<Events>
			<OnContractGenerate>
				(intGenerateIndustrialRequestContract1)
			</OnContractGenerate>

			<OnContractQuery>True</OnContractQuery>

			<GetRumors>
				{
					attributes: "commonwealthPub"
					priority: 24
					textID: 'rumor.commonwealthPub
					data: {station: (objGetName gSource)}
					onExitRumor: (lambda (theRumor) (objSetKnown (@ theRumor 'sourceObj)))
					}
			</GetRumors>
		</Events>

		<DockScreens>
			<Main>
				<Panes>
					<Default>
						<OnPaneInit>
							(scrSetDesc gScreen (cat "Welcome to " (objGetName gSource 4) "."))
						</OnPaneInit>

						<Actions>
							<Action id="actionRestaurant">
								(rpgMissionAssignment {
									missionCriteria: (cat "n +corporateHotel; =" (sysGetLevel) ";")
									noMissionTextID:
										(if (objGetItems gPlayerShip "* +BlackMarketID;")
											'descRestaurantRespect
											'descRestaurantNoRespect
											)
									maxPerStation: 1
									})
							</Action>

							<Action id="actionLoadingDock">
								<Navigate screen="LoadingDock"/>
							</Action>

							<Action id="actionUndock" cancel="1">
								<Exit/>
							</Action>
						</Actions>
					</Default>
				</Panes>
			</Main>

			<LoadingDock>

				<Panes>
					<Default>
						<OnPaneInit>
							(scrSetDesc gScreen (cat "You are in the loading dock of " (objGetName gSource 4) "."))
						</OnPaneInit>

						<Actions>
							<Action id="actionSellItems" default="1">
								(scrShowScreen gScreen &dsRPGCommoditiesExchangeSell; {
									})
							</Action>

							<Action id="actionLeave" cancel="1">
								<Navigate screen="Main"/>
							</Action>
						</Actions>
					</Default>
				</Panes>

			</LoadingDock>

		</DockScreens>

		<DockingPorts>
			<Port x="0"		y="-90" />
			<Port x="96"	y="-70" />
			<Port x="-96"	y="-70" />
			<Port x="105"	y="-25" />
			<Port x="-105"	y="-25" />
			<Port x="68"	y="-100" />
			<Port x="-68"	y="-100" />
			<Port x="70"	y="25" />
			<Port x="-70"	y="25" />
		</DockingPorts>

        <Language>
			<Text id="actionRestaurant">"[R]estaurant"</Text>
			<Text id="actionLoadingDock">"[L]oading Dock"</Text>

			<Text id="descRestaurantRespect">
				As you enter the restaurant the maitre d' welcomes you warmly and shows
				you to a table. Envious patrons look on while you eat a wonderful dish
				of Hogei Salmon with organic yams and sweet plum sauce.
			</Text>
			<Text id="descRestaurantNoRespect">
				The maitre d' leaves you waiting for several minutes. When he finally
				turns to you he coldly tells you that there are no tables available.
				You feel out of place here.
			</Text>

			<Text id="rumor.commonwealthPub">
				You talk to a corporate woman staying at the %station%. She drones on
				about the excellent service. You spend 5 credits on drinks.
			</Text>

            <Text id="core.mapDesc">"Buys food, luxuries, and meds"</Text>
        </Language>
	</StationType>

	<!-- Ice Farm -->

	<StationType UNID="&stIceFarm;"
			name=				"corporate ice farm"
			sovereign=			"&svCorporate;"
			inherit=			"&baCorporateStation;"

			dockScreen=			"Main"
			abandonedScreen=	"&dsAbandonedStation;"
			dockingPorts=		"8"
			canAttack=			"true"

			multiHull=			"true"
			armorID=			"&itPlasteelPlate;"
			hitPoints=			"120"
			regen=              "1"
			explosionType=		"&vtBlastExplosion1;"
			ejectaType=			"&vtIceAsteroidEjecta;"

			attributes=			"asteroidBase, corporate, corporateCustoms, envAir, envAvoidsFire, friendly, independent, generic, human, populated"
			levelFrequency=		"rccuu rv--- ----- ----- -----"
			locationCriteria=	"++outerSystem"
			>

		<Image			imageID="&rsStations1;" imageX="512" imageY="384" imageWidth="128" imageHeight="128"/>

		<Ships>
			<Ship			count="1d3+1"	class="&scTenhoveSentinel;"	orders="patrol" patrolDist="5"/>
		</Ships>

		<Items>
			<Item				count="4d12"	item="&itEuropanIceMoss;" />
			<Item				count="1d12"	item="&itEuropanIceVodka;" />
			<Item chance="50"	count="2d12"	item="&itHogeiSalmon;" />
		</Items>

		<Trade currency="credit" max="10000" replenish="500">
			<Sell	criteria="*NU +Lux; -NotForSale;"	priceAdj="100"/>

			<Buy	criteria="*NU +Food; -Illegal; &lt;=$100 -NotForSale;"	priceAdj="105"/>
			<Buy	criteria="*NU" item="&itHydrocarbons;"		priceAdj="105"/>
			<Buy	criteria="*NU" item="&itHelium3FuelRod;"	priceAdj="105"/>
			<Buy	criteria="*NU" item="&itOrganicAcid;"		priceAdj="105"/>
			<Buy	criteria="*NU" item="&itMedicalSupplies;"	priceAdj="105"/>
			<Buy	criteria="*NU" item="&itHyperfiberRoll;"	priceAdj="105"/>
			<Buy	criteria="*NU" item="&itBiofactorPaste;"	priceAdj="105"/>

			<ConsumeTrade	criteria="{core.fusionFuel}"		impact="1"/>
			<ConsumeTrade	criteria="{human.res}"		impact="1"/>

			<ProduceTrade	criteria="{human.basicFood}"	impact="10"/>
		</Trade>

		<Events>
			<OnContractGenerate>
				(intGenerateIndustrialRequestContract1)
			</OnContractGenerate>

			<OnContractQuery>True</OnContractQuery>
		</Events>

		<DockScreens>
			<Main
				name=			"Ice Farm"
				>

				<Panes>
					<Default descID="descWelcome">
						<Actions>
							<Action id="actionBuyItems" default="1">
								(scrShowScreen gScreen &dsRPGCommoditiesExchangeBuy; {
									checkMilitaryID: True
									})
							</Action>

							<Action id="actionSellItems">
								(scrShowScreen gScreen &dsRPGCommoditiesExchangeSell; {
									})
							</Action>

							<Action id="actionUndock" cancel="1">
								<Exit/>
							</Action>

						</Actions>

					</Default>
				</Panes>
			</Main>

		</DockScreens>

		<DockingPorts>
			<Port x="0"		y="40" />
			<Port x="0"		y="-60" />
			<Port x="60"	y="0" />
			<Port x="-60"	y="0" />
			<Port x="-60"	y="60" />
			<Port x="60"	y="-60" />
			<Port x="40"	y="-40" />
			<Port x="-40"	y="-40" />
		</DockingPorts>

        <Language>
			<Text id="descWelcome">

				You are docked at an independent ice farm on a small asteroid. 
				Cold and stale air blows out of a wheezing recycler and you 
				hear the drone of struggling generators and pumps.

			</Text>
            <Text id="core.mapDesc">"Sells luxuries &mdash; Buys food and supplies"</Text>
        </Language>
	</StationType>

	<!-- Insurance Company

	GLOBAL DATA

	claims:			Number of times player has been resurrected
	insured:		True if player is insured

	-->

	<StationType UNID="&stInsuranceCompany;"
			name=				":the Clavius Insurance Conglomerate|Clavius Insurance Conglomerate"
			sovereign=			"&svCorporate;"
			inherit=			"&baCorporateStation;"

			dockScreen=			"Main"
			abandonedScreen=	"&dsAbandonedStation;"
			dockingPorts=		"8"
			canAttack=			"true"

			multiHull=			"true"
			armorID=			"&itCeralloyArmor;"
			hitPoints=			"250"
			regen=				"2"
			explosionType=		"&vtBlastExplosion2;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"corporate, corporateCustoms, corporateInsurance, envAir, envEarth, envFire, envWater, friendly, independent, generic, human, populated"
			levelFrequency=		"-rrru r---- ----- ----- -----"
			unique=				"inSystem"
			locationCriteria=	"+planetary"
			>

		<Image			imageID="&rsStations2;" imageX="0" imageY="0" imageWidth="128" imageHeight="256"/>

		<Ships>
			<Lookup count="1d4+2" table="&tbCommPrivateCrafts;"/>
		</Ships>

		<Events>
			<GetGlobalResurrectPotential>
				(switch
					; If not insured, we never resurrect
					(not (typGetGlobalData &stInsuranceCompany; "insured"))
						0

					; We never resurrect in Huaramarca or Elysium
					(or (eq (sysGetNode) 'Huaramarca)
						(eq (sysGetNode) 'Elysium))
						0

					; If there are corporate stations in the system, then we are highly likely
					; to resurrect the player
					(sysFindObject Nil "TA +corporate;")
						100

					; Otherwise, we are not very likely (we'll only resurrect if no one else can help)
					1
					)
			</GetGlobalResurrectPotential>

			<OnGlobalResurrect>
				(block (rescueObj)
					; Increase claims
					(typIncGlobalData &stInsuranceCompany; "claims")
					(typSetGlobalData &stInsuranceCompany; "insured" Nil)

					; Restore the ship					
					(switch
						; If the player ship has custom insurance code, then we 
						; don't do anything more.
						(objFireEvent gPlayerShip 'OnInsuranceClaim)
							Nil
						
						; Put the player in a safe place and repair the ship
						(rpgRestorePlayer)
						)

					; Create a rescue ship nearby
					(setq rescueObj (sysCreateShip 
						&scCorporateCruiser; 
						(sysVectorRandom gPlayerShip 5 5 "TA")
						&svCorporate;
						))

					(shpOrder rescueObj 'wait Nil 5)
					(shpOrder rescueObj 'gate)
					(objSendMessage gPlayerShip rescueObj "Insurance claim processed. Have a better one!")
					)
			</OnGlobalResurrect>

			<OnContractGenerate>
				(intGenerateIndustrialRequestContract1)
			</OnContractGenerate>

			<OnContractQuery>True</OnContractQuery>
		</Events>

		<DockScreens>
			<Main>
				<Panes>
					<Default>
						<OnPaneInit>
							(scrSetDesc gScreen (cat "Welcome to the " (sysGetName) " branch of the Clavius Insurance Conglomerate. Since 2071 we have been providing hazard insurance services to freelancers and entrepreneurs throughout Human Space."))
						</OnPaneInit>

						<Actions>
							<Action name="Purchase Insurance" default="1" key="P">
								(switch
									(objGetGlobalData gSource "insured")
										(scrShowPane gScreen "AlreadyInsured")

									(geq (objGetGlobalData gSource "claims") 3)
										(scrShowPane gScreen "TooRisky")

									(scrShowPane gScreen "BuyInsurance")
									)
							</Action>

							<Action id="actionUndock" cancel="1">
								<Exit/>
							</Action>

						</Actions>

					</Default>

					<AlreadyInsured descID="descAlreadyInsured">
						<Actions>
							<Action id="actionContinue" cancel="1" default="1">
								<ShowPane pane="Default"/>
							</Action>

						</Actions>

					</AlreadyInsured>

					<TooRisky descID="descTooRisky">
						<Actions>
							<Action id="actionContinue" cancel="1" default="1">
								<ShowPane pane="Default"/>
							</Action>

						</Actions>

					</TooRisky>

					<BuyInsurance>
						<OnPaneInit>
							(block (desc claims priceAdj)
								(setq claims (objGetGlobalData gSource "claims"))

								; Compute the price based on prior claims

								(switch
									(or (not claims) (eq claims 0))
										(setq gCost 10000)

									(eq claims 1)
										(setq gCost 50000)

									(eq claims 2)
										(setq gCost 100000)

									(setq gCost 1000000)
									)

								; Include any global adjustments

								(if (setq priceAdj (objGetPlayerPriceAdj gSource { type:'corporateInsurance priorClaims:(if claims claims 0) }))
									(setq gCost (divide (multiply gCost priceAdj) 100))
									)

								; Compose text

								(setq desc (cat 
									"\"Our conglomerate specializes in providing full personal and property coverage against death and destruction. "
									"Claims are settled by full replacement of life and property, including resuscitation and cloning.\n\n"
									))

								(switch
									(not priceAdj)
										(setq desc (cat desc "\"Based on your risk profile we can offer you full coverage for " gCost " credits. "))

									(eq gCost 0)
										(setq desc (cat desc 
											"\"With your corporate discount we can offer you full coverage for...let me see..."
											"wow, you must have some powerful friends! We can offer you full coverage free of charge! "
											))
										
									(setq desc (cat desc "\"With your corporate discount we can offer you full coverage for " gCost " credits. "))
									)

								(switch
									(eq gCost 0)
										(scrSetDesc gScreen desc "Do you wish to accept our offer?\"")
										
									(ls (plyGetCredits gPlayer) gCost)
										(block Nil
											(scrSetDesc gScreen desc
												"Unfortunately, you cannot afford this service currently, but we urge you to return as soon as your financial situation improves.\""
												)
											(scrEnableAction gScreen 0 Nil)
											)

									(scrSetDesc gScreen desc "Do you wish to purchase this service?\"")
									)
								)
						</OnPaneInit>

						<Actions>
							<Action name="Purchase" default="1" key="P">
								(if (geq (plyGetCredits gPlayer) gCost)
									(block Nil
										(objSetGlobalData gSource "insured" True)
										(plyCharge gPlayer gCost)
										(scrShowPane gScreen "Done")
										)
									)
							</Action>

							<Action id="actionCancel" cancel="1">
								<ShowPane pane="Default"/>
							</Action>
						</Actions>

					</BuyInsurance>

					<Done descID="descThankYou">
						<Actions>
							<Action id="actionContinue" cancel="1" default="1">
								<ShowPane pane="Default"/>
							</Action>
						</Actions>
					</Done>
				</Panes>
			</Main>

		</DockScreens>

		<DockingPorts>
			<Port x="0"		y="135" />
			<Port x="0"		y="-15" />
			<Port x="50"	y="110" />
			<Port x="50"	y="10" />
			<Port x="75"	y="60" />
			<Port x="-75"	y="60" />
			<Port x="-50"	y="110" />
			<Port x="-50"	y="10" />
		</DockingPorts>

        <Language>
			<Text id="descAlreadyInsured">

				You are already insured by our conglomerate. Rest assured that 
				you are protected against all losses by the most comprehensive 
				insurance in the Commonwealth.

			</Text>
			<Text id="descTooRisky">

				Unfortunately, we do not have an insurance product suitable for 
				the risky lifestyle that you lead.

			</Text>
			<Text id="descThankYou">

				"Thank you for your purchase. We wish you a long and happy life, 
				secure in the knowledge that the oldest and most powerful 
				insurance conglomerate stands behind you."

			</Text>
            <Text id="core.mapDesc">
                "Life insurance policies"
            </Text>
        </Language>
	</StationType>

	<!-- Taikon Ventures -->

	<StationType UNID="&stTaikonVentures;"
			name=				": Taikon Ventures|Taikon Ventures"
			sovereign=			"&svCorporate;"
			inherit=			"&baCorporateStation;"

			dockScreen=			"Main"
			abandonedScreen=	"&dsAbandonedStation;"
			dockingPorts=		"8"
			canAttack=			"true"

			multiHull=			"true"
			armorID=			"&itQuadroCarbideArmor;"
			hitPoints=			"470"
			regen=              "5"
			fireRateAdj=		"10"
			explosionType=		"&vtThermoExplosion2;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"corporate, corporateArms, corporateCustoms, envAir, envEarth, envFire, envWater, friendly, independent, generic, human, populated"
			levelFrequency=		"----- -uur- ----- ----- -----"
			locationCriteria=	"+planetary"
			enemyExclusionRadius="75"
			>

		<Image			imageID="&rsStations8;" imageX="0" imageY="448" imageWidth="128" imageHeight="192"/>

		<Ships>
			<Ship chance="75" class="&scBritannia;" orders="guard"/>
			<Lookup count="2" table="&tbCorpDefenders;"/>
			<Lookup count="1d4" table="&tbCommPrivateCrafts;"/>
		</Ships>

		<Reinforcements minShips="4">
			<Table>
				<Lookup chance="75" table="&tbCorpDefenders;"/>
				<Lookup chance="25" table="&tbCommPrivateCrafts;"/>
			</Table>
		</Reinforcements>

		<Devices>
			<Device deviceID="&itHeavyIonBlaster;"	omnidirectional="true"/>
		</Devices>

		<Items>
			<RandomItem count="1d6" 
					criteria=		"d L:1-11; +Taikon; -NotStandard; -NotForSale"
					levelFrequency=	"systemLevel:ru|c|ur"
					/>
			<RandomItem count="1d6" 
					criteria=		"a L:1-11; +Taikon; -NotStandard; -NotForSale"
					levelFrequency=	"systemLevel:ru|c|ur"
					/>
			<RandomItem count="3d6" 
					criteria=		"m +Taikon; -illegal; -NotStandard; -NotForSale"
					levelFrequency=	"systemLevel:ru|c|ur"
					/>
			<RandomItem count="1d6" 
					criteria=		"* L:1-11; -illegal; -NotStandard; -NotForSale;"
					levelFrequency=	"systemLevel:ru|c|u"
					/>
			<RandomItem count="2d6" 
					criteria=		"*~ad -Alien; -illegal; -NotStandard; -NotForSale;"
					levelFrequency=	"systemLevel:ru|c|u"
					/>
			<RandomItem count="1d3" 
					criteria=		"* L:1-11; +Alien; -illegal; -NotStandard; -NotForSale;"
					levelFrequency=	"systemLevel:u|c|ur"
					/>
			<Item	count="6d12" item="&itPteracniumFuelRod;"/>
		</Items>

		<Trade currency="rin" max="100000" replenish="5000">
			<Sell	criteria="*NU +Taikon;"				priceAdj="100"/>
			<Sell	criteria="*NU +RingerValuable;"		priceAdj="250"/>
			<Sell	criteria="*NU +Alien;"				priceAdj="120"/>
			<Sell	criteria="*NU -ID;"					priceAdj="100"/>

			<Refuel			criteria="f +unid:&itPteracniumFuelRod;;" priceAdj="100"/>
			<Refuel			criteria="f +BasicFuel; L:1-10;" priceAdj="100"/>
			<RepairArmor	criteria="a L:1-11;" priceAdj="100"/>
			<ReplaceArmor	criteria="a L:1-11;" priceAdj="100"/>
			<InstallDevice	criteria="d L:1-11;" priceAdj="100"/>
			<RemoveDevice	criteria="d L:1-11;" priceAdj="100"/>
		</Trade>

		<Events>
			<OnContractGenerate>
				(intGenerateIndustrialRequestContract1)
			</OnContractGenerate>

			<OnContractQuery>True</OnContractQuery>
		</Events>

		<DockScreens>
			<Main>
				<Panes>
					<Default descID="descWelcome">
						<Actions>
							<Action id="actionDockServices" default="1">
								(rpgDockServices gPlayerShip {
									checkMilitaryID: True
									})
							</Action>

							<Action id="actionBuyItems">
								(scrShowScreen gScreen &dsRPGCommoditiesExchangeBuy; {
									checkMilitaryID: True
									})
							</Action>

							<Action id="actionUndock" cancel="1">
								<Exit/>
							</Action>

						</Actions>
					</Default>
				</Panes>
			</Main>

		</DockScreens>

		<DockingPorts>
			<Port x="68"	y="35" />
			<Port x="42"	y="-71" />
			<Port x="-74"	y="-39" />
			<Port x="-38"	y="63" />
			<Port x="90"	y="-31" />
			<Port x="-28"	y="-90" />
			<Port x="-101"	y="21" />
			<Port x="36"	y="88" />
		</DockingPorts>

		<Language>
			<Text id="descWelcome">
				You are docked at a Taikon Ventures station.
			</Text>
		</Language>
	</StationType>

	<!-- Trading Post -->

	<StationType UNID="&stCorporateTradingPost;"
			name=				"corporate trading post"
			sovereign=			"&svCorporate;"
			inherit=			"&baCorporateStation;"

			dockScreen=			"Main"
			abandonedScreen=	"&dsAbandonedStation;"
			dockingPorts=		"8"
			canAttack=			"true"

			multiHull=			"true"
			armorID=			"&itAdvancedPlasteelPlate;"
			hitPoints=			"350"
			regen=				"12"
			explosionType=		"&vtBlastExplosion3;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"corporate, corporateCustoms, envAir, envEarth, envFire, envWater, friendly, independent, generic, human, populated"
			levelFrequency=		"---rc uur-- ----- ----- -----"
			locationCriteria=	"+planetary"
			enemyExclusionRadius="50"
			>

		<Image			imageID="&rsStations4;" imageX="0" imageY="448" imageWidth="192" imageHeight="192"/>

		<Animations>
			<Animation x="-39" y="-45">
				<Image	imageID="&rsTradingPostAnimation;" imageX="0" imageY="0" imageWidth="64" imageHeight="80" imageFrameCount="40" imageTicksPerFrame="4" />
			</Animation>
		</Animations>

		<Ships>
			<Lookup count="2" table="&tbCorpDefenders;"/>
			<Lookup count="1d4" table="&tbCommPrivateCrafts;"/>
		</Ships>

		<Reinforcements minShips="4">
			<Table>
				<Lookup chance="75" table="&tbCorpDefenders;"/>
				<Lookup chance="25" table="&tbCommPrivateCrafts;"/>
			</Table>
		</Reinforcements>

		<Items>
			<RandomItem count="20-30" 
					criteria=		"* -Illegal; -Military; -Alien; -Specialty; -NotStandard; -NotForSale;"
					levelFrequency=	"systemLevel:vru|c|urv"
					/>
		</Items>

		<Trade currency="credit" max="250000" replenish="12500">
			<Sell	criteria="*NU -Illegal; -NotForSale; -ID;"	priceAdj="100"/>
			<Buy	criteria="amdNU -Illegal; -NotForSale;"	priceAdj="50"/>
			<Buy	criteria="*NU -Illegal; -ID; -NotForSale;"	priceAdj="90"/>
			<Buy	criteria="*NU -Illegal; -ID;"				priceAdj="10"/>

			<BalanceTrade	criteria="{human.basicFood}"	impact="10"/>
			<BalanceTrade	criteria="{human.lux}"		impact="10"/>
			<BalanceTrade	criteria="{human.res}"		impact="5"/>
		</Trade>

		<Events>
			<OnContractGenerate>
				(intGenerateIndustrialRequestContract1)
			</OnContractGenerate>

			<OnContractQuery>True</OnContractQuery>

			<OnObjDestroyed>
				(if (and (eq (objGetData gSource "MissionStatus") "intransit")
						(eq aObjDestroyed (objGetObjRefData gSource "Transport")))
					(block Nil
						(objSetData gSource "MissionStatus" "failed")
						)
					)
			</OnObjDestroyed>

			<OnObjDocked>
				(if (and (eq (objGetData gSource "MissionStatus") "intransit")
						(eq aObjDocked (objGetObjRefData gSource "Transport"))
						(eq aDockTarget gSource))
					(block Nil
						(objRemoveItem aObjDocked (objGetData gSource "Order"))
						(objSetData gSource "MissionStatus" "arrived")
						)
					)
			</OnObjDocked>
		</Events>

		<DockScreens>
			<Main>
				<Panes>
					<Default descID="descMain">
						<Actions>
							<Action id="actionOrderItems" default="1">
								(switch
									(eq (objGetData gSource "MissionStatus") "intransit")
										(scrShowScreen gScreen "OrderInTransit")

									(eq (objGetData gSource "MissionStatus") "arrived")
										(scrShowScreen gScreen "OrderReady")

									(eq (objGetData gSource "MissionStatus") "failed")
										(scrShowScreen gScreen "OrderFailed")

									; If the player has exceeded quota, then she cannot order
									(geq (objGetData gSource "OrderCount") 1)
										(scrShowScreen gScreen "QuotaExceeded")

									; Show order screen	
									(scrShowScreen gScreen "OrderItem")
									)
							</Action>

							<Action id="actionBuyItems">
								(scrShowScreen gScreen &dsRPGCommoditiesExchangeBuy; {
									checkMilitaryID: True
									})
							</Action>

							<Action id="actionSellItems">
								(scrShowScreen gScreen &dsRPGCommoditiesExchangeSell;)
							</Action>

							<Action id="actionUndock" cancel="1">
								<Exit/>
							</Action>
						</Actions>
					</Default>
				</Panes>
			</Main>

			<OrderItem>
				<Panes>
					<Default
							descID="descOrderDefault"
							showTextInput="true">

						<Actions>
							<Action id="actionSearch" default="1">
								(block (theItem)
									(setq theItem (itmCreateByName "* -Illegal; -Military; -Alien; -ID; -CannotOrder; -NotForSale; &lt;10" (scrGetInputText gScreen) 1))

									(switch
										; If we couldn't understand, say so
										(not theItem)
											(scrShowPane gScreen "UnknownItem")

										; Otherwise, ask for a count
										(block (theCost maxCount)
											(setq theCost (itmGetActualPrice theItem))

											; Add 40% markup
											(setq theCost (divide (multiply theCost 140) 100))

											; Compute max count
											(switch
												(leq (itmGetFrequency theItem) 1)
													(setq maxCount 1)

												(leq (itmGetFrequency theItem) 4)
													(setq maxCount (itmGetMaxAppearing theItem))

												(leq (itmGetFrequency theItem) 10)
													(setq maxCount (multiply 3 (itmGetMaxAppearing theItem)))

												(setq maxCount (multiply 10 (itmGetMaxAppearing theItem)))
												)
												
											(scrSetData gScreen 'orderItem theItem)
											(scrSetData gScreen 'unitCost theCost)
											(scrSetData gScreen 'maxCount maxCount)
											(scrSetData gScreen 'pluralName (itmGetName theItem 0x102))
											(if (gr maxCount 1)
												(scrShowPane gScreen "GetCount")
												(scrShowPane gScreen "OneAvailable")
												)
											)
										)
									)
							</Action>

							<Action id="actionCancelSpecial" cancel="1">
								(scrShowScreen gScreen "Main")
							</Action>
						</Actions>
					</Default>

					<GetCount
							showCounter="true">

						<OnPaneInit>
							(scrSetDescTranslate gScreen 'descGetCount {
								pluralName:(scrGetData gScreen 'pluralName)
								maxCount:(scrGetData gScreen 'maxCount)
								})
						</OnPaneInit>

						<Actions>
							<Action id="actionGetPrice" default="1">
								(switch
									(gr (scrGetCounter gScreen) (scrGetData gScreen 'maxCount))
										(scrSetCounter gScreen (scrGetData gScreen 'maxCount))

									(gr (scrGetCounter gScreen) 0)
										(block Nil
											(scrSetData gScreen 'orderItem (itmSetCount (scrGetData gScreen 'orderItem) (scrGetCounter gScreen)))
											(scrShowPane gScreen "ConfirmOrder")
											)
									)
							</Action>

							<Action id="actionCancel" cancel="1">
								(scrShowPane gScreen "Default")
							</Action>
						</Actions>
					</GetCount>
					
					<OneAvailable>
						<OnPaneInit>
							(scrSetDescTranslate gScreen 'descOneAvailable { pluralName:(scrGetData gScreen 'pluralName) })
						</OnPaneInit>

						<Actions>
							<Action id="actionGetPrice" default="1">
								(scrShowPane gScreen "ConfirmOrder")
							</Action>

							<Action id="actionCancel" cancel="1">
								(scrShowPane gScreen "Default")
							</Action>
						</Actions>
					</OneAvailable>

					<ConfirmOrder>
						<OnPaneInit>
							(block (
								(theItem (scrGetData gScreen 'orderItem))
								(itemCount (itmGetCount theItem))
								(unitCost (scrGetData gScreen 'unitCost))
								(itemsCost (multiply itemCount unitCost))
								; Shipping cost 500 credits per ton
								(shippingCost (multiply 500 (divide (add (multiply (itmGetMass theItem) itemCount) 999) 1000)))
								(totalCost (add itemsCost shippingCost))
								multipleItems finalString
								)
									
								(if (gr itemCount 1)
									(setq multipleItems (scrTranslate gScreen 'priceForMultiple { itemCount:itemCount itemsCost:itemsCost } ))
									(setq multipleItems " ")
									)
								(if (gr totalCost (plyGetCredits gPlayer))
									(block Nil
										(setq finalString (scrTranslate gScreen 'notEnoughCredits))
										(scrEnableAction gScreen 'actionPlaceOrder Nil)
										)
									(setq finalString (scrTranslate gScreen 'confirmOrderQuery))
									)
									
								(scrSetData gScreen 'totalCost totalCost)
								(scrSetDescTranslate gScreen 'descConfirmOrder {
									itemName:(itmGetName theItem 0x108)
									unitCost:unitCost
									multipleItems:multipleItems
									shippingCost:shippingCost
									totalCost:totalCost
									finalString:finalString
									})
								)
						</OnPaneInit>

						<Actions>
							<Action id="actionPlaceOrder" default="1">
								(block (
										; Create a transport at the nearest gate and put the item on it
										(transport (sysCreateShip &scEI100; (objGetNearestStargate gSource) &svCorporate;))
										(theItem (scrGetData gScreen 'orderItem))
										(theCost (scrGetData gScreen 'totalCost))
										)
										
									(objAddItem transport theItem)

									; Order the transport to dock with the station and then gate out
									(shpOrderDock transport gSource)
									(shpOrderWait transport (random 5 10))
									(shpOrderGate transport)

									; Register the transport so we know if it got destroyed
									(objRegisterForEvents gSource transport)

									; Remember the item and the transport
									(objSetData gSource "Order" theItem)
									(objSetObjRefData gSource "Transport" transport)

									; Set the mission status
									(objSetData gSource "MissionStatus" "intransit")

									; Charge the player
									(plyCharge gPlayer theCost)
									(plyRecordBuyItem gPlayer theItem theCost)
									(objIncData gSource "OrderCount" 1)

									(scrShowPane gScreen "ThankYou")
									)
							</Action>

							<Action id="actionCancel" cancel="1">
								(scrShowPane gScreen "Default")
							</Action>
						</Actions>
					</ConfirmOrder>

					<ThankYou descID="descThankYou">
						<Actions>
							<Action id="actionContinue" default="1" cancel="1">
								(scrShowScreen gScreen "Main")
							</Action>
						</Actions>
					</ThankYou>

					<UnknownItem descID="descUnknownItem">
						<Actions>
							<Action id="actionContinue" default="1" cancel="1">
								(scrShowPane gScreen "Default")
							</Action>
						</Actions>
					</UnknownItem>
				</Panes>
			</OrderItem>

			<OrderInTransit>
				<Panes>
					<Default>
						<OnPaneInit>
							(scrSetDescTranslate gScreen 'descInTransit {
								itemName:(itmGetName (objGetData gSource "Order") 0x108)
								distance:(objGetDistance gSource (objGetObjRefData gSource "Transport"))
								})
						</OnPaneInit>

						<Actions>
							<Action id="actionContinue" default="1" cancel="1">
								(scrShowScreen gScreen "Main")
							</Action>
						</Actions>
					</Default>
				</Panes>
			</OrderInTransit>

			<OrderReady>
				<Panes>
					<Default>
						<OnPaneInit>
							(block (
								(theItem (objGetData gSource "Order"))
								(spaceNeeded (multiply (itmGetMass theItem) (itmGetCount theItem)))
								)

								(if (geq (objGetCargoSpaceLeft gPlayerShip) spaceNeeded)
									(block Nil
										(scrSetDescTranslate gScreen 'descOrderReady { itemName:(itmGetName theItem 0x108) })
										(scrSetData gScreen 'canTakeItem True)
										)
									(block Nil
										(scrSetDescTranslate gScreen 'descNoSpace { itemName:(itmGetName theItem 0x108) })
										(scrSetData gScreen 'canTakeItem Nil)
										)
									)
								)
						</OnPaneInit>

						<Actions>
							<Action id="actionContinue" default="1" cancel="1">
								(block Nil
									(if (scrGetData gScreen 'canTakeItem)
										(block Nil
											(itmSetKnown (objGetData gSource "Order"))
											(objAddItem gPlayerShip (objGetData gSource "Order"))
											(objSetData gSource "MissionStatus" Nil)
											)
										)
									(scrShowScreen gScreen "Main")
									)
							</Action>
						</Actions>
					</Default>
				</Panes>
			</OrderReady>

			<OrderFailed>
				<Panes>
					<Default>
						<OnPaneInit>
							(scrSetDescTranslate gScreen 'descOrderFailed { itemName:(itmGetName (objGetData gSource "Order") 0x108) })
						</OnPaneInit>

						<Actions>
							<Action id="actionContinue" default="1" cancel="1">
								(block Nil
									(objSetData gSource "MissionStatus" Nil)
									(scrShowScreen gScreen "Main")
									)
							</Action>
						</Actions>
					</Default>
				</Panes>
			</OrderFailed>

			<QuotaExceeded>
				<Panes>
					<Default descID="descQuotaExceeded">
						<Actions>
							<Action id="actionContinue" default="1" cancel="1">
								(scrShowScreen gScreen "Main")
							</Action>
						</Actions>
					</Default>
				</Panes>
			</QuotaExceeded>

		</DockScreens>

		<DockingPorts>
			<Port x="0"		y="92" />
			<Port x="38"	y="85" />
			<Port x="105"	y="60" />
			<Port x="124"	y="-20" />
			<Port x="64"	y="-92" />
			<Port x="0"		y="-120" />
			<Port x="-102"	y="-66" />
			<Port x="-100"	y="16" />
			<Port x="-84"	y="78" />
		</DockingPorts>

        <Language>
			<Text id="actionOrderItems">[O]rder Items</Text>
			<Text id="actionSearch">[Enter] Search</Text>
			<Text id="actionCancelSpecial">[Esc] Cancel</Text>
			<Text id="actionGetPrice">[G]et Price Quote</Text>
			<Text id="actionPlaceOrder">[P]lace Order</Text>
			
			<Text id="descMain">
				You are docked at a corporate trading post.
			</Text>
			<Text id="descOrderDefault">
				Please enter an item to search for in our catalog database:
			</Text>
			<Text id="descOneAvailable">
				The catalog contains a listing for %pluralName%.
				There is one left in the warehouse.
				
				Do you wish to order it?
			</Text>
			<Text id="descGetCount">
				The catalog contains a listing for %pluralName%.
				There are %maxCount% left in the warehouse.
				
				How many do you wish to order?
			</Text>
			<Text id="descConfirmOrder">
				Order: %itemName%\n
				Unit price: %unitCost% %multipleItems%\n
				Shipping &amp; Handling: %shippingCost%\n
				Total: %totalCost%
				
				%finalString%
			</Text>
			<String id="priceForMultiple">(%itemCount% for %itemsCost%)</String>
			<Text id="notEnoughCredits">
				Unfortunately, you do not have enough credits to complete the order.
			</Text>
			<Text id="confirmOrderQuery">
				Do you wish to place the order?
			</Text>
			<Text id="descThankYou">
				Your order has been placed and will be ready as soon as it arrives. Please check back at this screen to see the status of your order.
			</Text>
			<Text id="descUnknownItem">
				Sorry, there are no items in the catalog matching that description.
			</Text>
			<Text id="descInTransit">
				Your order for %itemName% has been placed and is in route.
				The transport holding your order is currently %distance% light-seconds away.
			</Text>
			<Text id="descOrderReady">
				Your order for %itemName% has arrived and has been placed in your cargo hold.
				
				Thank you for your business!
			</Text>
			<Text id="descNoSpace">
				Your order for %itemName% is ready. Unfortunately, you do not have enough room in your cargo hold. Please return when you have freed up enough room.
			</Text>
			<Text id="descOrderFailed">
				We regret to inform you that your order for %itemName% has been destroyed in transit.
				As we are not liable for losses due to external events, we respectfully recommend that you pursue the matter with your insurance company, if any.
			</Text>
			<Text id="descQuotaExceeded">
				Sorry, only one order per customer!
				
				Please buy our in-stock items or visit another Trading Post at a system near you.
			</Text>
            <Text id="core.mapDescMain">Catalog ordering available</Text>
        </Language>
	</StationType>

	<!-- Wondrous Devices -->

	<StationType UNID="&stWondrousDevices;"
			name=				": Thor's Wondrous Devices|Thor's Wondrous Devices"
			sovereign=			"&svCorporate;"
			inherit=			"&baCorporateStation;"

			dockScreen=			"Main"
			abandonedScreen=	"&dsAbandonedStation;"
			dockingPorts=		"8"
			canAttack=			"true"

			multiHull=			"true"
			armorID=			"&itAdvancedPlasteelPlate;"
			hitPoints=			"350"
			regen=				"6"
			explosionType=		"&vtBlastExplosion3;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"corporate, corporateArms, corporateCustoms, envAir, envEarth, envFire, envWater, friendly, independent, generic, human, populated"
			levelFrequency=		"---ru ur--- ----- ----- -----"
			locationCriteria=	"+planetary"
			enemyExclusionRadius="50"
			>

		<Image			imageID="&rsStations5;" imageX="128" imageY="384" imageWidth="128" imageHeight="256"/>

		<Ships>
			<Lookup count="2" table="&tbCorpDefenders;"/>
			<Lookup count="1d4" table="&tbCommPrivateCrafts;"/>
		</Ships>

		<Reinforcements minShips="4">
			<Table>
				<Lookup chance="75" table="&tbCorpDefenders;"/>
				<Lookup chance="25" table="&tbCommPrivateCrafts;"/>
			</Table>
		</Reinforcements>

		<Items>
			<RandomItem count="20-30" 
					criteria=		"admu L:1-9; -Illegal; -NotStandard; -NotForSale;"
					levelFrequency=	"systemLevel:u|c|crv"
					enhanced=		"5"
					enhancement=	"=(intCorporateGenerateEnhancement gItem)"
					/>
			<RandomItem count="8" 
					criteria=		"admu L:1-9; -Illegal; -NotStandard; -NotForSale;"
					levelFrequency=	"systemLevel:r|u|cur"
					enhanced=		"1"
					enhancement=	"=(intCorporateGenerateEnhancement gItem)"
					/>
		</Items>

		<Trade currency="credit" max="250000" replenish="12500">
			<Sell	criteria="*NU -Illegal; -ID; -NotForSale;"	priceAdj="100"/>
			<Buy	criteria="amdNU -Illegal; -ID; -NotForSale;"	priceAdj="50"/>
			<Buy	criteria="uNU -Illegal; -ID; -NotForSale;"	priceAdj="90"/>
			<Buy	criteria="amduNU -Illegal; -ID;"				priceAdj="10"/>
			
			<Refuel			criteria="f +BasicFuel; L:1-8;" priceAdj="100"/>
			<RepairArmor	criteria="a L:1-8;" priceAdj="100"/>
			<ReplaceArmor	criteria="a L:1-9;" priceAdj="100"/>
			<InstallDevice	criteria="d L:1-9;" priceAdj="100"	upgradeInstallOnly="true"/>
			<RemoveDevice	criteria="d L:1-9;" priceAdj="100"	upgradeInstallOnly="true"/>
		</Trade>

		<Events>
			<OnContractGenerate>
				(intGenerateIndustrialRequestContract1)
			</OnContractGenerate>

			<OnContractQuery>True</OnContractQuery>
		</Events>

		<DockScreens>
			<Main>
				<Panes>
					<Default descID="descWelcome">
						<Actions>
							<Action id="actionDockServices" default="1">
								(rpgDockServices gPlayerShip {
									checkMilitaryID: True
									upgradeInstallOnly: True
									})
							</Action>

							<Action id="actionCommoditiesExchange">
								(scrShowScreen gScreen &dsRPGCommoditiesExchange; {
									checkMilitaryID: True
									})
							</Action>

							<Action id="actionUndock" cancel="1">
								<Exit/>
							</Action>

						</Actions>

					</Default>
				</Panes>
			</Main>

		</DockScreens>

		<DockingPorts>
			<Port x="90"	y="15" />
			<Port x="-90"	y="15" />
			<Port x="90"	y="90" />
			<Port x="-90"	y="90" />
			<Port x="60"	y="-30" />
			<Port x="-60"	y="-30" />

			<Port x="0"		y="-50" />
			<Port x="0"		y="130" />
		</DockingPorts>

		<Language>
			<Text id="descWelcome">
				You are docked at a franchise of Thor's Wondrous Devices.
			</Text>
		</Language>
	</StationType>

	<Globals>
		(block Nil
			(setq intBushidoArmorEnhancement (lambda Nil
				(random (list 0x0101 0x0102 0x0102 0x0103 0x0309 0x0329))
				))

			(setq intBushidoShieldEnhancement (lambda Nil
				(random (list 0x0101 0x0102 0x0102 0x0103 0x0104 0x0824 0x0842 0xf03))
				))

			(setq intBushidoWeaponEnhancement (lambda Nil
				(random (list 0x0101 0x0102 0x0102 0x0103 0x0f03 0x1002))
				))

			(setq intCorporateCrime (lambda (severity description)
				(if (gr severity (int (objGetData gPlayerShip "corpCrimeSeverity")))
					(block Nil
						(objSetData gPlayerShip "corpCrimeSeverity" severity)
						(objSetData gPlayerShip "corpCrime" description)
						)
					)
				))

			(setq intCorporateGenerateEnhancement (lambda (theItem)
				(block (theCategory)
					(setq theCategory (itmGetCategory theItem))
					(switch
						; Armor enhancements
						(eq theCategory 0x0002)
							(random (list 0x0101 0x0102 0x0102 0x0103))

						; Shield enhancements
						(eq theCategory 0x0080)
							(random (list 0x0101 0x0102 0x0102 0x0103))

						; Weapon enhancements
						(eq theCategory 0x0004)
							(random (list 0x0101 0x0102 0x0102 0x0103))

						0x0000
						)
					)
				))

			(setq intCorporateOnDestroy (lambda Nil
				(block (corporateCruiser theDestroyer)
					; Destroy items on the station
					(rpgDestroyItems gSource)

					; Create a corporate cruiser to avenge the station
					(setq corporateCruiser
						(sysCreateShip &scCorporateCruiser; (objGetNearestStargate gSource) &svCorporate;)
						)

					; If someone destroyed the station, avenge
					(setq theDestroyer aOrderGiver)
					(if (and theDestroyer
							(objCanAttack theDestroyer)
							(not (eq (objGetSovereign theDestroyer) &svCorporate;)))
						(block Nil
							(objSendMessage gPlayerShip gSource "Security alert! Deploy corporate enforcer!")
							(shpOrderAttack corporateCruiser theDestroyer)

							; Since the cruiser is busy, deploy some transports to loot the station
							(for i 1 (random 1 3)
								(block (transport)
									(setq transport
										(sysCreateShip &scEI500; (objGetNearestStargate gSource) &svCorporate;)
										)

									(shpOrderLoot transport gSource)
									(shpOrderGate transport)
									)
								)
							)
						)

					; If the player destroyed the station, then she is banned
					(if (and gPlayerShip (eq aOrderGiver gPlayerShip))
						(intCorporateCrime 3 (cat "the destruction of " (objGetName gSource 4)))
						)

					; Take all the items from the station (so that others won't loot it)
					(shpOrderLoot corporateCruiser gSource)

					; Gate out
					(shpOrderGate corporateCruiser)
					)
				))

			(setq intHPEnhancement1 (lambda Nil
				(random (list 0x0101 0x0101 0x0102 0x0102 0x0103))
				))

			(setq intHPEnhancement2 (lambda Nil
				(random (list 0x0101 0x0102 0x0102 0x0103 0x0103 0x0104))
				))

			(setq intHPEnhancement3 (lambda Nil
				(random (list 0x0102 0x0103 0x0103 0x0104 0x0104 0x0105))
				))

			(setq intMakayevArmorEnhancement (lambda Nil
				(random (list 0x0101 0x0102 0x0102 0x0103 0x0103 0x0104 0x0b00 0x0c00))
				))

			(setq intMakayevWeaponEnhancement (lambda Nil
				(random (list 0x0102 0x0103 0x0103 0x0104 0x0104 0x0105))
				))
			)
	</Globals>

	<!-- Arms Dealer Screen -->

	<DockScreen UNID="&dsArmsDealerSpecial;"
			inherit="&dsDockScreenBase;"
			>
		<Panes>
			<Default>
				<OnPaneInit>
					(scrSetDesc gScreen (cat "You are docked at " (objGetStaticData gSource "LongName") "."))
				</OnPaneInit>

				<Actions>
					<Action id="actionDockServices" default="1">
						(rpgDockServices gPlayerShip {
							checkMilitaryID: True
							})
					</Action>

					<Action id="actionBuyItems">
						(scrShowScreen gScreen &dsRPGCommoditiesExchangeBuy; {
							checkMilitaryID: True
							})
					</Action>

					<Action id="actionUndock" cancel="1">
						<Exit/>
					</Action>
				</Actions>

			</Default>
		</Panes>
	</DockScreen>

	<!-- Corporate Imprison -->

	<DockScreen UNID="&dsCorporateImprison;"	
			inherit="&dsDockScreenBase;"
			nestedScreen="true"
			>
		<Panes>
			<Default>
				<OnPaneInit>
					(scrSetDesc gScreen (cat "As you enter the station you are surrounded by heavily armed soldiers. A corporate officer approaches you: \"You are under arrest for " (objGetData gPlayerShip "corpCrime") "\"" ))
				</OnPaneInit>

				<Actions>
					<Action id="actionContinue" default="1" cancel="1">
						(block Nil
							(plyDestroyed gPlayer (cat "was imprisoned for " (objGetData gPlayerShip "corpCrime")))
							(scrExitScreen gScreen 'forceUndock)
							)
					</Action>
				</Actions>
			</Default>
		</Panes>
	</DockScreen>
	
<!-- BASE CLASSES -->
	
	<!-- Corporate Hierarchy Station Base Class
	
	USAGE: Corporate stations should inherit from this class. Derived classes
		should manually call OnCreate and OnDestroy in case they need to override
		those events.
	
	-->
	
	<Type unid="&baCorporateStation;">
		<Events>
			<OnDestroy>
				(intCorporateOnDestroy)
			</OnDestroy>
		</Events>
		
		<Language>
			<Text id="actionBuyItems">[B]uy Items</Text>
			<Text id="actionCancel">[C]ancel</Text>
			<Text id="actionCommoditiesExchange">[C]ommodities Exchange</Text>
			<Text id="actionContinue">[C]ontinue</Text>
			<Text id="actionDockServices">[D]ock Services</Text>
			<Text id="actionLeave">[L]eave</Text>
			<Text id="actionRefuel">[R]efuel</Text>
			<Text id="actionRepairItems">[R]epair Items</Text>
			<Text id="actionSellItems">[S]ell Items</Text>
			<Text id="actionUndock">[U]ndock</Text>

			<Text id="customs.chargedForDecon">
				Corporate security stops your ship for decontamination.
				You are automatically charged %cost% for decontaminating your ship.
			</Text>
			<Text id="customs.cantAffordDecon">
				Corporate security stops your ship for decontamination.
				Unfortunately, you do not have %cost% to pay for decontamination.
			</Text>
		</Language>
	</Type>

<!-- TABLES -->

	<ShipTable unid="&tbCorpDefenders;">
		<LevelTable>
			<Ship levelFrequency="cccr- -----" count="1" class="&scRoninA;" orders="guard"/>
			<Ship levelFrequency="ruucc cr---" count="1" class="&scRoninB;" orders="guard"/>
			<Ship levelFrequency="uuucc cur--" count="1" class="&scWolfen;" orders="guard"/>
			<Ship levelFrequency="---uu ccccu" count="1" class="&scRoninC;" orders="guard"/>
			<Ship levelFrequency="ccccc ccccc" count="1" class="&scCenturionBlock2;" orders="guard"/>
			<Ship levelFrequency="--ruc cuuuu" count="1" class="&scManticore;" orders="guard"/>
			<Ship levelFrequency="----- -uuuu" count="1" class="&scBritannia;" orders="guard"/>
		</LevelTable>
	</ShipTable>
	
<!-- RESOURCES -->

	<Image UNID="&rsCorporateCruiser;"		bitmap="Resources\CorporateCruiser.jpg" bitmask="Resources\CorporateCruiserMask.bmp" loadOnUse="true"/>
	<Image UNID="&rsMakayevFactory;"		bitmap="Resources\MakayevFactory.jpg" bitmask="Resources\MakayevFactoryMask.bmp" loadOnUse="true"/>
	<Image UNID="&rsManufacturingPlant;"	bitmap="Resources\ManufacturingPlant.jpg" bitmask="Resources\ManufacturingPlantMask.bmp" loadOnUse="true"/>
	
	<Image UNID="&rsTradingPostAnimation;"	bitmap="Resources\TradingPostGenericAd.jpg" bitmask="Resources\TradingPostGenericAdMask.bmp" loadOnUse="true"/>

</TranscendenceModule>
