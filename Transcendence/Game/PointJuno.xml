<?xml version="1.0" encoding="utf-8"?>

<TranscendenceModule>

	<!-- Point Juno 
	
	GLOBAL DATA
	
	status:			Status of Point Juno
						Nil					Unknown
						'defended			Player saved Point Juno
						'destroyed			Point Juno destroyed by Ares
						'destroyedByPlayer	Point Juno destroyed by player

	EXTRA DATA

	AlphaFleet:		Alpha fleet leader
	MissionIntro:	If True, then we've told the player about the mission
	MissionStatus:	Status of the mission:
						Nil					Mission has not started yet
						"defaultAttack"		Player did not dock before attack started
						"findBeta"			Player must find the hidden beta fleet and destroy it
						"destroyBeta"		Alpha destroyed; player must destroy beta fleet
						"destroyAlpha"		Beta destroyed; player must destroy alpha (which is attacking)
						"oneLastAttack"		Alpha and beta destroyed; player must dock to get gamma mission
						"destroyGamma"		Alpha and beta destroyed; player must destroy gamma
						"celebrate"			Alpha, beta, and gamma destroyed
						"europa"			Tell the player about Project lamplighter
						"europaAccepted"	Player has accepted mission
						"europaDeclined"	Player has declined mission
						"complete"			Mission done
						"PointJunoLost"		Point Juno destroyed
	-->

	<StationType UNID="&stPointJuno;"
			name=				"Point Juno"
			sovereign=			"&svCommonwealthFleet;"
			dockScreen=			"Main"
			abandonedScreen=	"&dsAbandonedStation;"
			defaultBackgroundID="&rsPointJunoBkgnd;"
			canAttack=			"true"
			noBlacklist=		"true"

			multiHull=			"true"
			armorID=			"&itP1000HexphaseArmor;"
			hitPoints=			"1000"
			repairRate=			"2"
			shipRepairRate=		"3"
			explosionType=		"&vtThermoExplosion3;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"commonwealth, commonwealthFleet, commonwealthMilitary, fleetDelivery, fleetLaw, friendly, human, majorStation, pointJuno, populated"
			level=				"8"

			noArticle=			"true"
			>

		<Image			imageID="&rsStationsPointJuno;" imageX="0" imageY="0" imageWidth="208" imageHeight="256"/>

		<Ships>
			<Ship					count="1"	class="&scBritannia;"	orders="guard" controller="fleetcommand">
				<Escorts>
					<Ship			count="12"	class="&scCenturion;"	orders="escort" controller="fleet"/>
				</Escorts>
			</Ship>
			<Ship					count="1"	class="&scBritannia;"	orders="guard" controller="fleetcommand">
				<Escorts>
					<Ship			count="12"	class="&scCenturion;"	orders="escort" controller="fleet"/>
				</Escorts>
			</Ship>
		</Ships>

		<Reinforcements minShips="5">
			<Table>
				<Ship chance="25" count="1" class="&scEI500;" orders="gateOnThreat"/>
				<Ship chance="10" count="1" class="&scWolfen;" orders="gateOnThreat"/>
				<Ship chance="15" count="1" class="&scRoninC;" orders="guard"/>
				<Ship chance="50" count="1" class="&scCenturion;" orders="guard"/>
			</Table>
		</Reinforcements>

		<Satellites>
			<Orbitals distance="8" angle="90">
				<Station type="&stNavBeacon;" imageVariant="1"/>
			</Orbitals>

			<Orbitals distance="8" angle="270">
				<Station type="&stNavBeacon;" imageVariant="1"/>
			</Orbitals>
		</Satellites>
		
		<Events>
			<GetGlobalAchievements>
				(block (theList status)
					(setq status (typGetGlobalData &stPointJuno; "status"))

					(if status
						(setq theList (list
							(list
								(switch
									(eq status 'defended) "Defended Point Juno"
									(eq status 'destroyed) "Failed to defend Point Juno"
									(eq status 'destroyedByPlayer) "Destroyed Point Juno"
									(cat "ERROR: Point Juno status: " status)
									) 
								Nil
								"achievements &amp; regrets"
								)
							))
						)
						
					theList
					)
			</GetGlobalAchievements>

			<OnCreate>
				(block (pos aresAlphaLeader aresBetaLeader aresGammaLeader)

					; Create Ares Alpha fleet

					(setq pos (sysVectorPolarOffset gSource (random 80 100) 600))

					(setq aresAlphaLeader (sysCreateShip &scTundra; pos &svAres; "fleetcommand"))
					(shpOrderWait aresAlphaLeader 0)
					(objSetObjRefData gSource "AlphaFleet" aresAlphaLeader)
					(objRegisterForEvents gSource aresAlphaLeader)

					(for i 0 35
						(block (ship)
							(setq ship (sysCreateShip &scSandstorm; pos &svAres; "fleet"))
							(shpOrderEscort ship aresAlphaLeader i)
							)
						)

					(for i 0 5
						(block (ship)
							(setq ship (sysCreateShip &scAresCannon; (sysVectorPolarOffset pos (multiply i 60) 20) &svAres;))
							(shpOrderHold ship)
							)
						)

					; Create Ares Beta fleet

					(setq pos (sysVectorPolarOffset gSource (random 10 40) (random 400 500)))

					(setq aresBetaLeader (sysCreateShip &scChasm; pos &svAres; "fleetcommand"))
					(shpOrderWait aresBetaLeader 0)
					(objSetObjRefData gSource "BetaFleet" aresBetaLeader)
					(objRegisterForEvents gSource aresBetaLeader)

					(for i 0 35
						(block (ship)
							(setq ship (sysCreateShip &scSandstorm; pos &svAres; "fleet"))
							(shpOrderEscort ship aresBetaLeader i)
							)
						)

					; Create some defenders for Ares Beta fleet

					(for i 0 11
						(block (ship)
							(setq ship (sysCreateShip &scAresCannon; (sysVectorPolarOffset pos (multiply i 30) 20) &svAres;))
							(shpOrderHold ship)
							)
						)

					; Create a marker for the fleet position

					(setq marker (sysCreateMarker "Ares Fleet" pos &svAres;))
					(objSetObjRefData gSource "BetaFleetMarker" marker)
					)
			</OnCreate>

			<OnDestroy>
				(block (aresAlphaLeader aresBetaLeader aresGammaLeader)
					(if (objGetData gSource "MissionStatus")
						(objSendMessage gPlayerShip gSource "Point Juno destroyed!")
						)

					(setq aresAlphaLeader (objGetObjRefData gSource "AlphaFleet"))
					(if aresAlphaLeader
						(block Nil
							(shpCancelOrders aresAlphaLeader)
							(shpOrderGate aresAlphaLeader)
							)
						)
					(setq aresBetaLeader (objGetObjRefData gSource "BetaFleet"))
					(if aresBetaLeader
						(block Nil
							(shpCancelOrders aresBetaLeader)
							(shpOrderGate aresBetaLeader)
							)
						)
					(setq aresGammaLeader (objGetObjRefData gSource "GammaFleet"))
					(if aresGammaLeader
						(block Nil
							(shpCancelOrders aresGammaLeader)
							(shpOrderGate aresGammaLeader)
							)
						)

					(objSetData gSource "MissionStatus" "PointJunoLost")
					(objSetGlobalData gSource "status"
						(if (and gPlayerShip (eq aOrderGiver gPlayerShip)) 'destroyedByPlayer 'destroyed)
						)

					(intCommonwealthOnDestroy)

					; Military will execute the player

					(if (and gPlayerShip (eq aOrderGiver gPlayerShip))
						(intFleetCrime 3 (cat "the destruction of " (objGetName gSource 4)))
						)
					)
			</OnDestroy>

			<OnObjDestroyed>
				(block (status)
					(setq status (objGetData gSource "MissionStatus"))

					(switch
						; If the player was destroyed, stop the mission
						(eq aObjDestroyed gPlayerShip)
							(block Nil
								(shpCancelOrders gPlayerShip)

								; Disperse wingmen
								(intFleetDisperseWingmen gSource 8)
								)

						; If Point Juno is already destroyed, then we don't care anymore
						(eq (objGetData gSource "MissionStatus") "PointJunoLost")
							Nil

						(eq aObjDestroyed (objGetObjRefData gSource "AlphaFleet"))
							(switch
								; If we haven't started the mission yet, then send beta fleet
								; to attack Point Juno
								(or (not status) (eq status "defaultAttack"))
									(block (aresBetaLeader)
										(setq aresBetaLeader (objGetObjRefData gSource "BetaFleet"))

										(shpCancelOrders aresBetaLeader)
										(shpOrderAttack aresBetaLeader gSource)

										(objSendMessage gPlayerShip gSource "Point Juno under attack!")
										(shpOrderDock gPlayerShip gSource)

										(objSetData gSource "MissionStatus" "destroyBeta")
										)

								; If we're looking for beta fleet, then we're OK
								(eq status "findBeta")
									(objSetData gSource "MissionStatus" "destroyBeta")

								; Done with alpha and beta
								(eq status "destroyAlpha")
									(block Nil
										(objSendMessage gPlayerShip gSource "Mission Accomplished!")
										(objSetData gSource "MissionStatus" "oneLastAttack")
										)

								(objSendMessage gPlayerShip gSource (cat "ERROR: Alpha destroyed; status = " status))
								)

						(eq aObjDestroyed (objGetObjRefData gSource "BetaFleet"))
							(switch
								; If we haven't started the mission yet, then send alpha fleet
								; to attack Point Juno
								(or (not status) (eq status "defaultAttack"))
									(block (aresAlphaLeader)
										(setq aresAlphaLeader (objGetObjRefData gSource "AlphaFleet"))
										(shpCancelOrders aresAlphaLeader)
										(shpOrderAttack aresAlphaLeader gSource)

										(objSendMessage gPlayerShip gSource "Point Juno under attack!")
										(shpOrderDock gPlayerShip gSource)

										(objSetData gSource "MissionStatus" "destroyAlpha")
										)

								; If we're looking for beta fleet, then defend point juno
								(eq status "findBeta")
									(block Nil
										(objSendMessage gPlayerShip gSource "Point Juno under attack!")
										(shpOrderDock gPlayerShip gSource)

										(objSetData gSource "MissionStatus" "destroyAlpha")
										)

								; Done with alpha and beta
								(eq status "destroyBeta")
									(block Nil
										(objSendMessage gPlayerShip gSource "Mission Accomplished!")
										(objSetData gSource "MissionStatus" "oneLastAttack")
										)

								(objSendMessage gPlayerShip gSource (cat "ERROR: Beta destroyed; status = " status))
								)

						(eq (objGetData gSource "MissionStatus") "destroyGamma")
							(block (gammaShips)
								(setq gammaShips 0)
								(for i 1 5
									(block (ship)
										(setq ship (objGetObjRefData gSource (cat "GammaFleet" i)))
										(if (and ship (not (eq ship aObjDestroyed)))
											(setq gammaShips (add gammaShips 1))
											)
										)
									)

								(if (eq gammaShips 0)
									(block Nil
										(objSendMessage gPlayerShip gSource "Mission Accomplished!")
										(objSetData gSource "MissionStatus" "celebrate")
										(objSetGlobalData gSource "status" 'defended)
										)
									)
								)
						)
					)
			</OnObjDestroyed>

			<OnTimerDefaultAttack>
				; If the player never accepts the mission, we nevertheless send out
				; Alpha fleet to attack
				(if (not (objGetData gSource "MissionStatus"))
					(block (aresAlphaLeader)
						(setq aresAlphaLeader (objGetObjRefData gSource "AlphaFleet"))

						; Orders to alpha fleet
						(if aresAlphaLeader
							(block Nil
								(shpCancelOrders aresAlphaLeader)
								(shpOrderAttack aresAlphaLeader gSource)
								)
							)

						; Set a timer for beta fleet
						(sysAddObjTimerEvent 3600 gSource "OnTimerZeroHour")

						(objSetData gSource "MissionStatus" "defaultAttack")
						)
					)
			</OnTimerDefaultAttack>

			<OnTimerZeroHour>
				(block (aresAlphaLeader aresBetaLeader)
					(setq aresAlphaLeader (objGetObjRefData gSource "AlphaFleet"))
					(setq aresBetaLeader (objGetObjRefData gSource "BetaFleet"))

					; Order alpha fleet to fall-back
					(if aresAlphaLeader
						(block Nil
							(shpCancelOrders aresAlphaLeader)
							(shpOrderGate aresAlphaLeader)
							)
						)

					; Order the beta fleet to attack
					(if aresBetaLeader
						(block (status)
    					(setq status (objGetData gSource "MissionStatus"))
							(shpCancelOrders aresBetaLeader)
							(shpOrderAttack aresBetaLeader gSource)

							(if (not (or (not status) (eq status "defaultAttack")))
								(block Nil
									(objSendMessage gPlayerShip gSource "Return to base! Return to base!")
									(shpOrderDock gPlayerShip gSource)
									)
								)
							)
						)
					)
			</OnTimerZeroHour>
		</Events>

		<DockScreens>
			<Main>
				<Panes>
					<Default
							desc=	"You are docked at Point Juno.">

						<Actions>
							<Action name="Central Command" default="1" key="C">
								(block (missionStatus)
									(setq missionStatus (objGetData gSource "MissionStatus"))

									(switch
										; Can't get in unless the player is Fleet Lieutenant or above
										(ls (objGetData gPlayerShip "fleetLevel") 4)
											(scrShowPane gScreen "AccessDenied")

										(not missionStatus)
											(scrShowPane gScreen "CCGetMission1")

										(eq missionStatus "defaultAttack")
											(scrShowPane gScreen "CCStatus")

										(eq missionStatus "findBeta")
											(scrShowPane gScreen "CCStatus")

										(eq missionStatus "destroyBeta")
											(scrShowPane gScreen "CCStatus")

										(eq missionStatus "destroyAlpha")
											(scrShowPane gScreen "CCStatus")

										(eq missionStatus "oneLastAttack")
											(if (objIsUnderAttack gSource)
												(scrShowPane gScreen "CCStatus")
												(scrShowPane gScreen "CCGetMission3")
												)

										(eq missionStatus "destroyGamma")
											(scrShowPane gScreen "CCStatus3")

										(eq missionStatus "celebrate")
											(scrShowPane gScreen "CCMissionDone")

										(objGetItems gPlayerShip "wU +LamplighterPrototype;")
											(scrShowPane gScreen "CCPrototypeFound")

										(eq missionStatus "europa")
											(scrShowPane gScreen "CCEuropaMission")

										(eq missionStatus "europaAccepted")
											(scrShowPane gScreen "CCEuropaMission3")

										(eq missionStatus "europaDeclined")
											(scrShowPane gScreen "CCEuropaMission4")

										(scrShowPane gScreen "BackToNormal")
										)
									)
							</Action>

							<Action name="Dock Services" key="D">
								(scrShowScreen gScreen "&dsFleetDockServices;")
							</Action>

							<Action name="Undock" cancel="1" key="U">
								<Exit/>
							</Action>

						</Actions>

					</Default>

					<CCGetMission1>
						<OnPaneInit>
							(scrSetDesc gScreen
								(cat 
									"Officers and assistants rush around the room under the glow of massive display screens. "
									"In the center, standing over a tactical holomap, an older woman with three general's stars consults with her officers.\n\n"
									"She looks up as you approach. \"My men tell me that you're one of those pilgrims, heading off to the Core on a personal invitation from the Gods or whatever. "
									"Well, on your way to Heaven, how about helping us mortals who are not so eager to meet our makers?\""
									)
								)
						</OnPaneInit>

						<Actions>
							<Action name="&quot;I want to help.&quot;" default="1" key="H">
								<ShowPane pane="CCGetMission1a"/>
							</Action>

							<Action name="&quot;Sorry, I can't.&quot;" cancel="1" key="S">
								<ShowPane pane="CCMissionDeclined"/>
							</Action>
						</Actions>
					</CCGetMission1>

					<CCGetMission1a>
						<OnPaneInit>
							(scrSetDesc gScreen
								(cat
									"The general looks at you for a while, an enigmatic smile on her face. You notice that her left arm is prosthetic.\n\n"
									"\"Good,\" she says, \"we can use all the help we can get. I'm General Verner and Point Juno is my stronghold. "
									"The Ares have hit us hard in the last few months. We lost the CSC Europa in the last battle and now I'm left with "
									"no carrier and precious few gunships.\""
									)
								)
						</OnPaneInit>

						<Actions>
							<Action name="Continue" default="1" cancel="1" key="C">
								<ShowPane pane="CCGetMission1b"/>
							</Action>
						</Actions>
					</CCGetMission1a>

					<CCGetMission1b>
						<OnPaneInit>
							(scrSetDesc gScreen
								(cat
									"General Verner continues, \"We've tracked a large Ares battle fleet on the other side of the system and we know "
									"that it's going to hit us soon. But what worries me is that there is a second battle fleet somewhere "
									"around the asteroid field nearest Point Juno.\n\n\"I want you to scour the system looking for that second fleet. And if you find it, I want you to "
									"destroy it. I can give you eight Centurions&#x97;no more. Got it?\""
									)
								)
						</OnPaneInit>

						<Actions>
							<Action name="&quot;Yes, ma'am!&quot;" default="1" key="Y">
								<ShowPane pane="CCGetMission1c"/>
							</Action>

							<Action name="&quot;On second thought, count me out.&quot;" cancel="1" key="S">
								<ShowPane pane="CCMissionDeclined"/>
							</Action>
						</Actions>
					</CCGetMission1b>

					<CCGetMission1c>
						<OnPaneInit>
							(scrSetDesc gScreen
								(cat
									"General Verner shakes your hand, \"Good hunting, then! And may the Gods take us all when we're ready&#x97;but not before!\"\n\n"
									"And at that the general laughs and turns back to her tactical displays."
									)
								)
						</OnPaneInit>

						<Actions>
							<Action name="Continue" default="1" cancel="1" key="C">
								(block (aresAlphaLeader)
									(setq aresAlphaLeader (objGetObjRefData gSource "AlphaFleet"))

									; Orders to alpha fleet
									(if aresAlphaLeader
										(block Nil
											(shpCancelOrders aresAlphaLeader)
											(shpOrderAttack aresAlphaLeader gSource)

											;(shpCancelOrders gPlayerShip)
											;(shpOrderAttack gPlayerShip aresAlphaLeader)
											)
										)

									; Create some ships off-screen a bring them in
									(intFleetCreateWingmen gSource 8 &scCenturion;)

									; Need notification if/when player is destroyed
									(objRegisterForEvents gSource gPlayerShip)

									; Set a timer in case we don't find the fleet quickly enough
									(sysAddObjTimerEvent 3600 gSource "OnTimerZeroHour")

									; Give the position of the fleet to the player
									(if (ls (objGetDistance (objGetObjRefData gSource "BetaFleet") (objGetObjRefData gSource "BetaFleetMarker"))
											100)
										(shpOrderAttack gPlayerShip (objGetObjRefData gSource "BetaFleetMarker"))
										(block Nil
											(shpOrderAttack gPlayerShip (objGetObjRefData gSource "BetaFleet"))
											(objSetIdentified (objGetObjRefData gSource "BetaFleet"))
											)
										)

									; Set status
									(objSetData gSource "MissionIntro" True)
									(objSetData gSource "MissionStatus" "findBeta")

									(scrExitDock gScreen)
									)
							</Action>
						</Actions>
					</CCGetMission1c>

					<CCGetMission3>
						<OnPaneInit>
							(scrSetDesc gScreen
								(cat
									"The Command Center is celebrating as you walk in. General Verner appears visibly relieved. She approaches you. "
									"\"Nice work! If I had a few more pilots like you, maybe we could end this war and all go home.\""
									)
								)
						</OnPaneInit>

						<Actions>
							<Action name="Continue" default="1" cancel="1" key="C">
								<ShowPane pane="CCGetMission3a"/>
							</Action>
						</Actions>
					</CCGetMission3>

					<CCGetMission3a>
						<OnPaneInit>
							(scrSetDesc gScreen
								(cat
									"As the general shakes your hand, the XO interrupts: "
									"\"General! We've got incoming! A Cometfall squadron with long-range nukes!\"\n\n"
									"General Verner rushes to the tactical screens. \"Brace for impact! Deploy damage control teams and seal all sectors!\"\n\n"
									"She turns to you and says, \"Looks like we're not out of this yet. Find the Cometfalls and destroy them! Go now!\""
									)
								)
						</OnPaneInit>

						<Actions>
							<Action name="Continue" default="1" cancel="1" key="C">
								(block (aresGammaLeader)
									; Create Ares Gamma fleet

									(setq pos (sysVectorPolarOffset gSource (random 120 240) 500))

									(setq aresGammaLeader (sysCreateShip &scCometfall; pos &svAres; "fleetcommand"))
									(objSetObjRefData gSource "GammaFleet1" aresGammaLeader)
									(objRegisterForEvents gSource aresGammaLeader)

									(for i 0 3
										(block (ship)
											(setq ship (sysCreateShip &scCometfall; pos &svAres; "fleet"))
											(shpOrderEscort ship aresGammaLeader i)

											(objSetObjRefData gSource (cat "GammaFleet" (add i 2)) ship)
											(objRegisterForEvents gSource ship)
											)
										)

									; Orders to gamma fleet
									(shpCancelOrders aresGammaLeader)
									(shpOrderAttack aresGammaLeader gSource)
									(objSetData gSource "MissionStatus" "destroyGamma")

									(shpOrderAttack gPlayerShip aresGammaLeader)
									(objSetIdentified aresGammaLeader)

									(scrExitDock gScreen)
									)
							</Action>
						</Actions>
					</CCGetMission3a>

					<CCMissionDeclined>
						<OnPaneInit>
							(scrSetDesc gScreen
								(cat
									"General Verner holds your gaze for a second. \"Perhaps I had the wrong impression about you...\""
									)
								)
						</OnPaneInit>

						<Actions>
							<Action name="Continue" default="1" cancel="1" key="C">
								(block Nil
									; Set a default timer so that if the player never accepts the mission, the
									; fleets still end up attacking

									(sysAddObjTimerEvent 1600 gSource "OnTimerDefaultAttack")
									
									(scrShowPane gScreen "Default")
									)
							</Action>
						</Actions>
					</CCMissionDeclined>

					<CCStatus>
						<OnPaneInit>
							(block (aresAlphaLeader aresBetaLeader desc)
								(setq aresAlphaLeader (objGetObjRefData gSource "AlphaFleet"))
								(setq aresBetaLeader (objGetObjRefData gSource "BetaFleet"))
								(setq gTarget Nil)

								(switch
									; If we never got the original mission, just ask the player to help
									(not (objGetData gSource "MissionIntro"))
										(block Nil
											(setq desc "The Command Center is abuzz with activity. General Verner looks up as you enter. \"If you've come to help, stop standing around and staring. Make yourself useful!\"")
											)

									; If beta fleet is attacking, then order the player to destroy it
									(and aresBetaLeader (eq (shpGetOrder aresBetaLeader) 'attack))
										(block (dist)
											(setq dist (objGetDistance aresBetaLeader gSource))
											(if (ls dist 50)
												(setq desc "General Verner looks up only for a moment as you enter. \"What are you doing here? Go help destroy the Ares fleet!\"")
												(setq desc "General Verner looks up only for a moment as you enter. \"What are you doing here? Go find and destroy that Ares fleet!\"")
												)
											(setq gTarget aresBetaLeader)
											)

									; If beta fleet is still out there...
									aresBetaLeader
										(block Nil
											(setq desc "General Verner looks up only for a moment as you enter. \"What are you doing here? Aren't supposed to be out looking for that fleet?\"")
											(setq gTarget aresBetaLeader)
											)

									; If alpha fleet is still out there, ask the player to destroy it
									aresAlphaLeader
										(block (dist)
											(setq dist (objGetDistance aresAlphaLeader gSource))
											(if (ls dist 50)
												(setq desc "General Verner looks up only for a moment as you enter. \"We're a little busy right now...\"")
												(block Nil
													(setq desc
														(cat
															"The Command Center is abuzz with activity. General Verner looks up as you enter. "
															"\"It looks like they're coming around for another run at us. Stay close and try to destroy as many of them as you can.\""
															)
														)
													)
												)
											)

									; If we're under attack by random forces
									(objIsUnderAttack gSource)
										(setq desc "General Verner looks up only for a moment as you enter. \"Both fleets have been disrupted...we just have to mop up now!\"")
									)

								; Set text	
								(scrSetDesc gScreen desc)

								; Set target
								(if gTarget
									(block Nil
										(shpOrderAttack gPlayerShip gTarget)
										(objSetIdentified gTarget)
										)
									)
								)
						</OnPaneInit>

						<Actions>
							<Action name="Continue" default="1" cancel="1" key="C">
								<ShowPane pane="Default"/>
							</Action>
						</Actions>
					</CCStatus>

					<CCStatus3>
						<OnPaneInit>
							(scrSetDesc gScreen
								(cat
									"General Verner looks up only for a moment as you enter. \"What are you doing here? Aren't supposed to be out looking for those missileships?\""
									)
								)
						</OnPaneInit>

						<Actions>
							<Action name="Continue" default="1" cancel="1" key="C">
								<ShowPane pane="Default"/>
							</Action>
						</Actions>
					</CCStatus3>

					<CCMissionDone>
						<OnPaneInit>
							(scrSetDesc gScreen
								(cat
									"As you enter, everyone in the command center stops to applaud.\n\n"
									"General Verner walks over to you and offers her hand. \"Well done! I knew I could count on you. "
									"With the damage that we've inflicted, I doubt that the Ares will be back anytime soon!\n\n"
									"\"May the Gods give you peace when you reach the Core!\""
									)
								)
						</OnPaneInit>

						<Actions>
							<Action name="Continue" default="1" cancel="1" key="C">
								(block Nil
									(objSetData gSource "MissionStatus" "europa")
									(intFleetDisperseWingmen gSource 8)
									(objIncData gPlayerShip "fleetXP" 1200)
									
									; Got to Europa mission screen, either right away or after
									; promotion screen exits.
									(scrShowPane gScreen "CCEuropaMission")
									
									; Check promotion

									(if (intFleetPromotion)
										(block Nil
											(setq gName "General Verner")
											(scrShowScreen gScreen "&dsFleetPromotion;")
											)
										)
									)
							</Action>
						</Actions>
					</CCMissionDone>

					<CCEuropaMission>
						<OnPaneInit>
							(scrSetDesc gScreen
								(cat
									"\"Before you go, I have one more favor to ask you. When we lost the CSC Europa, she was "
									"carrying an experimental weapon&#x97;a prototype for a project called 'Lamplighter.' "
									"I want you to go to the wreck of the CSC Europa and retrieve this prototype."
									"\n\nCan you do that?\""
									)
								)
						</OnPaneInit>

						<Actions>
							<Action name="&quot;Yes, it sounds important.&quot;" key="Y" default="1">
								(scrShowPane gScreen "CCEuropaMission2")
							</Action>

							<Action name="&quot;No, I need to leave.&quot;" key="N" cancel="1">
								(scrShowPane gScreen "CCEuropaMissionDeclined")
							</Action>
						</Actions>
					</CCEuropaMission>

					<CCEuropaMission2>
						<OnPaneInit>
							(scrSetDesc gScreen
								(cat
									"\"Excellent! Maybe this weapon will make a diffence, eh? "
									"We'll enter the coordinates of the wreck into your computer, but you'll need a code "
									"to enter the ship's weapons vault. The code is:"
									"\n\n" (typGetGlobalData &stCSCEuropaWreck; "VaultCode")
									"\n\n\"Good luck!\""
									)
								)
						</OnPaneInit>

						<Actions>
							<Action name="Continue" key="C" default="1" cancel="1">
								(block Nil
									(shpOrderDock gPlayerShip (item (sysFindObject gSource "t:CSCEuropa") 0))
									(objSetData gSource "MissionStatus" "europaAccepted")
									(scrExitDock gScreen)
									)
							</Action>
						</Actions>
					</CCEuropaMission2>

					<CCEuropaMission3>
						<OnPaneInit>
							(scrSetDesc gScreen
								(cat 
									"\"Have you found the CSC Europa and the prototype? "
									"Remember that the vault code is:"
									"\n\n" (typGetGlobalData &stCSCEuropaWreck; "VaultCode")
									"\n\n\"Good luck!\""
									)
								)
						</OnPaneInit>

						<Actions>
							<Action name="Continue" key="C" default="1" cancel="1">
								(block Nil
									(shpOrderDock gPlayerShip (item (sysFindObject gSource "t:CSCEuropa") 0))
									(scrShowPane gScreen "Default")
									)
							</Action>
						</Actions>
					</CCEuropaMission3>

					<CCEuropaMission4>
						<OnPaneInit>
							(scrSetDesc gScreen
								(cat
									"\"Will you help us retrieve the weapon prototype from the "
									"wreckage of the CSC Europa?\""
									)
								)
						</OnPaneInit>

						<Actions>
							<Action name="&quot;Yes, I want to help.&quot;" key="Y" default="1">
								(scrShowPane gScreen "CCEuropaMission2")
							</Action>

							<Action name="&quot;No.&quot;" key="N" cancel="1">
								(scrShowPane gScreen "CCEuropaMissionDeclined")
							</Action>
						</Actions>
					</CCEuropaMission4>

					<CCEuropaMissionDeclined>
						<OnPaneInit>
							(scrSetDesc gScreen
								(cat
									"\"I'm sorry to hear that. Please come back if you change your mind.\""
									)
								)
						</OnPaneInit>

						<Actions>
							<Action name="Continue" key="C" default="1" cancel="1">
								(block Nil
									(objSetData gSource "MissionStatus" "europaDeclined")
									(scrShowPane gScreen "Default")
									)
							</Action>
						</Actions>
					</CCEuropaMissionDeclined>

					<CCPrototypeFound>
						<OnPaneInit>
							(scrSetDesc gScreen
								(cat
									"\"Excellent work! We're very close to completing the research on this new weapon. "
									"Who knows, maybe when you return from your visit to the Gods this war will be over!\""
									)
								)
						</OnPaneInit>

						<Actions>
							<Action name="Continue" key="C" default="1" cancel="1">
								(block (prototype)
									(setq prototype (item (objGetItems gPlayerShip "wU +LamplighterPrototype;") 0))
									(if prototype
										(block Nil
											(objRemoveItem gPlayerShip prototype)
											(objSetData gSource "MissionStatus" "complete")
											(typSetGlobalData &scCSCTerra; "p262prototype" "recovered")
											(scrShowPane gScreen "Default")
											)
										)
									)
							</Action>
						</Actions>
					</CCPrototypeFound>

					<BackToNormal>
						<OnPaneInit>
							(scrSetDesc gScreen
								(cat
									"General Verner welcomes you as you enter, \"I'm glad you're in no hurry to go to the Core. Take your rest here with us and seek Domina later.\""
									)
								)
						</OnPaneInit>

						<Actions>
							<Action name="Continue" default="1" cancel="1" key="C">
								<ShowPane pane="Default"/>
							</Action>
						</Actions>
					</BackToNormal>

					<AccessDenied>
						<OnPaneInit>
							(scrSetDesc gScreen "Two armed guards block your path, \"I'm sorry, %sir%, only Fleet Officers are allowed in Central Command.\"")
						</OnPaneInit>

						<Actions>
							<Action name="Continue" default="1" cancel="1" key="C">
								<ShowPane pane="Default"/>
							</Action>
						</Actions>
					</AccessDenied>
				</Panes>
			</Main>

		</DockScreens>

		<DockingPorts>
			<Port x="0"		y="100" />
			<Port x="-80"	y="40" />
			<Port x="80"	y="40" />
			<Port x="-60"	y="-40" />
			<Port x="60"	y="-40" />

			<Port x="0"		y="-105" />
			<Port x="-130"	y="-17" />
			<Port x="130"	y="-17" />
			<Port x="-70"	y="105" />
			<Port x="70"	y="105" />
		</DockingPorts>

	</StationType>

	<!-- CSC Europa Wreckage 

	EXTRA DATA

	VaultCode:		The code required to open the weapons vault
	VaultOpened:	True if the vault has been opened

	-->

	<StationType UNID="&stCSCEuropaWreck;"
			name=				"wreck of the CSC Europa"
			sovereign=			"&svCommonwealthFleet;"
			abandonedScreen=	"Main"
			scale=				"ship"

			structuralHitPoints="1300"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"CSCEuropa, locked, shipwreck, uncharted"

			definiteArticle=	"true"
			>

		<Image			imageID="&rsStationsPointJuno;" imageX="0" imageY="256" imageWidth="232" imageHeight="200"/>

		<Ships>
			<Table>
				<Group chance="60">
					<Ship	count="4"	class="&scChasm;"	orders="guard"	sovereign="&svAres;"/>
					<Ship	count="2d8"	class="&scSandstorm;" orders="patrol" patrolDist="10" sovereign="&svAres;"/>
					<Ship	count="1d2"	class="&scCometfall;" orders="patrol" patrolDist="15" sovereign="&svAres;"/>
				</Group>
				<Group chance="30">
					<Ship	count="2d6"	class="&scKobolGunshipDualTeV9;"	orders="patrol" patrolDist="5" sovereign="&svDestructiveChaos;"/>
					<Ship	count="2d4"	class="&scKobolGunshipOmniTeV9;"	orders="patrol" patrolDist="5" sovereign="&svDestructiveChaos;"/>
					<Ship	count="1d6"	class="&scKobolGunshipMissiles;"	orders="guard" sovereign="&svDestructiveChaos;"/>
				</Group>
				<Group chance="10">
					<Ship	count="2d8"	class="&scCenturion;"	orders="patrol"	patrolDist="5" sovereign="&svRogueFleet;"/>
					<Ship	count="1d8"	class="&scCenturionX;"	orders="guard" sovereign="&svRogueFleet;"/>
				</Group>
			</Table>
		</Ships>

		<Items>
			<Item count="1" item="&itLamplighterPrototype;"/>
			<Table count="1d4">
				<Item chance="40"	count="1"		item="&itStarCannon;"/>
				<Item chance="30"	count="1"		item="&itNAMIHeavyLauncher;"/>
				<Item chance="20"	count="1"		item="&itR9Deflector;"/>
				<Item chance="10"	count="1"		item="&itPlasmaCannon;"/>
			</Table>
			<Table count="2d6">
				<Item chance="20"	count="24d40"	item="&itThermoCannonShell;"/>
				<Item chance="20"	count="4d20"	item="&itStaticMine;"/>
				<Item chance="15"	count="4d12"	item="&itXM900Missile;"/>
				<Item chance="15"	count="2d20"	item="&itTrackingMine;"/>
				<Item chance="10"	count="4d20"	item="&itS3Missile;"/>
				<Item chance="10"	count="1d12"	item="&itM2Missile;"/>
				<Item chance="5"	count="1d4"		item="&itM5Missile;"/>
				<Item chance="5"	count="2d12"	item="&itKytrynPlasmaSeed;"/>
			</Table>
		</Items>

		<Satellites>
			<Orbitals count="2d6" distance="2d8+4" angle="random">
				<Table>
					<Station chance="60" type="&stSandstormWreck;"/>
					<Station chance="40" type="&stCenturionWreck;"/>
				</Table>
			</Orbitals>
		</Satellites>

		<Events>
			<OnCreate>
				(block (codes)
					(setq codes '(anvil boson cloud dour enigma fallen gollem heavy ice joust kilo labor metal neverland outpost proxy quasar rom sensor toxic ultra vial wren xavier yoke zone))
					(typSetGlobalData &stCSCEuropaWreck; "VaultCode" (cat (random codes) " " (random codes) " " (random 1 999)))
					)
			</OnCreate>
		</Events>

		<DockScreens>
			<Main>

				<Panes>
					<Default>
						<OnPaneInit>
							(block Nil
								(shpCancelOrders gPlayerShip)
								(scrSetDesc gScreen "You are docked with the hulking wreckage of the CSC Europa.")
								)
						</OnPaneInit>

						<Actions>
							<Action name="Bridge" key="B" default="1">
								(scrShowPane gScreen "Bridge")
							</Action>

							<Action name="Weapons Vault" key="W">
								(if (objGetData gSource "VaultOpened")
									(scrShowPane gScreen "WeaponsVault")
									(scrShowPane gScreen "WeaponsVaultLocked")
									)
							</Action>

							<Action name="Undock" cancel="1" key="U">
								<Exit/>
							</Action>

						</Actions>

					</Default>

					<Bridge
							desc=		"The bridge is completely smashed. Bodies float around in zero-G amid the shredded remains of consoles and other electronic equipment.">

						<Actions>
							<Action name="Leave" key="L" default="1" cancel="1">
								(scrShowPane gScreen "Default")
							</Action>
						</Actions>
					</Bridge>

					<WeaponsVault
							desc=		"You are inside the CSC Europa's weapons vault.">

						<Actions>
							<Action name="Loot" key="L" default="1" >
								(scrShowScreen gScreen &dsRPGLoot;)
							</Action>

							<Action name="Jettison" key="J">
								(scrShowScreen gScreen &dsRPGJettison;)
							</Action>

							<Action name="Leave" cancel="1" key="L">
								(scrShowPane gScreen "Default")
							</Action>
						</Actions>

					</WeaponsVault>

					<WeaponsVaultLocked
							desc=		"You are standing in front of the massive blast-proof doors of the ship's weapons vault. There is an alphabetic codepad on the door that requests an entry code."
							showTextInput="true">

						<Actions>
							<Action name="Enter Code" key="E" default="1">
								(block Nil
									(if (eq (scrGetInputText gScreen) (typGetGlobalData &stCSCEuropaWreck; "VaultCode"))
										(block Nil
											(objSetData gSource "VaultOpened" True)
											(scrShowPane gScreen "WeaponsVault")
											)
										(scrShowPane gScreen "InvalidCode")
										)
									)
							</Action>

							<Action name="Leave" key="L" cancel="1">
								(scrShowPane gScreen "Default")
							</Action>
						</Actions>
					</WeaponsVaultLocked>

					<InvalidCode
							desc=		"The code appears to be invalid. The vault doors remained closed.">

						<Actions>
							<Action name="Continue" key="C" default="1" cancel="1">
								(scrShowPane gScreen "WeaponsVaultLocked")
							</Action>
						</Actions>
					</InvalidCode>
				</Panes>
			</Main>

		</DockScreens>

		<DockingPorts>
			<Port x="0"		y="90" />
			<Port x="0"		y="-90" />
			<Port x="60"	y="60" />
			<Port x="60"	y="-60" />
			<Port x="90"	y="0" />
			<Port x="-90"	y="0" />
			<Port x="-60"	y="60" />
			<Port x="-60"	y="-60" />
		</DockingPorts>

	</StationType>

	<!-- Centurion wreck -->

	<StationType UNID="&stCenturionWreck;"
			name=				"(Centurion wreck)"
			sovereign=			"&svCommonwealthFleet;"
			dockScreen=			"&dsAbandonedShip;"
			scale=				"ship"
			mobile=				"true"
			noMapIcon=			"true"

			ejectaType=			"&vtWreckEjecta;"

			attributes=			"debris, friendly, shipwreck"
			levelFrequency=		"----- rucur ----- ----- -----"
			locationCriteria=	"-planetary"
			>
		<Image shipwreckID="&scCenturion;"/>

		<Items>
			<Table>
				<Null	chance="20"/>
				<Item	chance="30" count="2d6" item="&itHeliumAssembly;"/>
				<Item	chance="20" count="1d4" item="&itBlastPlate;"/>
				<Item	chance="5"  count="1"	item="&itTeV9Blaster;"/>
				<Item	chance="5"  count="1"	item="&itR1Deflector;"/>
				<Lookup chance="10" count="1"	table="&trConsumables7;"/>
				<Lookup chance="5"  count="1"	table="&trMinorItem7;"/>
				<Lookup chance="5"  count="1"	table="&trMajorItem7;"/>
			</Table>
		</Items>

		<Events>
			<GetExplosionType>
				(intContainerGetExplosionType gSource)
			</GetExplosionType>

			<OnDamage>
				(intContainerOnDamage gSource aDamageHP)
			</OnDamage>
		</Events>

		<DockingPorts
				portCount=		"2"
				portRadius=		"48"
				maxDist=		"3"
				/>
	</StationType>

	<!-- Sandstorm wreck -->

	<StationType UNID="&stSandstormWreck;"
			name=				"(Sandstorm wreck)"
			sovereign=			"&svAres;"
			dockScreen=			"&dsAbandonedShip;"
			scale=				"ship"
			mobile=				"true"
			noMapIcon=			"true"

			ejectaType=			"&vtWreckEjecta;"

			attributes=			"debris, friendly, shipwreck"
			levelFrequency=		"----- rucur ----- ----- -----"
			locationCriteria=	"-planetary"
			>
		<Image shipwreckID="&scSandstorm;"/>

		<Items>
			<Table>
				<Null	chance="40"/>
				<Item	chance="15" count="2d6" item="&itHeliumAssembly;"/>
				<Item	chance="10" count="1d4" item="&itLightTharsisPlate;"/>
				<Item	chance="5"  count="1"	item="&itLightningCannon;"/>
				<Lookup chance="15" count="1"	table="&trConsumables7;"/>
				<Lookup chance="10" count="1"	table="&trMinorItem7;"/>
				<Lookup chance="5"  count="1"	table="&trMajorItem7;"/>
			</Table>
		</Items>

		<Events>
			<GetExplosionType>
				(intContainerGetExplosionType gSource)
			</GetExplosionType>

			<OnDamage>
				(intContainerOnDamage gSource aDamageHP)
			</OnDamage>
		</Events>

		<DockingPorts
				portCount=		"2"
				portRadius=		"48"
				maxDist=		"3"
				/>
	</StationType>

	<!-- Point Juno System -->

	<SystemType UNID="&ssPointJuno;" noRandomEncounters="true">

		<SystemGroup>

			<Station type="&stNebulaStar;" name="Zheling"/>

			<AddAttribute attributes="GTypeSystem, nebulaSystem"/>
			<AddTerritory minRadius="0"		maxRadius="240"		attributes="innerSystem, organicComp, greenhouseZone"/>
			<AddTerritory minRadius="240"	maxRadius="400"		attributes="lifeZone, rockyComp, desertZone"/>
			<AddTerritory minRadius="400"	maxRadius="0"		attributes="outerSystem, metallicComp, barrenZone"/>

			<!-- Zheling I is volcanic world -->

			<Orbitals distance="75-85" angle="random">
				<Group>
					<Primary>
						<Station type="&stVolcanicTerrestrialSizeH;" name="Zheling I"	showOrbit="true"/>
					</Primary>

					<Orbitals distance="10-14" angle="random">
						<Lookup table="StargateOutbound"/>
					</Orbitals>
				</Group>
			</Orbitals>

			<!-- Zheling II is a desert world with a moon -->

			<Orbitals distance="155-165" angle="255-285">
				<Group>
					<Primary>
						<Station type="&stDesertTerrestrialSizeH;" name="Zheling II" showOrbit="true"/>
					</Primary>

					<Orbitals distance="7-12" angle="random">
						<Lookup table="StargateInbound"/>
					</Orbitals>

					<Orbitals distance="18-24" angle="random">
						<Station type="&stRockyPlanetoidSizeF;"/>
					</Orbitals>

				</Group>
			</Orbitals>

			<!-- Zheling III is a greenhouse world -->

			<Orbitals distance="240-270" angle="100-190">
				<Group>
					<Primary>
						<Station type="&stGreenhouseTerrestrialSizeI;" name="Zheling III" showOrbit="true"/>
					</Primary>

					<Orbitals distance="10-16" angle="random">
						<Station type="&stAresCommune;"/>
					</Orbitals>

					<!-- Nebula at the third planetary orbit -->

					<Trojan offset="120">
						<SpaceEnvironment 
								type=			"&seLightNebula;"
								shape=			"arc" 
								width=			"120"
								widthVariation=	"60"
								span=			"90-120"

								patchType=		"&efNebula;"
								patchFrequency=	"50"

								encountersCount="1d4"
								>
						</SpaceEnvironment>
					</Trojan>

				</Group>
			</Orbitals>

			<!-- Point Juno is near close to the orbit of Zheling III -->

			<Orbitals distance="240-270" angle="255-285">
				<Station type="&stPointJuno;"/>
			</Orbitals>

			<!-- Zheling IV is a gas giant -->

			<Orbitals distance="360-400" angle="30-75">
				<Group>
					<Primary>
						<Station type="&stHydrogenGasGiantSizeM;" name="Zheling Iv" showOrbit="true"/>
					</Primary>

					<Orbitals count="4d12" distance="2d6+4" eccentricity="20-40" angle="random">
						<Table>
							<Station chance="75" type="&stRockyOuterAsteroidSizeA;" />
							<Station chance="25" type="&stRockyOuterAsteroidSizeB;" />
						</Table>
					</Orbitals>

					<Orbitals distance="16-24" angle="random">
						<Station type="&stAresCommune;"/>
					</Orbitals>

					<!-- Wreck of CSC Europa is near the gas giant -->

					<Siblings angleInc="15-25">
						<Station type="&stCSCEuropaWreck;"/>
					</Siblings>

					<Trojan>
						<Group>
							<Orbitals count="2d4+4" distance="2d8+8" angle="random">
								<Station type="&stRockyOuterAsteroidSizeA;" />
							</Orbitals>

							<Orbitals count="1d6" distance="2d8+8" angle="random">
								<Station type="&stRockyOuterAsteroidSizeB;" />
							</Orbitals>
						</Group>
					</Trojan>

					<AntiTrojan>
						<Group>
							<Orbitals count="2d4+4" distance="2d8+8" angle="random">
								<Station type="&stRockyOuterAsteroidSizeA;" />
							</Orbitals>

							<Orbitals count="1d6" distance="2d8+8" angle="random">
								<Station type="&stRockyOuterAsteroidSizeB;" />
							</Orbitals>
						</Group>
					</AntiTrojan>

					<!-- Nebula at the fourth planetary orbit -->

					<Trojan offset="60">
						<SpaceEnvironment 
								type=			"&seLightNebula;"
								shape=			"arc" 
								width=			"200"
								widthVariation=	"100"
								span=			"120-160"

								patchType=		"&efNebula;"
								patchFrequency=	"50"

								encountersCount="1d4"
								>
						</SpaceEnvironment>
					</Trojan>

					<AntiTrojan offset="120">
						<SpaceEnvironment 
								type=			"&seLightNebula;"
								shape=			"arc" 
								width=			"200"
								widthVariation=	"100"
								span=			"120-160"

								patchType=		"&efNebula;"
								patchFrequency=	"50"

								encountersCount="1d4"
								>
						</SpaceEnvironment>
					</AntiTrojan>
				</Group>
			</Orbitals>

			<!-- Zheling V is a methane giant -->

			<Orbitals distance="600-660" angle="random">
				<Group>
					<Primary>
						<Station type="&stMethaneGasGiantSizeK;" name="Zheling V" showOrbit="true"/>
					</Primary>

					<Orbitals distance="18-20" angle="random">
						<Station type="&stRockyOuterAsteroidSizeB;"/>
					</Orbitals>

					<Orbitals distance="28-32" angle="random">
						<Station type="&stRockyPlanetoidSizeE;"/>
					</Orbitals>

					<Orbitals distance="40-44" angle="random">
						<Station type="&stRockyOuterAsteroidSizeD;"/>
					</Orbitals>
				</Group>
			</Orbitals>

			<!-- Create more stargates in case an extension added more links -->

			<Lookup table="HumanSpaceStargates"/>

		</SystemGroup>
	</SystemType>

	<!-- Resources -->

	<Image UNID="&rsStationsPointJuno;"	bitmap="Resources\StationsPointJuno.jpg" bitmask="Resources\StationsPointJunoMask.bmp" />
	<Image UNID="&rsPointJunoBkgnd;"	bitmap="Resources\PointJuno.jpg" loadOnUse="true" />

</TranscendenceModule>
