<?xml version="1.0" encoding="utf-8"?>

<TranscendenceModule>

<!-- AMMO BOXES -->

	<!-- Ammo Box, Akan 30 -->

	<ItemType UNID="&itAmmoBoxAkan30;"
			name=				"Akan 30 ammunition box(es)"
			level=				"4"
			value=				"1000"
			mass=				"2500"
			frequency=			"uncommon"
			unknownType=		"&vtUnknownAmmoBox;"
			attributes=			"Consumable"

			description=		"This box contains Akan 30 cannon shell cartridges."
			>

		<Image imageID="&rsItems1;" imageX="0" imageY="384" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(intAmmoBoxOpen (itmCreate &itAkan30CannonShell; 125))
		</Invoke>

	</ItemType>

	<!-- Ammo Box, White Strelka -->

	<ItemType UNID="&itAmmoBoxStrelka1;"
			name=				"White Strelka ammunition box(es)"
			level=				"5"
			value=				"2000"
			mass=				"2500"
			frequency=			"common"
			unknownType=		"&vtUnknownAmmoBox;"
			attributes=			"Consumable"

			description=		"This box contains White Strelka missiles, compatible with the Makayev launcher."
			>

		<Image imageID="&rsItems1;" imageX="0" imageY="384" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(intAmmoBoxOpen (itmCreate &itStrelkaWhite; 100))
		</Invoke>

	</ItemType>

	<!-- Ammo Box, Cluser MAG -->

	<ItemType UNID="&itAmmoBoxMAG;"
			name=				"Cluster MAG ammunition box(es)"
			level=				"6"
			value=				"1250"
			mass=				"2500"
			frequency=			"common"
			numberAppearing=	"1d4"
			unknownType=		"&vtUnknownAmmoBox;"
			attributes=			"Consumable"

			description=		"This box contains ZG24 Cluster MAGs."
			>

		<Image imageID="&rsItems1;" imageX="0" imageY="384" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(intAmmoBoxOpen (itmCreate &itZG24ClusterMAG; 25))
		</Invoke>

	</ItemType>

	<!-- Ammo Box, Thermo Cannon -->

	<ItemType UNID="&itAmmoBoxThermo;"
			name=				"thermo cannon ammunition box(es)"
			level=				"7"
			value=				"1250"
			mass=				"2500"
			frequency=			"uncommon"
			numberAppearing=	"1d6"
			unknownType=		"&vtUnknownAmmoBox;"
			attributes=			"Consumable; Military"

			description=		"This box contains thermo cannon shell cartridges."
			>

		<Image imageID="&rsItems1;" imageX="0" imageY="384" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(intAmmoBoxOpen (itmCreate &itThermoCannonShell; 25))
		</Invoke>

	</ItemType>

	<!-- Ammo Box, Red Strelka -->

	<ItemType UNID="&itAmmoBoxStrelka2;"
			name=				"Red Strelka ammunition box(es)"
			level=				"8"
			value=				"4000"
			mass=				"2500"
			frequency=			"uncommon"
			unknownType=		"&vtUnknownAmmoBox;"
			attributes=			"Consumable; Military"

			description=		"This box contains Red Strelka missiles, compatible with the Makayev launcher."
			>

		<Image imageID="&rsItems1;" imageX="0" imageY="384" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(intAmmoBoxOpen (itmCreate &itStrelkaRed; 80))
		</Invoke>

	</ItemType>

	<!-- Ammo Box, Contraband -->

	<ItemType UNID="&itAmmoBoxContraband;"
			name=				"Contraband ammunition box(es)"
			level=				"6"
			value=				"3000"
			mass=				"2500"
			frequency=			"uncommon"
			unknownType=		"&vtUnknownAmmoBox;"
			attributes=			"Consumable; Illegal; ContrabandBox"

			description=		"This sealed container, made out of an old ammunition box, contains illegal items."
			>

		<Image imageID="&rsItems1;" imageX="0" imageY="384" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(block (cost count illegalItems)
				(setq illegalItems (itmCreateRandom "* +Illegal; -ContrabandBox; -SmugglersHold; -ID;" "ruccc ccur-"))

				(setq cost (itmGetPrice illegalItems 'credit))
				(setq cost (if (eq cost 0) 100 cost))
				(setq count (divide (random 2000 4000) cost))
				(setq count (if (ls count 1) 1 count))
				(setq illegalItems (itmCreate (itmGetType illegalItems) count))

				(intAmmoBoxOpen illegalItems)
				)
		</Invoke>

	</ItemType>

	<!-- Ammo Box, Contaminated -->

	<ItemType UNID="&itAmmoBoxRadioactive;"
			name=				"contaminated ammunition box(es)"
			level=				"5"
			value=				"0"
			mass=				"2500"
			frequency=			"uncommon"
			unknownType=		"&vtUnknownAmmoBox;"
			attributes=			"Consumable; CannotOrder"

			description=		"This ammunition box contains leaky radioactive ordnance."
			>

		<Image imageID="&rsItems1;" imageX="0" imageY="384" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(block Nil
				(switch
					(shpIsRadioactive gSource)
						(objSendMessage gSource Nil "The box contained more radioactive waste")

					(shpIsRadiationImmune gSource)
						(objSendMessage gSource Nil "The box contained leaky radioactive ordnance; your ship is unaffected")

					(block Nil
						(shpMakeRadioactive gSource)
						(objSendMessage gSource Nil "The box contained leaky radioactive ordnance")
						)
					)

				; Identify the box
				(itmSetKnown gItem)

				; Remove box
				(objRemoveItem gSource gItem 1)
				)
		</Invoke>

	</ItemType>

	<!-- Ammo Box, Booby-Trapped -->

	<ItemType UNID="&itAmmoBoxParalysis;"
			name=				"booby-trapped ammunition box(es)"
			level=				"7"
			value=				"0"
			mass=				"2500"
			frequency=			"uncommon"
			unknownType=		"&vtUnknownAmmoBox;"
			attributes=			"Consumable; CannotOrder"

			description=		"This ammunition box has been rigged to disable the ship when it is opened."
			>

		<Image imageID="&rsItems1;" imageX="0" imageY="384" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(block Nil
				(objMakeParalyzed gSource (random 450 900))
				(objSendMessage gSource Nil "The box explodes; ship disabled by EMP!")

				; Identify the box
				(itmSetKnown gItem)

				; Remove box
				(objRemoveItem gSource gItem 1)
				)
		</Invoke>

	</ItemType>

	<!-- Ammo Box, Unknown -->

	<ItemType UNID="&vtUnknownAmmoBox;"
			name=				"ammunition box(es)"
			virtual=			"true"
			level=				"5"
			value=				"800"
			attributes=			"unknown"

			description=		"These heavy metal boxes are used to hold ammunition of some type. Unfortunately, you cannot decode the markings that list their actual contents."
			>

		<Names>ammunition box(es) labeled "AAAA"; ammunition box(es) labeled with bar codes;
			ammunition box(es) labeled "C17"; ammunition box(es) labeled "Demolition";
			ammunition box(es) labeled "EX1803193"; ammunition box(es) labeled "FAILED";
			ammunition box(es) labeled "GOOD"; ammunition box(es) labeled "Hexagene";
			ammunition box(es) labeled "INFLAMMABLE"; ammunition box(es) labeled "Joker71930";
			ammunition box(es) labeled "Kill, Kill, Kill"; ammunition box(es) labeled "locked";
			ammunition box(es) labeled "munitions010"; ammunition box(es) labeled "NAMI";
			ammunition box(es) labeled "Open Carefully!"; ammunition box(es) labeled "P51 ammo";
			ammunition box(es) labeled "Q5-L1-Z8"; ammunition box(es) labeled "Rasiermesser";
			ammunition box(es) labeled "SAFE"; ammunition box(es) labeled "temperature sensitive";
			ammunition box(es) labeled "UNSAFE"; ammunition box(es) labeled "victory1201";
			ammunition box(es) labeled "WARNING!"; ammunition box(es) labeled "Xplosives! Caution!";
			ammunition box(es) labeled "yellow dust"; ammunition box(es) labeled "ZG24"
		</Names>

	</ItemType>
	
<!-- ANALYZERS -->
	
	<!-- Portable Analyzer -->

	<ItemType UNID="&itPortableAnalyzer;"
			name=				"portable analyzer"
			attributes=			"analyzer; MinorItem"

			level=				"2"
			frequency=			"common"
			numberAppearing=	"1"

			charges=			"4-8"
			value=				"450"
			valueBonusPerCharge="150"
			mass=				"5"
			  
			description=		"Analyzers are automated scanners able to identify and diagnose starship devices and other items. This portable analyzer works on items of level 1, 2 and 3."

			useScreen=			"&dsRPGAnalyzeItem;"
			>

		<Image imageID="&rsItems1;" imageX="96"  imageY="672" imageWidth="96" imageHeight="96"/>
		
		<Events>
			<CanAnalyzeItem>
				(switch
					;	We can only handle items of levels 1-3
					
					(not (itmMatches (@ gData 'itemToAnalyze) "* L:1-3;"))
						{	canAnalyzeItem: Nil
							message: (cat "Unfortunately, the analyzer is not sophisticated enough to scan " (itmGetName (@ gData 'itemToAnalyze) 0x804) ".")
							}

					{	canAnalyzeItem: True }
					)
			</CanAnalyzeItem>
		</Events>
	</ItemType>

	<!-- Engineering Analyzer -->

	<ItemType UNID="&itEngineeringAnalyzer;"
			name=				"engineering analyzer"
			attributes=			"analyzer; MinorItem"
			  
			level=				"5"
			frequency=			"common"
			numberAppearing=	"1"

			charges=			"4-8"
			value=				"3000"
			valueBonusPerCharge="1000"
			mass=				"20"
			  
			description=		"An engineering analyzer is a more complex and capable version of the portable analyzer. This analyzer works on items up to level 6."

			useScreen=			"&dsRPGAnalyzeItem;"
			>

		<Image imageID="&rsItems1;" imageX="96"  imageY="672" imageWidth="96" imageHeight="96"/>
		
		<Events>
			<CanAnalyzeItem>
				(switch
					;	We can only handle items of levels 1-6
					
					(not (itmMatches (@ gData 'itemToAnalyze) "* L:1-6;"))
						{	canAnalyzeItem: Nil
							message: (cat "Unfortunately, the analyzer is not sophisticated enough to scan " (itmGetName (@ gData 'itemToAnalyze) 0x804) ".")
							}

					{	canAnalyzeItem: True }
					)
			</CanAnalyzeItem>
		</Events>
	</ItemType>

	<!-- Advanced Analyzer -->

	<ItemType UNID="&itAdvancedAnalyzer;"
			name=				"advanced analyzer"
			attributes=			"analyzer; MinorItem"
			  
			level=				"8"
			frequency=			"common"
			numberAppearing=	"1"

			charges=			"4-8"
			value=				"28000"
			valueBonusPerCharge="10000"
			mass=				"100"
			  
			description=		"The advanced analyzer is often used for researching unknown and alien technology. This analyzer works on items up to level 10."

			useScreen=			"&dsRPGAnalyzeItem;"
			>

		<Image imageID="&rsItems1;" imageX="96"  imageY="672" imageWidth="96" imageHeight="96"/>
		
		<Events>
			<CanAnalyzeItem>
				(switch
					;	We can only handle items of levels 1-10
					
					(not (itmMatches (@ gData 'itemToAnalyze) "* L:1-10;"))
						{	canAnalyzeItem: Nil
							message: (cat "Unfortunately, the analyzer is not sophisticated enough to scan " (itmGetName (@ gData 'itemToAnalyze) 0x804) ".")
							}

					{	canAnalyzeItem: True }
					)
			</CanAnalyzeItem>
		</Events>
	</ItemType>

<!-- ARMOR REPAIR -->

	<!-- Small Armor Patch -->

	<ItemType UNID="&itSmallArmorPatch;"
			name=				"small armor patch(es)"
			level=				"1"
			value=				"25"
			mass=				"1000"
			frequency=			"common"
			numberAppearing=	"1d4"
			attributes=			"ArmorRepair; Consumable"

			description=		"This is a small armor plate that can be welded to your ship's armor to repair damage."

			useScreen=			"&dsUseArmorPatch;"

			sortName=			"armor patch, small"
			>

		<Image imageID="&rsItems1;" imageX="288" imageY="576" imageWidth="96" imageHeight="96"/>
		
		<StaticData>
			<RepairHP>10</RepairHP>
		</StaticData>
		
		<Events>
			<CanRepairItem>True</CanRepairItem>
		</Events>
	</ItemType>

	<!-- Large Armor Patch -->

	<ItemType UNID="&itLargeArmorPatch;"
			name=				"large armor patch(es)"
			level=				"3"
			value=				"150"
			mass=				"1000"
			frequency=			"common"
			numberAppearing=	"1d4"
			attributes=			"ArmorRepair; Consumable"

			description=		"This is a large armor plate that can be welded to your ship's armor to repair damage."

			useScreen=			"&dsUseArmorPatch;"

			sortName=			"armor patch, large"
			>

		<Image imageID="&rsItems1;" imageX="288" imageY="576" imageWidth="96" imageHeight="96"/>

		<StaticData>
			<RepairHP>30</RepairHP>
		</StaticData>
		
		<Events>
			<CanRepairItem>True</CanRepairItem>
		</Events>
	</ItemType>

	<!-- Light Armor Repair Kit -->

	<ItemType UNID="&itLightArmorRepair;"
			name=				"light armor repair kit"
			level=				"5"
			value=				"700"
			mass=				"1500"
			frequency=			"common"
			numberAppearing=	"1d4"
			attributes=			"ArmorRepair; Consumable"

			description=		"This kit can be used in the field to repair damaged armor. It will repair up to 70 hp of damage."

			useScreen=			"&dsUseArmorPatch;"

			sortName=			"armor repair kit, 50"
			>

		<Image imageID="&rsItems1;" imageX="288" imageY="576" imageWidth="96" imageHeight="96"/>

		<StaticData>
			<RepairHP>70</RepairHP>
		</StaticData>
		
		<Events>
			<CanRepairItem>True</CanRepairItem>
		</Events>
	</ItemType>

	<!-- Medium Armor Repair Kit -->

	<ItemType UNID="&itMediumArmorRepair;"
			name=				"medium armor repair kit"
			level=				"7"
			value=				"4000"
			mass=				"1500"
			frequency=			"common"
			numberAppearing=	"1d4"
			attributes=			"ArmorRepair; Consumable"

			description=		"This kit can be used in the field to repair damaged armor. It will repair up to 120 hp of damage."

			useScreen=			"&dsUseArmorPatch;"

			sortName=			"armor repair kit, 30"
			>

		<Image imageID="&rsItems1;" imageX="288" imageY="576" imageWidth="96" imageHeight="96"/>

		<StaticData>
			<RepairHP>120</RepairHP>
		</StaticData>
		
		<Events>
			<CanRepairItem>True</CanRepairItem>
		</Events>
	</ItemType>

	<!-- Heavy Armor Repair Kit -->

	<ItemType UNID="&itHeavyArmorRepair;"
			name=				"heavy armor repair kit"
			level=				"9"
			value=				"10000"
			mass=				"1500"
			frequency=			"common"
			numberAppearing=	"1d4"
			attributes=			"ArmorRepair; Consumable"

			description=		"This kit can be used in the field to repair damaged armor. It will repair up to 200 hp of damage."

			useScreen=			"&dsUseArmorPatch;"

			sortName=			"armor repair kit, 10"
			>

		<Image imageID="&rsItems1;" imageX="288" imageY="576" imageWidth="96" imageHeight="96"/>

		<StaticData>
			<RepairHP>200</RepairHP>
		</StaticData>
		
		<Events>
			<CanRepairItem>True</CanRepairItem>
		</Events>
	</ItemType>

<!-- BARRELS -->

	<!-- Barrel of Ablative Armor Coating -->

	<ItemType UNID="&itAblativeArmorCoating;"
			name=				"[barrel(s) of ]ablative armor coating"
			level=				"1"
			value=				"40"
			mass=				"1000"
			frequency=			"uncommon"
			numberAppearing=	"1d4"
			attributes=			"ArmorEnhance; MinorItem"
			unknownType=		"&itUnknownBarrel;"

			description=		"This coating is used to protect a ship's armor against laser and particle beam weapons."

			useScreen=			"&dsUseArmorCoating;"
			data=				"ablative"

			sortName=			"ablative armor coating, barrel of"
			>

		<Image imageID="&rsItems1;" imageX="96" imageY="96" imageWidth="96" imageHeight="96"/>
	</ItemType>

	<!-- Barrel of Armor Repair Paste -->

	<ItemType UNID="&itSiliconArmorPatch;"
			name=				"[barrel(s) of ]armor repair paste"
			level=				"1"
			value=				"50"
			mass=				"1000"
			frequency=			"common"
			numberAppearing=	"1d4"
			unknownType=		"&itUnknownBarrel;"
			attributes=			"ArmorRepair; Consumable"

			description=		"Apply this paste to an armor segment to repair light to moderate damage."

			useScreen=			"&dsUseArmorPatch;"

			sortName=			"armor repair paste, barrel of"
			>

		<Image imageID="&rsItems1;" imageX="96" imageY="96" imageWidth="96" imageHeight="96"/>
		
		<StaticData>
			<BarrelDesc>"The paste is a silicon-based compound that patches damaged sections of your armor."</BarrelDesc>
			<RepairHP>(rollDice 6 6 0)</RepairHP>
		</StaticData>
		
		<Events>
			<CanRepairItem>True</CanRepairItem>
		</Events>
	</ItemType>

	<!-- Barrel of Carbon-Weaver Nanos -->

	<ItemType UNID="&itCarbonWeaverNanos;"
			name=				"[barrel(s) of ]carbon-weaver nanos"
			level=				"2"
			value=				"80"
			mass=				"1000"
			frequency=			"uncommon"
			numberAppearing=	"1d4"
			unknownType=		"&itUnknownBarrel;"
			attributes=			"ArmorEnhance; MinorItem"

			description=		"The nanomachines in this paste weave a strong carbon grid through a ship's armor. Armor that has been treated in this way will be stronger and more resistant to damage."

			useScreen=			"&dsUseArmorCoating;"
			data=				"carbon-weave"

			sortName=			"carbon-weaver nanos, barrel of"
			>

		<Image imageID="&rsItems1;" imageX="96" imageY="96" imageWidth="96" imageHeight="96"/>
	</ItemType>

	<!-- Particle Resistance Coating -->

	<ItemType UNID="&itParticleResistCoating;"
			name=				"[barrel(s) of ]particle resistance coating"
			level=				"3"
			value=				"100"
			mass=				"1000"
			frequency=			"common"
			numberAppearing=	"1d4"
			attributes=			"ArmorEnhance; MinorItem"
			unknownType=		"&itUnknownBarrel;"

			description=		"This coating is used to protect a ship's armor against particle beam weapons."

			useScreen=			"&dsUseArmorCoating;"
			data=				"particleresist"

			sortName=			"particle resistance coating, barrel of"
			>

		<Image imageID="&rsItems1;" imageX="96" imageY="96" imageWidth="96" imageHeight="96"/>
	</ItemType>

	<!-- Radiation Immunity Coating -->

	<ItemType UNID="&itRadiationImmuneCoating;"
			name=				"[barrel(s) of ]anti-radiation coating"
			level=				"4"
			value=				"350"
			mass=				"1000"
			frequency=			"rare"
			numberAppearing=	"1d4"
			attributes=			"ArmorEnhance; MinorItem"
			unknownType=		"&itUnknownBarrel;"

			description=		"This borocarbide coating absorbs deadly radiation before it can penetrate your ship's hull."

			useScreen=			"&dsUseArmorCoating;"
			data=				"radiationimmune"

			sortName=			"anti-radiation coating, barrel of"
			>

		<Image imageID="&rsItems1;" imageX="96" imageY="96" imageWidth="96" imageHeight="96"/>
	</ItemType>

	<!-- EMP Immunity Coating -->

	<ItemType UNID="&itEMPImmuneCoating;"
			name=				"[barrel(s) of ]monopole dust"
			level=				"5"
			value=				"700"
			mass=				"1000"
			frequency=			"uncommon"
			numberAppearing=	"1d4"
			attributes=			"ArmorEnhance; MinorItem"
			unknownType=		"&itUnknownBarrel5;"

			description=		"When applied to armor, monopole dust dissipates EMP energy, rendering it harmless."

			useScreen=			"&dsUseArmorCoating;"
			data=				"EMPimmune"

			sortName=			"monopole dust, barrel of"
			>

		<Image imageID="&rsItems1;" imageX="96" imageY="96" imageWidth="96" imageHeight="96"/>
	</ItemType>

	<!-- Ion Resistant Coating -->

	<ItemType UNID="&itIonResistCoating;"
			name=				"[barrel(s) of ]ion resistance coating"
			level=				"6"
			value=				"1300"
			mass=				"1000"
			frequency=			"common"
			numberAppearing=	"1d4"
			attributes=			"ArmorEnhance; MinorItem"
			unknownType=		"&itUnknownBarrel5;"

			description=		"This coating is used to protect a ship's armor against ion damage."

			useScreen=			"&dsUseArmorCoating;"
			data=				"ionresist"

			sortName=			"ion resistance coating, barrel of"
			>

		<Image imageID="&rsItems1;" imageX="96" imageY="96" imageWidth="96" imageHeight="96"/>
	</ItemType>

	<!-- Shield Interfering Coating -->

	<ItemType UNID="&itShieldInterfereCoating;"
			name=				"[barrel(s) of ]meteorsteel dust"
			level=				"6"
			value=				"200"
			mass=				"1000"
			frequency=			"uncommon"
			numberAppearing=	"1d4"
			attributes=			"ArmorEnhance; MinorItem"
			unknownType=		"&itUnknownBarrel5;"

			description=		"Meteorsteel interferes with most kinds of shield generators."

			useScreen=			"&dsUseArmorCoating;"
			data=				"shieldresist"

			sortName=			"meteorsteel dust, barrel of"
			>

		<Image imageID="&rsItems1;" imageX="96" imageY="96" imageWidth="96" imageHeight="96"/>
	</ItemType>

	<!-- Ion Effects Immunity Coating -->

	<ItemType UNID="&itIonEffectImmuneCoating;"
			name=				"[barrel(s) of ]dyon dust"
			level=				"7"
			value=				"2800"
			mass=				"1000"
			frequency=			"rare"
			numberAppearing=	"1d4"
			attributes=			"ArmorEnhance; MinorItem"
			unknownType=		"&itUnknownBarrel5;"

			description=		"Dust activated by dyons immunizes armor against ion effects that disable or damage a ship's systems."

			useScreen=			"&dsUseArmorCoating;"
			data=				"ioneffectimmune"

			sortName=			"dyon dust, barrel of"
			>

		<Image imageID="&rsItems1;" imageX="96" imageY="96" imageWidth="96" imageHeight="96"/>
	</ItemType>

	<!-- Thermo Resistant Coating -->

	<ItemType UNID="&itThermoResistCoating;"
			name=				"[barrel(s) of ]ithalium paste"
			level=				"8"
			value=				"5250"
			mass=				"1000"
			frequency=			"uncommon"
			numberAppearing=	"1d4"
			attributes=			"ArmorEnhance; MinorItem"
			unknownType=		"&itUnknownBarrel5;"

			description=		"This coating is used to protect a ship's armor against thermonuclear damage."

			useScreen=			"&dsUseArmorCoating;"
			data=				"thermoresist"

			sortName=			"ithalium paste, barrel of"
			>

		<Image imageID="&rsItems1;" imageX="96" imageY="96" imageWidth="96" imageHeight="96"/>
	</ItemType>

	<!-- Carbon Weaver 2 Coating -->

	<ItemType UNID="&itCarbonWeaver2Coating;"
			name=				"[barrel(s) of ]orthosteel nanos"
			level=				"9"
			value=				"9000"
			mass=				"1000"
			frequency=			"uncommon"
			numberAppearing=	"1d4"
			attributes=			"ArmorEnhance; MinorItem"
			unknownType=		"&itUnknownBarrel5;"

			description=		"The nanomachines in this paste weave a strong orthosteel grid through a ship's armor. Armor that has been treated in this way will be stronger and more resistant to damage."

			useScreen=			"&dsUseArmorCoating;"
			data=				"carbon-weave2"

			sortName=			"orthosteel nanos, barrel of"
			>

		<Image imageID="&rsItems1;" imageX="96" imageY="96" imageWidth="96" imageHeight="96"/>
	</ItemType>

	<!-- Barrel of Decon Gel -->

	<ItemType UNID="&itDeconGel;"
			name=				"[barrel(s) of ]decon gel"
			level=				"3"
			value=				"150"
			mass=				"1000"
			frequency=			"uncommon"
			numberAppearing=	"1d4"
			attributes=			"Consumable"
			unknownType=		"&itUnknownBarrel;"

			description=		"Decon gel is used to decontaminate radioactive metals, ceramics and other materials. It is ideal for decontaminating a ship's armor and hull."

			useScreen=			"&dsUseArmorCoating;"
			data=				"decon"

			sortName=			"decon gel, barrel of"
			>

		<Image imageID="&rsItems1;" imageX="96" imageY="96" imageWidth="96" imageHeight="96"/>
	</ItemType>

	<!-- Barrel of Degenerating Nanos -->

	<ItemType UNID="&itDegeneratingNanos;"
			name=				"[barrel(s) of ]degenerating nanos"
			level=				"4"
			value=				"25"
			mass=				"1000"
			unknownType=		"&itUnknownBarrel;"
			frequency=			"uncommon"
			numberAppearing=	"1d4"
			attributes=			"ArmorEnhance; Consumable"

			description=		"These nanomachines are used to recycle old ships and armors into their basic components. Use with caution: Do not allow contact with a ship's armor or hull."

			useScreen=			"&dsUseArmorCoating;"
			data=				"degenerating"

			sortName=			"degenerating nanos, barrel of"
			>

		<Image imageID="&rsItems1;" imageX="96" imageY="96" imageWidth="96" imageHeight="96"/>
	</ItemType>

	<!-- Barrel of Organic Acid -->

	<ItemType UNID="&itOrganicAcid;"
			name=				"[barrel(s) of ]organic acid"
			level=				"2"
			value=				"15"
			mass=				"1000"
			frequency=			"common"
			numberAppearing=	"1d4"
			unknownType=		"&itUnknownBarrel;"
			attributes=			"Consumable; Res;"

			description=		"Powerful organic acids such as these are used in various industrial processes. Use with caution: Do not allow contact with a ship's armor or hull."

			useScreen=			"&dsUseArmorCoating;"
			data=				"acid"

			sortName=			"organic acid, barrel of"
			>

		<Image imageID="&rsItems1;" imageX="96" imageY="96" imageWidth="96" imageHeight="96"/>
	</ItemType>

	<!-- Barrel of Radioactive Waste -->

	<ItemType UNID="&itRadioactiveWaste;"
			name=				"[barrel(s) of ]radioactive waste"
			level=				"4"
			value=				"0"
			mass=				"1000"
			frequency=			"uncommon"
			numberAppearing=	"1d4"
			attributes=			"Consumable; CannotOrder"
			unknownType=		"&itUnknownBarrel;"

			description=		"This is a titanium barrel filled with low and medium-level radioactive waste."

			useScreen=			"&dsUseArmorCoating;"
			data=				"radioactive"

			sortName=			"radioactive waste, barrel of"
			>

		<Image imageID="&rsItems1;" imageX="96" imageY="96" imageWidth="96" imageHeight="96"/>
	</ItemType>

	<!-- Barrel of Reactive Armor Coating -->

	<ItemType UNID="&itReactiveArmorCoating;"
			name=				"[barrel(s) of ]reactive armor coating"
			level=				"1"
			value=				"60"
			mass=				"1000"
			frequency=			"uncommon"
			numberAppearing=	"1d4"
			unknownType=		"&itUnknownBarrel;"
			attributes=			"ArmorEnhance; MinorItem"

			description=		"This coating reacts when hit by kinetic or chemical explosives and produces an opposite reaction that protect the underlying armor and hull."

			useScreen=			"&dsUseArmorCoating;"
			data=				"reactive"

			sortName=			"reactive armor coating, barrel of"
			>

		<Image imageID="&rsItems1;" imageX="96" imageY="96" imageWidth="96" imageHeight="96"/>
	</ItemType>

	<!-- Barrel of Reflective Armor Coating -->

	<ItemType UNID="&itReflectiveArmorCoating;"
			name=				"[barrel(s) of ]reflective armor coating"
			level=				"3"
			value=				"160"
			mass=				"1000"
			frequency=			"rare"
			numberAppearing=	"1d4"
			attributes=			"ArmorEnhance; MinorItem; Specialty"
			unknownType=		"&itUnknownBarrel;"

			description=		"This coating is nearly perfectly reflective at all laser weapon wavelengths. A ship's armor coated with this substance will be immune to laser weapons."

			useScreen=			"&dsUseArmorCoating;"
			data=				"reflective"

			sortName=			"reflective armor coating, barrel of"
			>

		<Image imageID="&rsItems1;" imageX="96" imageY="96" imageWidth="96" imageHeight="96"/>
	</ItemType>

	<!-- Barrel of Regenerating Nanos -->

	<ItemType UNID="&itRegeneratingNanos;"
			name=				"[barrel(s) of ]regenerating nanos"
			level=				"4"
			value=				"350"
			mass=				"1000"
			frequency=			"rare"
			numberAppearing=	"1d4"
			attributes=			"ArmorEnhance; MinorItem; Specialty"
			unknownType=		"&itUnknownBarrel;"

			description=		"The nanomachines are able to automatically regenerate any armor. Once treated with this paste an armor segment will continue to regenerate even if damaged further."

			useScreen=			"&dsUseArmorCoating;"
			data=				"regenerating"

			sortName=			"regenerating nanos, barrel of"
			>

		<Image imageID="&rsItems1;" imageX="96" imageY="96" imageWidth="96" imageHeight="96"/>
	</ItemType>

	<!-- Barrel of Repairing Nanos -->

	<ItemType UNID="&itRepairingNanos;"
			name=				"[barrel(s) of ]repairing nanos"
			level=				"3"
			value=				"260"
			mass=				"1000"
			frequency=			"uncommon"
			numberAppearing=	"1d4"
			unknownType=		"&itUnknownBarrel;"
			attributes=			"ArmorRepair; Consumable"

			description=		"Apply this paste to an armor segment to repair moderate to heavy damage."

			useScreen=			"&dsUseArmorPatch;"

			sortName=			"repairing nanos, barrel of"
			>

		<Image imageID="&rsItems1;" imageX="96" imageY="96" imageWidth="96" imageHeight="96"/>
		
		<StaticData>
			<BarrelDesc>"The paste contains a colony of nanomachines that can repair your armor."</BarrelDesc>
			<RepairHP>(rollDice 8 12 0)</RepairHP>
		</StaticData>

		<Events>
			<CanRepairItem>True</CanRepairItem>
		</Events>
	</ItemType>

	<!-- Unknown Barrels -->

	<ItemType UNID="&itUnknownBarrel;"
			name=				"barrel(s) with strange markings"
			virtual=			"true"
			level=				"1"
			value=				"150"
			attributes=			"unknown"

			description=		"These barrels are used to hold everything from chemicals to nanomachines. The markings are completely unfamiliar to you."
			>

		<Names>barrel(s) marked "H3OCH4"; barrel(s) marked "Nanobatch 3281";
			barrel(s) marked "01-9098371"; barrel(s) marked "Not for Human Consumption";
			barrel(s) marked "Keep Seal Clean"; barrel(s) marked "Caution! Volatile Compounds";
			barrel(s) marked "&#xd0;&#xe6;m&#xf6;"; barrel(s) marked "&#xbf;&#xbf;&#xbf;";
			barrel(s) marked "&#xd7;&#xd7;&#xd7;"; barrel(s) marked "Do Not Open";
			barrel(s) marked with strange symbols; barrel(s) marked with a bar code;
			barrel(s) covered with dents; barrel(s) with no markings
		</Names>

	</ItemType>

	<ItemType UNID="&itUnknownBarrel5;"
			name=				"barrel(s) with strange markings"
			virtual=			"true"
			level=				"5"
			value=				"2000"
			attributes=			"unknown"

			description=		"These barrels are used to hold everything from chemicals to nanomachines. The markings are completely unfamiliar to you."
			>

		<Names>barrel(s) marked "C4Si3OH4"; barrel(s) marked "Nanobatch A1876B";
			barrel(s) marked "27-7862481"; barrel(s) marked "Keep Pressurized";
			barrel(s) marked "Recycle"; barrel(s) marked "Do Not Discard";
			barrel(s) marked "Danger! Biohazard!"; barrel(s) marked "Use Only As Directed";
			barrel(s) marked "Salmonite&#xae;"; barrel(s) marked "Do Not Puncture";
			barrel(s) marked with Arabic script; barrel(s) marked with microdots;
			barrel(s) marked with Chinese ideograms; barrel(s) with no markings;
			barrel(s) marked "Gefahr!"; barrel(s) marked "Peligro!"
		</Names>

	</ItemType>
	
<!-- HALO GEMS -->

	<!-- Gem of Despair -->

	<ItemType UNID="&itGemOfDespair;"
			name=				"gem(s) of despair"
			level=				"7"
			value=				"2000"
			mass=				"1"
			frequency=			"veryrare"
			unknownType=		"&itUnknownHaloGem;"
			attributes=			"CannotOrder; HaloGem; MinorItem; Psionic"

			description=		"These gems are used by the Halo Races, though their exact purpose is unknown. The dark-energies embedded in the gem have an influence over spacetime that is not yet fully understood."
			>

		<Image imageID="&rsItems1;" imageX="0" imageY="576" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(if (find (sysGetNodes) "Elysium")
				(block Nil
					; Gate to Elysium
					(objSendMessage gSource Nil "\"May you find your path among the stargates...\"")
					(objGateTo gSource "Elysium" "Start" &efStargateOut;)

					; Remove the item from the player's list
					(objRemoveItem gSource gItem 1)

					; Identify the item
					(itmSetKnown gItem)
					)
					
				; Elysium not found
				(objSendMessage gSource Nil "The gem flickers for a moment but then fades without effect.")
				)
		</Invoke>
	</ItemType>

	<!-- Gem of Contrition -->

	<ItemType UNID="&itGemOfContrition;"
			name=				"gem(s) of contrition"
			level=				"8"
			value=				"5000"
			mass=				"1"
			frequency=			"veryrare"
			unknownType=		"&itUnknownHaloGem;"
			attributes=			"CannotOrder; HaloGem; MinorItem; Psionic"

			description=		"These gems are used by the Halo Races, though their exact purpose is unknown. The dark-energies embedded in the gem have an influence over spacetime that is not yet fully understood."
			>

		<Image imageID="&rsItems1;" imageX="0" imageY="576" imageWidth="96" imageHeight="96"/>

		<Invoke key="C">
			(block Nil
				; Stop time
				(objSendMessage gSource Nil "\"Use this time to right your wrongs...\"")
				(sysStopTime 500 gSource)

				; Remove the item from the player's list
				(objRemoveItem gSource gItem 1)

				; Identify the item
				(itmSetKnown gItem)
				)
		</Invoke>

	</ItemType>

	<!-- Gem of Sacrificce -->

	<ItemType UNID="&itGemOfSacrifice;"
			name=				"gem(s) of sacrifice"
			level=				"12"
			value=				"10000"
			mass=				"1"
			frequency=			"veryrare"
			unknownType=		"&itUnknownHaloGem;"
			attributes=			"HaloGem; MinorItem; CannotOrder"

			description=		"These gems are used by the Halo Races, though their exact purpose is unknown. The dark-energies embedded in the gem have an influence over spacetime that is not yet fully understood."
			>

		<Image imageID="&rsItems1;" imageX="0" imageY="576" imageWidth="96" imageHeight="96"/>

		<Invoke key="F">
			(block (sacrificeEffect)
				; Function to lower shields and armor
				(setq sacrificeEffect (lambda (theObj)
					(block Nil
						(objDepleteShields theObj)

						(for i 0 (subtract (shpGetArmorCount theObj) 1)
							(if (leq (itmGetLevel (shpGetArmor theObj i)) 12)
								(block (theDamage)
									(setq theDamage (divide (multiply (shpGetArmorMaxHitPoints theObj i) (random 96 99)) 100))
									(shpDamageArmor theObj i 12 theDamage)
									)
								)
							)

						(sysCreateEffect &efGemOfSacrifice; theObj (objGetPos theObj))
						)
					))

				; All ships in range have their shields lowered
				(objSendMessage gSource Nil "\"May your sacrifice prove true...\"")
				(enum (sysFindObject gSource "sN:30;") theObj
					(sacrificeEffect theObj)
					)

				; Invoker also gets effect
				(sacrificeEffect gSource)

				; Remove the item from the player's list
				(objRemoveItem gSource gItem 1)

				; Identify the item
				(itmSetKnown gItem)
				)
		</Invoke>

	</ItemType>

<!-- Miscellaneous ROMS -->

	<!-- Autopilot ROM -->

	<ItemType UNID="&itAutopilotROM;"
			name=				"autopilot ROM"
			level=				"1"
			value=				"50"
			mass=				"1"
			frequency=			"uncommon"
			unknownType=		"&itUnknownROM;"
			attributes=			"Info; MinorItem"

			description=		"This program allows the ship's captain to rest while the ship maintains a steady course."
			>

		<Image imageID="&rsItems1;" imageX="192" imageY="96" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(block Nil
				; Install
				(if (not (eq (objGetEquipmentStatus gSource 'Autopilot) 'notInstalled))
					(objSendMessage gSource Nil "Ship already has an autopilot")
					(block Nil
						(objChangeEquipmentStatus gSource 'Autopilot 'install)
						(objSendMessage gSource Nil "Autopilot installed")
						)
					)

				; Identify the item
				(itmSetKnown gItem)

				; Remove ROM
				(objRemoveItem gSource gItem 1)
				)
		</Invoke>

	</ItemType>

	<!-- Cash Card, Blue -->

	<ItemType UNID="&itCashCardBlue;"
			name=				"blue cash card"
			level=				"2"
			value=				"100"
			mass=				"1"
			frequency=			"rare"
			unknownType=		"&itUnknownROM;"
			attributes=			"Consumable; CannotOrder"

			description=		"This ROM stores digital cash and may be redeemed automatically with your ship's computer."

			charges=			"4d25"
			valueCharges=		"true"
			>

		<Image imageID="&rsItems1;" imageX="192" imageY="96" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(block (amount)
				(setq amount (multiply (itmGetCharges gItem) 2))
				(objSendMessage gSource Nil (cat amount " credits deposited to your account."))
				(plyCredit gPlayer amount)

				; Identify the item
				(itmSetKnown gItem)

				; Remove ROM
				(objRemoveItem gSource gItem 1)
				)
		</Invoke>
	</ItemType>

	<!-- Cash Card, Gold -->

	<ItemType UNID="&itCashCardGold;"
			name=				"gold cash card"
			level=				"4"
			value=				"1000"
			mass=				"1"
			frequency=			"rare"
			unknownType=		"&itUnknownROM;"
			attributes=			"Consumable; CannotOrder"

			description=		"This ROM stores digital cash and may be redeemed automatically with your ship's computer."

			charges=			"4d25"
			valueCharges=		"true"
			>

		<Image imageID="&rsItems1;" imageX="192" imageY="96" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(block (amount)
				(setq amount (multiply (itmGetCharges gItem) 10))
				(objSendMessage gSource Nil (cat amount " credits deposited to your account."))
				(plyCredit gPlayer amount)

				; Identify the item
				(itmSetKnown gItem)

				; Remove ROM
				(objRemoveItem gSource gItem 1)
				)
		</Invoke>
	</ItemType>

	<!-- Cash Card, Platinum -->

	<ItemType UNID="&itCashCardPlatinum;"
			name=				"platinum cash card"
			level=				"6"
			value=				"10000"
			mass=				"1"
			frequency=			"rare"
			unknownType=		"&itUnknownROM;"
			attributes=			"Consumable; CannotOrder"

			description=		"This ROM stores digital cash and may be redeemed automatically with your ship's computer."

			charges=			"4d25"
			valueCharges=		"true"
			>

		<Image imageID="&rsItems1;" imageX="192" imageY="96" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(block (amount)
				(setq amount (multiply (itmGetCharges gItem) 100))
				(objSendMessage gSource Nil (cat amount " credits deposited to your account."))
				(plyCredit gPlayer amount)

				; Identify the item
				(itmSetKnown gItem)

				; Remove ROM
				(objRemoveItem gSource gItem 1)
				)
		</Invoke>
	</ItemType>

	<!-- Data ROM 

	EXTRA DATA

	text:			The document contents of the data ROM should be stored in this data variable
					(itmSetData theItem "text" "{the document content}")

	-->

	<ItemType UNID="&itDataROM;"
			name=				"data ROM"
			level=				"1"
			value=				"0"
			mass=				"1"
			frequency=			"notrandom"
			attributes=			"Info; MinorItem; NotForSale"

			description=		"Data ROMs are used to store everything from personal mail to ship's logs."

			useScreen=			"&dsUseDataROM;"
			>

		<Image imageID="&rsItems1;" imageX="192" imageY="96" imageWidth="96" imageHeight="96"/>

	</ItemType>

	<!-- Neurohack ROM -->

	<ItemType UNID="&itNeurohackROM;"
			name=				"neurohack ROM"
			level=				"10"
			value=				"500"
			mass=				"1"
			frequency=			"notrandom"
			unknownType=		"&itUnknownROM;"
			attributes=			"Info; MinorItem; NeurohackROM; NotForSale"

			description=		"This ROM enables you to connect to AIs and subdue them."
			
			charges=			"3"
			valueCharges=		"true"
			>

		<Image imageID="&rsItems1;" imageX="192" imageY="96" imageWidth="96" imageHeight="96"/>
		
		<Invoke>
			(objSendMessage gSource Nil "Dock with AI to begin neurohack")
		</Invoke>
	</ItemType>

	<!-- ROM: enhance visual display -->

	<ItemType UNID="&itEnhanceSRSROM;"
			name=				"visual display enhancement ROM"
			level=				"2"
			value=				"150"
			mass=				"1"
			frequency=			"common"
			unknownType=		"&itUnknownROM;"
			attributes=			"Info; MinorItem"

			description=		"This ROM enhances a ship's visual display to show the bearing of ships and stations beyond normal visual range."
			>

		<Image imageID="&rsItems1;" imageX="192" imageY="96" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(block Nil
				(switch
					(eq (objGetEquipmentStatus gSource 'SRS) 'damaged)
						(block Nil
							(objChangeEquipmentStatus gSource 'SRS 'repair)
							(objSendMessage gSource Nil "Visual display repaired")
							)

					(eq (objGetEquipmentStatus gSource 'SRSEnhancer) 'ready)
						(objSendMessage gSource Nil "Visual display already enhanced")

					(block Nil
						(objChangeEquipmentStatus gSource 'SRSEnhancer 'install)
						(objSendMessage gSource Nil "Visual display enhanced")
						)
					)

				; Identify the item
				(itmSetKnown gItem)

				; Remove ROM
				(objRemoveItem gSource gItem 1)
				)
		</Invoke>
	</ItemType>

	<!-- ROM: Defective visual display -->

	<ItemType UNID="&itSRSDamageROM;"
			name=				"defective visual display ROM"
			level=				"2"
			value=				"5"
			mass=				"1"
			frequency=			"uncommon"
			unknownType=		"&itUnknownROM;"
			attributes=			"Info; MinorItem"

			description=		"This ROM would normally enhance a ship's visual display, but a manufacturing defect makes it worse than useless. Plugging this in to your ship's computer will temporarily damage your display screen."

			sortName=			"visual display ROM, defective"
			>

		<Image imageID="&rsItems1;" imageX="192" imageY="96" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(block Nil
				(objChangeEquipmentStatus gSource 'SRS 'damage 3000)
				(objSendMessage gSource Nil "ROM failure: Visual display temporarily damaged")

				; Identify the item
				(itmSetKnown gItem)

				; Remove ROM
				(objRemoveItem gSource gItem 1)
				)
		</Invoke>
	</ItemType>

	<!-- Rowena's Weapons and Armor: Vol 1 -->

	<ItemType UNID="&itRowenaVol1;"
			name=				"[ROM(s) of ]Rowena's Weapons and Armor: Volume I"
			level=				"1"
			value=				"50"
			mass=				"1"
			frequency=			"notrandom"
			unknownType=		"&itUnknownROM;"
			attributes=			"Info; MinorItem"

			description=		"The definitive guide to starship weapons and armor. This ROM contains specification for commercially available weapons and armor of the Commonwealth."
			>

		<Image imageID="&rsItems1;" imageX="192" imageY="96" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(block Nil
				(objSendMessage gSource Nil "\"Rowena's Weapons and Armor (Volume I)\" installed")
				(itmEnumTypes "adsw" itemType
					(if (and (geq (itmGetLevel itemType) 1) (leq (itmGetLevel itemType) 5))
						(itmSetReference itemType)
						)
					)

				; Identify the item
				(itmSetKnown gItem)

				; Remove ROM
				(objRemoveItem gSource gItem 1)
				)
		</Invoke>
	</ItemType>

	<!-- Rowena's Weapons and Armor: Vol 2 -->

	<ItemType UNID="&itRowenaVol2;"
			name=				"[ROM(s) of ]Rowena's Weapons and Armor: Volume II"
			level=				"4"
			value=				"500"
			mass=				"1"
			frequency=			"notrandom"
			unknownType=		"&itUnknownROM;"
			attributes=			"Info; MinorItem"

			description=		"The definitive guide to starship weapons and armor. This ROM contains specification for military weapons and armor used in the Commonwealth."
			>

		<Image imageID="&rsItems1;" imageX="192" imageY="96" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(block Nil
				(objSendMessage gSource Nil "\"Rowena's Weapons and Armor (Volume II)\" installed")
				(itmEnumTypes "adsw" itemType
					(if (and (geq (itmGetLevel itemType) 6) (leq (itmGetLevel itemType) 10))
						(itmSetReference itemType)
						)
					)

				; Identify the item
				(itmSetKnown gItem)

				; Remove ROM
				(objRemoveItem gSource gItem 1)
				)
		</Invoke>
	</ItemType>

	<!-- Rowena's Weapons and Armor: Vol 3 -->

	<ItemType UNID="&itRowenaVol3;"
			name=				"[ROM(s) of ]Rowena's Weapons and Armor: Volume III"
			level=				"8"
			value=				"2500"
			mass=				"1"
			frequency=			"notrandom"
			unknownType=		"&itUnknownROM;"
			attributes=			"Info; MinorItem"

			description=		"The definitive guide to starship weapons and armor. This ROM contains specification for weapons and armor used by the Ancient Races."
			>

		<Image imageID="&rsItems1;" imageX="192" imageY="96" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(block Nil
				(objSendMessage gSource Nil "\"Rowena's Weapons and Armor (Volume III)\" installed")
				(itmEnumTypes "adsw" itemType
					(if (and (geq (itmGetLevel itemType) 11) (leq (itmGetLevel itemType) 15))
						(itmSetReference itemType)
						)
					)

				; Identify the item
				(itmSetKnown gItem)

				; Remove ROM
				(objRemoveItem gSource gItem 1)
				)
		</Invoke>
	</ItemType>

	<!-- Rowena's Weapons and Armor: Vol 4 -->

	<ItemType UNID="&itRowenaVol4;"
			name=				"[ROM(s) of ]Rowena's Weapons and Armor: Volume IV"
			level=				"12"
			value=				"10000"
			mass=				"1"
			frequency=			"notrandom"
			unknownType=		"&itUnknownROM;"
			attributes=			"Info; MinorItem"

			description=		"The definitive guide to starship weapons and armor. This ROM contains specification for weapons and armor developed by the Halo Races."

			>

		<Image imageID="&rsItems1;" imageX="192" imageY="96" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(block Nil
				(objSendMessage gSource Nil "\"Rowena's Weapons and Armor (Volume IV)\" installed")
				(itmEnumTypes "adsw" itemType
					(if (and (geq (itmGetLevel itemType) 16) (leq (itmGetLevel itemType) 20))
						(itmSetReference itemType)
						)
					)

				; Identify the item
				(itmSetKnown gItem)

				; Remove ROM
				(objRemoveItem gSource gItem 1)
				)
		</Invoke>
	</ItemType>

	<!-- Rowena's Weapons and Armor: Vol 5 -->

	<ItemType UNID="&itRowenaVol5;"
			name=				"[ROM(s) of ]Rowena's Weapons and Armor: Volume V"
			level=				"16"
			value=				"30000"
			mass=				"1"
			frequency=			"notrandom"
			unknownType=		"&itUnknownROM;"
			attributes=			"Info; MinorItem"

			description=		"The definitive guide to starship weapons and armor. This ROM contains specification for weapons and armor used by the Hierodules and the entities Oracus and Domina."

			>

		<Image imageID="&rsItems1;" imageX="192" imageY="96" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(block Nil
				(objSendMessage gSource Nil "\"Rowena's Weapons and Armor (Volume V)\" installed")
				(itmEnumTypes "adsw" itemType
					(if (and (geq (itmGetLevel itemType) 21) (leq (itmGetLevel itemType) 25))
						(itmSetReference itemType)
						)
					)

				; Identify the item
				(itmSetKnown gItem)

				; Remove ROM
				(objRemoveItem gSource gItem 1)
				)
		</Invoke>
	</ItemType>

	<!-- System Map ROM -->

	<ItemType UNID="&itSystemMapROM;"
			name=				"system map ROM"
			level=				"2"
			value=				"100"
			mass=				"1"
			frequency=			"uncommon"
			unknownType=		"&itUnknownROM;"
			attributes=			"Consumable; Info"

			description=		"This program accesses the central cartography libraries to generate a map of the current system."
			>

		<Image imageID="&rsItems1;" imageX="192" imageY="96" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(block (obj mappedAll mapEnemy)
				(setq mappedAll True)

				; Compute the probability of mapping an enemy station
				(switch
					(geq (sysGetLevel) 7)
						(setq mapEnemy 0)

					(geq (sysGetLevel) 3)
						(setq mapEnemy (subtract 360 (multiply 72 (subtract (sysGetLevel) 2))))

					(setq mapEnemy 360)
					)

				; Iterate over all stations in the system
				(enum (sysFindObject gSource "Ts") obj
					(switch
						(and (objIsEnemy gSource obj) (gr (add (objGetDestiny obj) 1) mapEnemy))
							(setq mappedAll Nil)

						(objHasAttribute obj "uncharted")
							(setq mappedAll Nil)

						(objSetKnown obj)
						)
					)

				(if mappedAll
					(objSendMessage gSource Nil "Mapped all stations in system")
					(objSendMessage gSource Nil "Mapped charted stations in system")
					)

				; Identify the item
				(itmSetKnown gItem)

				; Remove ROM
				(objRemoveItem gSource gItem 1)
				)
		</Invoke>
	</ItemType>

	<!-- Military System Map ROM -->

	<ItemType UNID="&itMilitaryMapROM;"
			name=				"military map ROM"
			level=				"4"
			value=				"500"
			mass=				"1"
			frequency=			"uncommon"
			unknownType=		"&itUnknownROM;"
			attributes=			"Consumable; Info; Military"

			description=		"This program accesses military databases to generate a map of enemy stations in the system."
			>

		<Image imageID="&rsItems1;" imageX="192" imageY="96" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(block Nil
				(if	(not (sysFindObject gSource "Ts AB:commonwealth;"))

					; If there are no commonwealth stations in the system, then we cannot function
					(block Nil
						(objSendMessage gSource Nil "Unable to connect to military cartography in this system")
						)

					; Otherwise, we map all enemy stations
					(block (obj)
						(enum (sysFindObject gSource "ETs") obj
							(objSetKnown obj)
							)

						(objSendMessage gSource Nil "Mapped all enemy stations in system")

						; Remove ROM
						(objRemoveItem gSource gItem 1)
						)
					)

				; Identify the item
				(itmSetKnown gItem)
				)
		</Invoke>
	</ItemType>

	<!-- Targeting Computer ROM -->

	<ItemType UNID="&itTargetingComputerROM;"
			name=				"targeting program ROM"
			level=				"3"
			value=				"300"
			mass=				"1"
			frequency=			"uncommon"
			unknownType=		"&itUnknownROM;"
			attributes=			"Info; MinorItem"

			description=		"A targeting program is required to aim guided missiles such as the KM500 Stiletto."
			>

		<Image imageID="&rsItems1;" imageX="192" imageY="96" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(block Nil
				(if (eq (objGetEquipmentStatus gPlayerShip 'TargetingComputer) 'ready)
					(objSendMessage gSource Nil "Ship already has targeting program")
					(block Nil
						(objChangeEquipmentStatus gPlayerShip 'TargetingComputer 'install)
						(objSendMessage gSource Nil "Targeting program installed")
						)
					)

				; Identify the item
				(itmSetKnown gItem)

				; Remove ROM
				(objRemoveItem gSource gItem 1)
				)
		</Invoke>
	</ItemType>

	<!-- Unknown ROM -->

	<ItemType UNID="&itUnknownROM;"
			name=				"ROM biosoft(s)"
			virtual=			"true"
			level=				"1"
			value=				"150"
			attributes=			"unknown"

			description=		"These ROM biochips are generally used to upgrade a computer's neural network. Unfortunately, you have no knowledge of the software's specific nature or purpose."
			>

		<Names>ROM biosoft(s) labeled "1701"; ROM biosoft(s) labeled "0x0009FFD9";
			ROM biosoft(s) labeled "Serenity"; ROM biosoft(s) labeled "Storm";
			ROM biosoft(s) labeled "V y ger"; ROM biosoft(s) labeled "Codeslinger";
			ROM biosoft(s) labeled "5.0.1"; ROM biosoft(s) labeled "TI901";
			ROM biosoft(s) labeled "1.4b"; ROM biosoft(s) labeled "3.0";
			ROM biosoft(s) labeled "X10.3"; ROM biosoft(s) labeled "r2";
			ROM biosoft(s) labeled "&#xd8;"; ROM biosoft(s) labeled "0xbaadf00d";
			ROM biosoft(s) labeled "Release 3.2"; ROM biosoft(s) labeled "&#xdf;eta";
			ROM biosoft(s) labeled "&#xa9;2418 NeuroSoft, rce"; ROM biosoft(s) labeled "&#xa9;2401 Black Sun, rce";
			ROM biosoft(s) with no label; ROM biosoft(s) labeled "GAAADTAG"
		</Names>

	</ItemType>

<!-- SHIELD ENHANCEMENTS -->

	<!-- ROM: Enhance shields -->

	<ItemType UNID="&itEnhanceShieldsROM;"
			name=				"shield enhancement ROM"
			level=				"2"
			value=				"500"
			mass=				"1"
			frequency=			"uncommon"
			unknownType=		"&itUnknownROM;"
			attributes=			"Info; MinorItem"

			description=		"This ROM upgrades a shield generator so that it is more effective at absorbing damage. The ROM works on generators up to technology level VI."
			>

		<Image imageID="&rsItems1;" imageX="192" imageY="96" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(block (notFound)
				; Install
				(setq notFound True)
				(objEnumItems gSource "sI" theItem
					(block (shieldItem)
						(setq shieldItem theItem)
						(if notFound
							(block Nil
								(switch
									; Alien items cannot be enhanced
									(itmHasModifier shieldItem "Alien")
										(objSendMessage gSource Nil "Shield generator is too alien for the ROM to enhance")

									; If the shield generator is too advanced, then nothing happens
									(gr (itmGetLevel shieldItem) 6)
										(objSendMessage gSource Nil "Shield generator is too advanced for the ROM to enhance")

									; If the item is damaged, we repair it
									(itmIsDamaged shieldItem)
										(block Nil
											(shpRepairItem gSource theItem)
											(objSendMessage gSource Nil "Shield generator has been repaired")
											)

									; Enhance the shield generator
									(block (result)
										(setq result (shpEnhanceItem gSource theItem 0x0102))
										(objSendMessage gSource Nil (intItemEnhanceStatus result "Your shields are more powerful" "shield generator"))
										)
									)
								(setq notFound Nil)
								)
							)
						)
					)

				(if notFound
					(objSendMessage gSource Nil "Shield generator required")
					)

				; Identify the item
				(itmSetKnown gItem)

				; Remove ROM
				(objRemoveItem gSource gItem 1)
				)
		</Invoke>
	</ItemType>

	<!-- Diamond field crystal -->

	<ItemType UNID="&itDiamondCrystal;"
			name=				"diamond field crystal"
			level=				"8"
			value=				"40000"
			mass=				"10"
			frequency=			"rare"
			unknownType=		"&vtUnknownFieldCrystal;"
			attributes=			"MajorItem; FieldCrystal"

			description=		"Diamond field crystals increase the power of tech VII-XII shield generators. Unlike other field crystals, a generator can use multiple diamond field crystals."
			>

		<Image imageID="&rsItems1;" imageX="288" imageY="384" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(intFieldCrystalUse 0x0100 "Your shields are more powerful")
		</Invoke>
	</ItemType>

	<!-- Yellow Etherium field crystal -->

	<ItemType UNID="&itYellowEtheriumCrystal;"
			name=				"yellow etherium field crystal"
			level=				"11"
			value=				"300000"
			mass=				"10"
			frequency=			"uncommon"
			unknownType=		"&vtUnknownFieldCrystal;"
			attributes=			"MajorItem; FieldCrystal"

			description=		"Yellow etherium is used to create energy fields that reflect positron energy. Unfortunately, it has a limited duration."

			enhancement=		"0x0369"
			>

		<Image imageID="&rsItems1;" imageX="288" imageY="384" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(intFieldCrystalInstall &itYellowEtheriumCrystal; (random 30000 40000))
		</Invoke>
		
		<Events>
			<OnAddedAsEnhancement>
				(objSendMessage gSource Nil (cat
					"Your shields now reflect positron damage"
					(if (eq aResult 6) " (previous enhancement lost)" "")
					))
			</OnAddedAsEnhancement>
			
			<OnRemovedAsEnhancement>
				(objSendMessage gSource Nil "Yellow etherium crystal has burned out")
			</OnRemovedAsEnhancement>
		</Events>
	</ItemType>

	<!-- Decayed Etherium field crystal -->

	<ItemType UNID="&itDecayedEtheriumCrystal;"
			name=				"decayed etherium field crystal"
			level=				"7"
			value=				"10"
			mass=				"10"
			frequency=			"uncommon"
			unknownType=		"&vtUnknownFieldCrystal;"
			attributes=			"MinorItem; FieldCrystal"

			description=		"In pristine state, this field crystal is used to reflect ion energy. But this decayed crystal would do more harm than good."
			>

		<Image imageID="&rsItems1;" imageX="288" imageY="384" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(intFieldCrystalUse 0x834A "Your shields fade")
		</Invoke>
	</ItemType>

	<!-- Blue Etherium field crystal -->

	<ItemType UNID="&itBlueEtheriumCrystal;"
			name=				"blue etherium field crystal"
			level=				"8"
			value=				"60000"
			mass=				"10"
			frequency=			"uncommon"
			unknownType=		"&vtUnknownFieldCrystal;"
			attributes=			"MajorItem; FieldCrystal"

			description=		"Blue etherium is used to create energy fields that reflect ion energy. Unfortunately, it has a limited duration."
			
			enhancement=		"0x0349"
			>

		<Image imageID="&rsItems1;" imageX="288" imageY="384" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(intFieldCrystalInstall &itBlueEtheriumCrystal; (random 30000 40000))
		</Invoke>
		
		<Events>
			<OnAddedAsEnhancement>
				(objSendMessage gSource Nil (cat
					"Your shields now reflect ion damage"
					(if (eq aResult 6) " (previous enhancement lost)" "")
					))
			</OnAddedAsEnhancement>
			
			<OnRemovedAsEnhancement>
				(objSendMessage gSource Nil "Blue etherium crystal has burned out")
			</OnRemovedAsEnhancement>
		</Events>
	</ItemType>

	<!-- Molbidium field crystal -->

	<ItemType UNID="&itMolbidiumCrystal;"
			name=				"molbidium field crystal"
			level=				"7"
			value=				"25000"
			mass=				"10"
			frequency=			"common"
			unknownType=		"&vtUnknownFieldCrystal;"
			attributes=			"MajorItem; FieldCrystal"

			description=		"Molbidium crystals are often used to increase the power density of shield generators."
			>

		<Image imageID="&rsItems1;" imageX="288" imageY="384" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(intFieldCrystalUse 0x0103 "Your shields are more powerful")
		</Invoke>
	</ItemType>

	<!-- Green Etherium field crystal -->

	<ItemType UNID="&itGreenEtheriumCrystal;"
			name=				"green etherium field crystal"
			level=				"6"
			value=				"10000"
			mass=				"10"
			frequency=			"common"
			unknownType=		"&vtUnknownFieldCrystal;"
			attributes=			"MajorItem; FieldCrystal"

			description=		"Green etherium is used to create energy fields that reflect particle beam energy. Unfortunately, it has a limited duration."

			enhancement=		"0x0329"
			>

		<Image imageID="&rsItems1;" imageX="288" imageY="384" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(intFieldCrystalInstall &itGreenEtheriumCrystal; (random 30000 40000))
		</Invoke>
		
		<Events>
			<OnAddedAsEnhancement>
				(objSendMessage gSource Nil (cat
					"Your shields now reflect particle damage"
					(if (eq aResult 6) " (previous enhancement lost)" "")
					))
			</OnAddedAsEnhancement>
			
			<OnRemovedAsEnhancement>
				(objSendMessage gSource Nil "Green etherium crystal has burned out")
			</OnRemovedAsEnhancement>
		</Events>
	</ItemType>

	<!-- Field Crystal, Unknown -->

	<ItemType UNID="&vtUnknownFieldCrystal;"
			name=				"energy field crystal(s)"
			virtual=			"true"
			level=				"7"
			value=				"1000"
			attributes=			"unknown"

			description=		"These rare crystals are used to modulate energy fields, such as those created by shield generators. Unfortunately, you cannot decode the crystal's markings."
			>

		<Names>field crystal(s) marked "AK3GH1"; field crystal(s) marked "B8K1GA";
			field crystal(s) marked "C0M9JH"; field crystal(s) marked "D930JA";
			field crystal(s) marked "E2E8MO"; field crystal(s) marked "F3K9BA";
			field crystal(s) marked "G1 rating"; field crystal(s) marked "H-field compatible";
			field crystal(s) marked "I3MO7A"; field crystal(s) marked "J3 rating";
			field crystal(s) marked "K-field neutral"; field crystal(s) marked "L1Z3GA";
			field crystal(s) marked "M7 inducer"; field crystal(s) marked "N4M1ZA";
			field crystal(s) marked "O3-field compatible"; field crystal(s) marked "P93MA8";
			field crystal(s) marked "Q inducer"; field crystal(s) marked "R-field compatible";
			field crystal(s) marked "S-field neutral"; field crystal(s) marked "T1 inducer";
			field crystal(s) marked "UV8 antagonist"; field crystal(s) marked "V3TA2B";
			field crystal(s) marked "W3 range"; field crystal(s) marked "X4";
			field crystal(s) marked "Z-field neutral"
		</Names>

	</ItemType>

<!-- WEAPON ENHANCEMENTS -->

	<!-- Laser Amplifier -->

	<ItemType UNID="&itLaserAmplifier;"
			name=				"laser amplifier"
			level=				"1"
			value=				"250"
			mass=				"25"
			frequency=			"uncommon"
			attributes=			"MinorItem"

			description=		"Laser amplifiers are used to repair and upgrade laser weapons."
			>

		<Image imageID="&rsItems1;" imageX="192" imageY="576" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(intEnhanceWeaponUse 0x0100 0 "is more powerful")
		</Invoke>
	</ItemType>

	<!-- Kinetic Upgrade -->

	<ItemType UNID="&itKineticUpgrade;"
			name=				"kinetic upgrade"
			level=				"2"
			value=				"350"
			mass=				"50"
			frequency=			"rare"
			attributes=			"MinorItem"

			description=		"Kinetic upgrades increase the damage of a kinetic weapon."
			>

		<Image imageID="&rsItems1;" imageX="192" imageY="576" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(intEnhanceWeaponUse 0x0100 1 "is more powerful")
		</Invoke>
	</ItemType>

	<!-- Particle Upgrade -->

	<ItemType UNID="&itParticleUpgrade;"
			name=				"particle source upgrade"
			level=				"4"
			value=				"500"
			mass=				"25"
			frequency=			"uncommon"
			attributes=			"MinorItem"

			description=		"This weapon upgrade increases the power of particle beams."
			>

		<Image imageID="&rsItems1;" imageX="192" imageY="576" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(intEnhanceWeaponUse 0x0100 2 "is more powerful")
		</Invoke>
	</ItemType>

	<!-- Blast Upgrade -->

	<ItemType UNID="&itBlastUpgrade;"
			name=				"hexagene booster"
			level=				"5"
			value=				"1000"
			mass=				"75"
			frequency=			"uncommon"
			attributes=			"MinorItem"

			description=		"This high-explosive upgrade increases the damage done by blast weapons."
			>

		<Image imageID="&rsItems1;" imageX="192" imageY="576" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(intEnhanceWeaponUse 0x0100 3 "is more powerful")
		</Invoke>
	</ItemType>

	<!-- Ion Upgrade -->

	<ItemType UNID="&itIonUpgrade;"
			name=				"ion power capacitor"
			level=				"7"
			value=				"2500"
			mass=				"50"
			frequency=			"rare"
			attributes=			"MinorItem"

			description=		"Ion power capacitors are used to increase the destructive power of ion weapons."
			>

		<Image imageID="&rsItems1;" imageX="192" imageY="576" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(intEnhanceWeaponUse 0x0100 4 "is more powerful")
		</Invoke>
	</ItemType>

	<!-- Thermo Upgrade -->

	<ItemType UNID="&itThermoUpgrade;"
			name=				"tritium injector"
			level=				"8"
			value=				"5000"
			mass=				"150"
			frequency=			"uncommon"
			attributes=			"MinorItem"

			description=		"This weapon upgrade increases the damage done by thermo weapons."
			>

		<Image imageID="&rsItems1;" imageX="192" imageY="576" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(intEnhanceWeaponUse 0x0100 5 "is more powerful")
		</Invoke>
	</ItemType>

	<!-- Weapon Enhancement ROM -->

	<ItemType UNID="&itWeaponSpeedROM;"
			name=				"weapon optimizer ROM"
			level=				"3"
			value=				"750"
			mass=				"1"
			frequency=			"uncommon"
			unknownType=		"&itUnknownROM;"
			attributes=			"Info; MinorItem"

			description=		"This ROM increases the rate of fire of the ship's primary weapon."
			>

		<Image imageID="&rsItems1;" imageX="192" imageY="96" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(intEnhanceWeaponUse 0x1002 Nil "has an improved fire rate")
		</Invoke>
	</ItemType>

	<!-- Defective Weapon Enhancement ROM -->

	<ItemType UNID="&itDamageWeaponROM;"
			name=				"defective weapon enhancement ROM"
			level=				"3"
			value=				"5"
			mass=				"1"
			frequency=			"veryrare"
			unknownType=		"&itUnknownROM;"
			attributes=			"Info; MinorItem"

			description=		"Because of a manufacturing defect, this ROM damages the ship's primary weapon when installed."
			>

		<Image imageID="&rsItems1;" imageX="192" imageY="96" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(block (notFound)
				; Install
				(setq notFound True)
				(objEnumItems gPlayerShip "wI" theItem
					(block (weaponItem)
						(setq weaponItem theItem)
						(if (and notFound 
								(eq (shpGetItemDeviceName gSource weaponItem) 0))
							(block Nil
								(shpDamageItem gSource theItem)
								(objSendMessage gSource Nil (cat (itmGetName weaponItem 33) " damaged by defective ROM"))
								(setq notFound Nil)
								)
							)
						)
					)

				(if notFound
					(objSendMessage gSource Nil "Primary weapon required")
					)

				; Identify the item
				(itmSetKnown gItem)

				; Remove ROM
				(objRemoveItem gSource gItem 1)
				)
		</Invoke>
	</ItemType>

<!-- HIRO'S ALGORITHMS -->

	<!-- Hiro's Shield Optimizer -->

	<ItemType UNID="&itHiroShieldOptimizer;"
			name=				"Hiro's shield optimizer"
			level=				"4"
			value=				"5000"
			mass=				"1"
			frequency=			"veryrare"
			unknownType=		"&itUnknownROM;"
			attributes=			"Info; MinorItem; NotForSale"

			description=		"One of Hiro's first creations, this ROM can increase the strength of any shield generator up to tech level VI."
			>

		<Image imageID="&rsItems1;" imageX="192" imageY="96" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(block (notFound)
				; Install
				(setq notFound True)
				(objEnumItems gSource "sI" theItem
					(block (shieldItem)
						(setq shieldItem theItem)
						(if notFound
							(block Nil
								(switch
									; If the shield generator is too advanced, then nothing happens
									(gr (itmGetLevel shieldItem) 6)
										(objSendMessage gSource Nil "Hiro: Shield tech too high. ROM abort.")

									; If the item is damaged, we repair it
									(itmIsDamaged shieldItem)
										(block Nil
											(shpRepairItem gSource theItem)
											(objSendMessage gSource Nil "Hiro: Shield repair algorithm successful")
											)

									; Enhance the shield generator
									(block (result)
										(setq result (shpEnhanceItem gSource theItem 0x0105))
										(objSendMessage gSource Nil (intItemEnhanceStatus result "Hiro: Shield optimization complete" "shield generator"))
										)
									)
								(setq notFound Nil)
								)
							)
						)
					)

				(if notFound
					(objSendMessage gSource Nil "Hiro: No shield found. ROM abort.")
					)

				; Identify the item
				(itmSetKnown gItem)

				; Remove ROM
				(objRemoveItem gSource gItem 1)
				)
		</Invoke>
	</ItemType>
	
<!-- DOCK SCREENS -->

	<!-- Use Armor Patch
	
	GLOBAL DATA
	
	skillLevel:			Total number of successful uses
	
	-->

	<DockScreen UNID="&dsUseArmorPatch;"
			name=				"Ship's Interior"
			type=				"itemPicker"
			backgroundID=		"&rsItemListScreen;"
			>

		<ListOptions
			dataFrom=	"player"
			list=		"aI"
			/>
			
		<InitialPane>
			(switch
				(not (itmIsKnown gItem))
					"UnknownBarrel"
					
				"Default"
				)
		</InitialPane>
			
		<Panes>
			<Default>
				<OnPaneInit>
					(block (type damage desc skillLevel)
						; Init skill level
						(setq skillLevel (typGetGlobalData &dsUseArmorPatch; "skillLevel"))
						(if (not skillLevel)
							(block Nil
								(typSetGlobalData &dsUseArmorPatch; "skillLevel" 0)
								(setq skillLevel 0)
								)
							)
							
						; Intro, if necessary
						
						(setq desc (objFireItemEvent gSource gItem "GetRepairItemIntro"))
						(if (not desc)
							(setq desc "")
							)
							
						; Figure out which segment we're repairing and describe its condition
						
						(setq gArmorSegment (itmGetArmorInstalledLocation (scrGetItem gScreen)))
						(setq type (objGetArmorType gPlayerShip gArmorSegment))
						(setq damage (objGetArmorDamage gPlayerShip gArmorSegment))
						(setq desc (cat desc "The ship's " (objGetArmorName gPlayerShip gArmorSegment) " " (armGetName type)))
						(setq gCanRepair True)
						(switch
							(eq damage 0)
								(block Nil
									(setq desc (cat desc " is not damaged."))
									(setq gCanRepair Nil)
									)

							(eq damage 1)
								(setq desc (cat desc " has sustained 1 point of damage."))

							(setq desc (cat desc " has sustained " damage " points of damage."))
							)
							
						; See if we can repair it with the given item
						
						(if gCanRepair
							(block Nil
								(setq aItemToRepair (scrGetItem gScreen))
								(if (not (objFireItemEvent gSource gItem "CanRepairItem"))
									(block Nil
										(setq desc (cat desc
											"\n\nUnfortunately, it cannot be repaired with the " (itmGetName gItem 0) "."
											))
										(setq gCanRepair Nil)
										)
									)
								)
							)
						
						; Skill level
						(switch
							(not gCanRepair)
								Nil
								
							(ls skillLevel 2)
								(setq desc (cat desc
									"\n\nYou do not have much experience repairing your own armor."
									))
									
							(ls skillLevel 5)
								(setq desc (cat desc
									"\n\nYou have some experience repairing your own armor."
									))
									
							(ls skillLevel 10)
								(setq desc (cat desc
									"\n\nYou are proficient at repairing your own armor."
									))
									
							(setq desc (cat desc
								"\n\nYou are an expert at repairing your own armor."
								))
							)

						(scrSetDesc gScreen desc)

						; Disable actions if we cannot repair
						(scrEnableAction gScreen 0 gCanRepair)
						)
				</OnPaneInit>

				<Actions>
					<Action name="Repair this Armor Segment" key="R" default="1">
						(block Nil
							(setq gTitle (useRepairArmor gItem gArmorSegment))
							(scrShowPane gScreen "Done")
							)
					</Action>

					<Action name="Cancel" cancel="1" key="C">
						<Exit/>
					</Action>
					
				</Actions>
			</Default>
			
			<UnknownBarrel>
				<OnPaneInit>
					(block (desc type)
						(setq gArmorSegment (itmGetArmorInstalledLocation (scrGetItem gScreen)))
						(setq type (objGetArmorType gPlayerShip gArmorSegment))
						(if (itmIsKnown gItem)
							(setq desc (cat "You can use the " (itmGetName gItem 0) " on"))
							(setq desc (cat "The barrel seems to contain some kind of armor paste. You can use it on"))
							)

						(scrSetDesc gScreen (cat desc " your ship's " (objGetArmorName gPlayerShip gArmorSegment) " " (armGetName type) "."))
						)
				</OnPaneInit>

				<Actions>
					<Action name="Use on this Armor Segment" key="U" default="1">
						(block Nil
							; Identify the item [we do this first because we want to refer
							; to the barrel by its real name]
							(itmSetKnown gItem)

							; Repair
							(setq gTitle (useRepairArmor gItem gArmorSegment))
							(setq gTitle (cat
								(itmGetStaticData gItem "BarrelDesc") "\n\n"
								gTitle
								))
								
							(scrShowPane gScreen "Done")
							)
					</Action>

					<Action name="Cancel" key="C" cancel="1">
						<Exit/>
					</Action>
				</Actions>
			</UnknownBarrel>

			<Done 
					desc="=gTitle"
					noListNavigation="true"
					>

				<Actions>
					<Action name="Done" cancel="1" default="1" key="D">
						<Exit/>
					</Action>
				</Actions>
			</Done>
		</Panes>
	</DockScreen>

	<!-- Use Armor Coating -->

	<DockScreen UNID="&dsUseArmorCoating;"
			name=				"Ship's Interior"
			type=				"itemPicker"
			backgroundID=		"&rsItemListScreen;"
			>

		<ListOptions
			dataFrom=	"player"
			list=		"aI"
			/>

		<Panes>
			<Default>
				<OnPaneInit>
					(block (desc type)
						(setq gArmorSegment (itmGetArmorInstalledLocation (scrGetItem gScreen)))
						(setq type (objGetArmorType gPlayerShip gArmorSegment))
						(if (itmIsKnown gItem)
							(setq desc (cat "You can use the " (itmGetName gItem 0) " on"))
							(setq desc (cat "The barrel seems to contain some kind of armor paste. You can use it on"))
							)

						(scrSetDesc gScreen (cat desc " your ship's " (objGetArmorName gPlayerShip gArmorSegment) " " (armGetName type) "."))
						)
				</OnPaneInit>

				<Actions>
					<Action name="Use on this Armor Segment" key="U" default="1">
						(block (coatingType)
							(setq gArmorSegment (itmGetArmorInstalledLocation (scrGetItem gScreen)))
							(setq coatingType (itmGetTypeData gItem))
							(switch
								(eq coatingType 'ablative)
								(block (desc result)
									(setq desc "The paste is an ablative coating that resists laser and particle damage.")

									(setq result
										(shpEnhanceItem gPlayerShip (scrGetItem gScreen) 0x0a05)
										)

									(setq gTitle (cat desc (intArmorEnhanceStatus result)))
									)

								(eq coatingType 'acid)
								(block Nil
									(shpDamageArmor gPlayerShip gArmorSegment 2 (rollDice 3 6 0))
									(setq gTitle "Unfortunately, the barrel contained an organic acid that eats through most metals. Your armor has been damaged.")
									)

								(eq coatingType 'carbon-weave)
								(block (desc result enhancement itemLevel)
									(setq desc "The coating is composed of nanomachines that strengthen your armor.")

									; Figure out the enhancement based on the level
									(setq itemLevel (itmGetLevel (scrGetItem gScreen)))
									(setq enhancement Nil)
									(switch
										(leq itemLevel 3)
											(setq enhancement 0x0105)

										(leq itemLevel 5)
											(setq enhancement 0x0103)

										(leq itemLevel 6)
											(setq enhancement 0x0101)
										)

									(if enhancement
										(block Nil
											(setq result (shpEnhanceItem gPlayerShip (scrGetItem gScreen) enhancement))
											(setq gTitle (cat desc (intArmorEnhanceStatus result)))
											)
										(setq gTitle (cat desc " Unfortunately, your armor is too strong for the nanomachines."))
										)
									)

								(eq coatingType 'carbon-weave2)
								(block (desc result itemLevel)
									(setq desc "The coating is composed of nanomachines that strengthen your armor.")

									; Figure out the enhancement based on the level
									(setq itemLevel (itmGetLevel (scrGetItem gScreen)))
									(switch
										(leq itemLevel 6)
											(setq gTitle (cat desc " Unfortunately, your armor is too primitive for the nanomachines."))

										(leq itemLevel 10)
											(block Nil
												(setq result (shpEnhanceItem gPlayerShip (scrGetItem gScreen) 0x0105))
												(setq gTitle (cat desc (intArmorEnhanceStatus result)))
												)

										(setq gTitle (cat desc " Unfortunately, your armor is too strong for the nanomachines."))
										)
									)

								(eq coatingType 'centauriNanos)
								(block (desc result enhancement itemLevel)
									(setq desc "The coating is composed of nanomachines that strengthen your armor against laser and impact damage.")

									; Figure out the enhancement based on the level
									(setq itemLevel (itmGetLevel (scrGetItem gScreen)))
									(setq enhancement Nil)
									(switch
										(leq itemLevel 3)
											(setq enhancement 0x0808)

										(leq itemLevel 5)
											(setq enhancement 0x0805)

										(leq itemLevel 6)
											(setq enhancement 0x0803)
										)

									(if enhancement
										(block Nil
											(setq result (shpEnhanceItem gPlayerShip (scrGetItem gScreen) enhancement))
											(setq gTitle (cat desc (intArmorEnhanceStatus result)))
											)
										(setq gTitle (cat desc " Unfortunately, your armor is too strong for the nanomachines."))
										)
									)

								(eq coatingType 'decon)
								(block Nil
									(setq desc "The barrel was filled with a decontamination gel.")

									(if (shpIsRadioactive gPlayerShip)
										(block Nil
											(shpDecontaminate gPlayerShip)
											(setq desc (cat desc " Your ship has been decontaminated."))
											)
										(setq desc (cat desc " Since your ship is not radioactive, the gel has no effect."))
										)

									(setq gTitle desc)
									)

								(eq coatingType 'degenerating)
								(block Nil
									(setq desc "The paste is a nanomachine matrix that dissolves metals and composites.")

									(setq result
										(shpEnhanceItem gPlayerShip (scrGetItem gScreen) 0x8200)
										)

									(setq gTitle (cat desc (intArmorEnhanceStatus result)))
									)

								(eq coatingType 'EMPimmune)
								(block (desc result)
									(setq desc "The barrel contains monopole dust, which protects your armor against EMP effects.")

									(setq result
										(shpEnhanceItem gPlayerShip (scrGetItem gScreen) 0x0b20)
										)

									(setq gTitle (cat desc (intArmorEnhanceStatus result)))
									)

								(eq coatingType 'ioneffectimmune)
								(block (desc result)
									(setq desc "The barrel contains dyon dust, which immunizes your armor against disabling ion effects.")

									(setq result
										(shpEnhanceItem gPlayerShip (scrGetItem gScreen) 0x0c00)
										)

									(setq gTitle (cat desc (intArmorEnhanceStatus result)))
									)

								(eq coatingType 'ionresist)
								(block (desc result)
									(setq desc "The paste is a coating that resists ion damage.")

									(setq result
										(shpEnhanceItem gPlayerShip (scrGetItem gScreen) 0x0945)
										)

									(setq gTitle (cat desc (intArmorEnhanceStatus result)))
									)

								(eq coatingType 'particleresist)
								(block (desc result)
									(setq desc "The paste is a coating that resists particle damage.")

									(setq result
										(shpEnhanceItem gPlayerShip (scrGetItem gScreen) 0x0925)
										)

									(setq gTitle (cat desc (intArmorEnhanceStatus result)))
									)

								(eq coatingType 'radiationimmune)
								(block (desc result)
									(setq desc "The barrel contains a borocarbide paste that resists radiation.")

									(setq result
										(shpEnhanceItem gPlayerShip (scrGetItem gScreen) 0x0b00)
										)

									(setq gTitle (cat desc (intArmorEnhanceStatus result)))
									)

								(eq coatingType 'radioactive)
								(block Nil
									(setq desc "The barrel contained radioactive waste.")

									(switch
										(shpIsRadioactive gPlayerShip)
											(setq desc (cat desc " Your ship is already radioactive; the waste has no further effect."))

										(shpIsRadiationImmune gPlayerShip (scrGetItem gScreen))
											(setq desc (cat desc " Fortunately, your armor is immune to radiation. The waste has no effect."))

										(block Nil
											(shpMakeRadioactive gPlayerShip)
											(setq desc (cat desc " Your ship has been contaminated."))
											)
										)

									(setq gTitle desc)
									)

								(eq coatingType 'reactive)
								(block (desc result)
									(setq desc "The paste is a reactive coating that resists kinetic and chemical explosion damage.")

									(setq result
										(shpEnhanceItem gPlayerShip (scrGetItem gScreen) 0x0a15)
										)

									(setq gTitle (cat desc (intArmorEnhanceStatus result)))
									)

								(eq coatingType 'reflective)
								(block (desc result)
									(setq desc "The paste is a mirrored coating that reflects laser beams.")

									(setq result
										(shpEnhanceItem gPlayerShip (scrGetItem gScreen) 0x030a)
										)

									(setq gTitle (cat desc (intArmorEnhanceStatus result)))
									)

								(eq coatingType 'regenerating)
								(block Nil
									(setq desc "The paste is a nanomachine matrix that regenerates the armor segment.")

									(setq result
										(shpEnhanceItem gPlayerShip (scrGetItem gScreen) 0x0200)
										)

									(setq gTitle (cat desc (intArmorEnhanceStatus result)))
									)

								(eq coatingType 'shieldresist)
								(block (desc result)
									(setq desc "The barrel contains meteorsteel dust.")

									(setq result
										(shpEnhanceItem gPlayerShip (scrGetItem gScreen) 0x8c00)
										)

									(setq gTitle (cat desc (intArmorEnhanceStatus result)))
									)

								(eq coatingType 'thermoresist)
								(block (desc result)
									(setq desc "The paste is a coating that resists thermonuclear damage.")

									(setq result
										(shpEnhanceItem gPlayerShip (scrGetItem gScreen) 0x0955)
										)

									(setq gTitle (cat desc (intArmorEnhanceStatus result)))
									)

								(setq gTitle "Unknown barrel type")
								)

							; Remove the armor paste from the player's list
							(objRemoveItem gPlayerShip gItem 1)

							; Identify the item
							(itmSetKnown gItem)

							(scrShowPane gScreen "Done")
							)
					</Action>

					<Action name="Cancel" key="C" cancel="1">
						<Exit/>
					</Action>

				</Actions>

			</Default>

			<Done 
					desc="=gTitle"
					noListNavigation="true"
					>

				<Actions>
					<Action name="Done" cancel="1" default="1" key="D">
						<Exit/>
					</Action>
				</Actions>
			</Done>

		</Panes>

	</DockScreen>

<!-- GLOBALS -->

	<Globals>
		(block Nil
			(setq intFieldCrystalInstall (lambda (enhancementType theLifetime)
				(block (theShields)
					(switch
						; Must have a shield generator
						(not (setq theShields (item (objGetItems gSource "sI") 0)))
							(objSendMessage gSource Nil "Shield generator required")
							
						; If the shield generator is not advanced enough, then nothing happens
						(ls (itmGetLevel theShields) 7)
							(objSendMessage gSource Nil "Shield generator is too primitive for the field crystal")
							
						; If the shield generator is too advanced, then nothing happens
						(gr (itmGetLevel theShields) 12)
							(objSendMessage gSource Nil "Shield generator is too advanced for the field crystal")

						; Damage items cannot be enhanced
						(itmIsDamaged theShields)
							(objSendMessage gSource Nil "This crystal cannot enhance a damaged shield generator")
							
						; Enhance!
						(block Nil
							; Add enhancement
							(if (not (objAddItemEnhancement gSource theShields enhancementType theLifetime))
								(objSendMessage gSource Nil "The crystal has no effect")
								)

							; Identify the item
							(itmSetKnown gItem)

							; Remove ROM
							(objRemoveItem gSource gItem 1)
							)
						)
					)
				))

			(setq intFieldCrystalUse (lambda (newMods successText)
				(block (notFound)
					; Install
					(setq notFound True)
					(objEnumItems gSource "sI" theItem
						(block (shieldItem)
							(setq shieldItem theItem)
							(if notFound
								(block Nil
									(switch
										; If the shield generator is not advanced enough, then nothing happens
										(ls (itmGetLevel shieldItem) 7)
											(objSendMessage gSource Nil "Shield generator is too primitive for the field crystal")

										; If the shield generator is too advanced, then nothing happens
										(gr (itmGetLevel shieldItem) 12)
											(objSendMessage gSource Nil "Shield generator is too advanced for the field crystal")

										; If the item is damaged, we repair it
										(and (itmIsDamaged shieldItem) (ls newMods 0x8000))
											(block Nil
												(shpRepairItem gSource theItem)
												(objSendMessage gSource Nil "Shield generator has been repaired")
												
												; Remove ROM
												(objRemoveItem gSource gItem 1)
												)

										; Enhance the shield generator
										(block (result)
											(setq result (shpEnhanceItem gSource theItem newMods))
											(objSendMessage gSource Nil (intItemEnhanceStatus result successText "shield generator"))
											
											; Identify the item
											(itmSetKnown gItem)

											; Remove ROM
											(objRemoveItem gSource gItem 1)
											)
										)
									(setq notFound Nil)
									)
								)
							)
						)

					(if notFound
						(objSendMessage gSource Nil "Shield generator required")
						)
					)
				))

			(setq intEnhanceWeaponUse (lambda (newMods damageType successText)
				(block (notFound)
					; Install
					(setq notFound True)
					(objEnumItems gSource "w~lI" theItem
						(block (weaponItem)
							(setq weaponItem theItem)
							(if (and 
									notFound 
									(leq (itmGetLevel weaponItem) 10)
									(or (not damageType) (eq (itmGetDamageType weaponItem) damageType))
									(eq (shpGetItemDeviceName gSource weaponItem) 0)
									)
								(block Nil
									(switch
										; If the item is damaged, we repair it
										(and (itmIsDamaged weaponItem) (ls newMods 0x8000))
											(block Nil
												(shpRepairItem gSource theItem)
												(objSendMessage gSource Nil (cat (itmGetName weaponItem 33) " has been repaired"))
												)

										; Enhance the weapon
										(block (result)
											(setq result (shpEnhanceItem gSource theItem newMods))
											(objSendMessage gSource Nil (intItemEnhanceStatus result (cat "Your " (itmGetName weaponItem 32) " " successText) (cat "your " (itmGetName weaponItem 32))))
											)
										)
									(setq notFound Nil)
									)
								)
							)
						)

					; Item is identified

					(itmSetKnown gItem)

					; If we did not find a weapon to enhance, then no effect. Otherwise
					; we consume the item

					(if notFound
						(objSendMessage gSource Nil "The enhancement has no effect")
						(objRemoveItem gSource gItem 1)
						)
					)
				))
				
			(setq useRepairArmor (lambda (theItem theSegment)
				(block (needsRepair resultText)
					(setq needsRepair (gr (objGetArmorDamage gPlayerShip theSegment) 0))
					
					(if needsRepair
						(block (repair failureChance skillLevel usedUp)
							(setq skillLevel (typGetGlobalData &dsUseArmorPatch; "skillLevel"))
							(setq repair (eval (itmGetStaticData theItem "RepairHP")))
							
							; If the repairing item is damaged armor, then we don't repair as much
							(if (itmMatches theItem "aD")
								(setq repair (divide repair 2))
								)

							; As skill level increased, the player's failure chance
							; decreases. Also the amount of hp repaired increased.
							(switch
								(ls skillLevel 2)
									(block Nil
										(setq failureChance 20)
										(setq repair (divide (multiply repair 80) 100))
										)

								(ls skillLevel 5)
									(setq failureChance 10)

								(ls skillLevel 10)
									(block Nil
										(setq failureChance 5)
										(setq repair (divide (multiply repair 110) 100))
										)

								(block Nil
									(setq failureChance 0)
									(setq repair 
										(divide (multiply repair (min (add 70 (multiply skillLevel 5)) 200)) 100)
										)
									)
								)
								
							; Do the repairs
							(setq usedUp 100)
							(switch
								(not repair)
									(setq resultText "ERROR: &lt;RepairHP&gt; static data not found.")

								(leq (random 1 100) failureChance)
									(if (eq (random 1 2) 1)
										; Sometimes we fail and damage the armor
										(block Nil
											(shpDamageArmor gPlayerShip theSegment 7 (divide (multiply repair (random 20 100)) 100))
											(setq resultText "Unfortunately, your attempt to repair the armor has only damaged it further.")
											)
											
										; Sometimes we fail without damaging further
										(block Nil
											(setq resultText (cat 
												"Unfortunately, your attempt to repair the armor was unsuccessful "
												"and the " (itmGetName theItem 0) " was ruined in the process."
												))
											)
										)

								(block (hpRepaired)
									(setq hpRepaired (objRepairArmor gPlayerShip theSegment repair))
									(setq resultText (cat 
										"You have successfully repaired " hpRepaired
										(if (eq hpRepaired 1) " hit point " " hit points ")
										"of damage to your armor."
										))
										
									; How much of the kit did we use?
									(if (gr repair 0)
										(setq usedUp (divide (multiply 100 hpRepaired) repair))
										)
										
									; Skill level increases
									(typIncGlobalData &dsUseArmorPatch; "skillLevel" 1)
									)
								)
								
							; Use up the item
							(if (or (ls skillLevel 10)
									(geq usedUp 20)
									(leq (random 1 100) (add usedUp 20))
									)
								(objRemoveItem gPlayerShip theItem 1)
								
								; Item is not used up
								(setq resultText (cat resultText 
									"\n\nThere is still enough of the " (itmGetName theItem 0)
									" left to repair other segments."
									))
								)
							)

						(setq resultText "That armor segment is not damaged. There is no need to attempt repairs.")
						)

					resultText
					)
				))
			)
	</Globals>

</TranscendenceModule>